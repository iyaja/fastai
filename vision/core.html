<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Core vision</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Welcome to fastai">
    <link rel="preload" href="/fastai/assets/css/0.styles.24b54ae9.css" as="style"><link rel="preload" href="/fastai/assets/js/app.e4c088e4.js" as="script"><link rel="preload" href="/fastai/assets/js/2.f1c4f916.js" as="script"><link rel="preload" href="/fastai/assets/js/68.d013d2de.js" as="script"><link rel="prefetch" href="/fastai/assets/js/10.99994145.js"><link rel="prefetch" href="/fastai/assets/js/11.08687312.js"><link rel="prefetch" href="/fastai/assets/js/12.40b88a98.js"><link rel="prefetch" href="/fastai/assets/js/13.83861397.js"><link rel="prefetch" href="/fastai/assets/js/14.3a1586b8.js"><link rel="prefetch" href="/fastai/assets/js/15.1cbd093c.js"><link rel="prefetch" href="/fastai/assets/js/16.c850565b.js"><link rel="prefetch" href="/fastai/assets/js/17.9c3f07b2.js"><link rel="prefetch" href="/fastai/assets/js/18.db37b5bb.js"><link rel="prefetch" href="/fastai/assets/js/19.c91272fe.js"><link rel="prefetch" href="/fastai/assets/js/20.a9c5f90d.js"><link rel="prefetch" href="/fastai/assets/js/21.e40307f7.js"><link rel="prefetch" href="/fastai/assets/js/22.8fcdc465.js"><link rel="prefetch" href="/fastai/assets/js/23.14fb4a2d.js"><link rel="prefetch" href="/fastai/assets/js/24.720b52ea.js"><link rel="prefetch" href="/fastai/assets/js/25.7912d1b1.js"><link rel="prefetch" href="/fastai/assets/js/26.366239e0.js"><link rel="prefetch" href="/fastai/assets/js/27.6db2df9e.js"><link rel="prefetch" href="/fastai/assets/js/28.ffbcb114.js"><link rel="prefetch" href="/fastai/assets/js/29.7b21b9fd.js"><link rel="prefetch" href="/fastai/assets/js/3.6e2ab6c3.js"><link rel="prefetch" href="/fastai/assets/js/30.248393fd.js"><link rel="prefetch" href="/fastai/assets/js/31.b22a56a0.js"><link rel="prefetch" href="/fastai/assets/js/32.85f7da41.js"><link rel="prefetch" href="/fastai/assets/js/33.e44ef8ee.js"><link rel="prefetch" href="/fastai/assets/js/34.9ce56e10.js"><link rel="prefetch" href="/fastai/assets/js/35.4bdc5816.js"><link rel="prefetch" href="/fastai/assets/js/36.67e5f7d9.js"><link rel="prefetch" href="/fastai/assets/js/37.36c20575.js"><link rel="prefetch" href="/fastai/assets/js/38.06c462ff.js"><link rel="prefetch" href="/fastai/assets/js/39.749b6672.js"><link rel="prefetch" href="/fastai/assets/js/4.a083dd6e.js"><link rel="prefetch" href="/fastai/assets/js/40.c732859b.js"><link rel="prefetch" href="/fastai/assets/js/41.4474ab47.js"><link rel="prefetch" href="/fastai/assets/js/42.5ee2fc2f.js"><link rel="prefetch" href="/fastai/assets/js/43.cc635513.js"><link rel="prefetch" href="/fastai/assets/js/44.152c8da5.js"><link rel="prefetch" href="/fastai/assets/js/45.4cff1d71.js"><link rel="prefetch" href="/fastai/assets/js/46.85dce95d.js"><link rel="prefetch" href="/fastai/assets/js/47.59fb5617.js"><link rel="prefetch" href="/fastai/assets/js/48.f20ef06e.js"><link rel="prefetch" href="/fastai/assets/js/49.9625880a.js"><link rel="prefetch" href="/fastai/assets/js/5.bb68e855.js"><link rel="prefetch" href="/fastai/assets/js/50.b2e6dee9.js"><link rel="prefetch" href="/fastai/assets/js/51.267442e2.js"><link rel="prefetch" href="/fastai/assets/js/52.10494ddd.js"><link rel="prefetch" href="/fastai/assets/js/53.093941a1.js"><link rel="prefetch" href="/fastai/assets/js/54.fbc03694.js"><link rel="prefetch" href="/fastai/assets/js/55.0b1efc19.js"><link rel="prefetch" href="/fastai/assets/js/56.5f3c1da5.js"><link rel="prefetch" href="/fastai/assets/js/57.a3e942a9.js"><link rel="prefetch" href="/fastai/assets/js/58.d3ded5e3.js"><link rel="prefetch" href="/fastai/assets/js/59.ec1d3156.js"><link rel="prefetch" href="/fastai/assets/js/6.f6c9602c.js"><link rel="prefetch" href="/fastai/assets/js/60.37aa0b8a.js"><link rel="prefetch" href="/fastai/assets/js/61.ef622343.js"><link rel="prefetch" href="/fastai/assets/js/62.e733d0f9.js"><link rel="prefetch" href="/fastai/assets/js/63.a3aa571a.js"><link rel="prefetch" href="/fastai/assets/js/64.8b06642f.js"><link rel="prefetch" href="/fastai/assets/js/65.97cf2dfa.js"><link rel="prefetch" href="/fastai/assets/js/66.7f97711c.js"><link rel="prefetch" href="/fastai/assets/js/67.31ee059f.js"><link rel="prefetch" href="/fastai/assets/js/69.50b9f11d.js"><link rel="prefetch" href="/fastai/assets/js/7.c1cdf251.js"><link rel="prefetch" href="/fastai/assets/js/70.1b6f8370.js"><link rel="prefetch" href="/fastai/assets/js/71.8c3557b5.js"><link rel="prefetch" href="/fastai/assets/js/72.2d857b7b.js"><link rel="prefetch" href="/fastai/assets/js/73.0be86c71.js"><link rel="prefetch" href="/fastai/assets/js/74.a9279ff6.js"><link rel="prefetch" href="/fastai/assets/js/75.f6ce5fb3.js"><link rel="prefetch" href="/fastai/assets/js/8.be08f3ee.js"><link rel="prefetch" href="/fastai/assets/js/9.209ff10c.js">
    <link rel="stylesheet" href="/fastai/assets/css/0.styles.24b54ae9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fastai/" class="home-link router-link-active"><img src="https://images.exxactcorp.com/CMS/landing-page/resource-center/supported-software/logo/Deep-Learning/fastai-logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/fastai/quick_start.html" class="nav-link">
  Quick Start
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tutorials" class="dropdown-title"><span class="title">Tutorials</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tutorials" class="mobile-dropdown-title"><span class="title">Tutorials</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/overview.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><h4>
          Beginners
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/vision.html" class="nav-link">
  Vision Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/text.html" class="nav-link">
  Text Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/tabular.html" class="nav-link">
  Tabular Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/colab.html" class="nav-link">
  Colab Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Intermediate
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/datablock.html" class="nav-link">
  Data Block Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/imagenette.html" class="nav-link">
  Imagenette Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/pets.html" class="nav-link">
  Pets Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/transformers.html" class="nav-link">
  Transformers Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/wikitext.html" class="nav-link">
  Wikitext Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Advanced
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/siamese.html" class="nav-link">
  Siamese Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/dev-setup.html" class="nav-link">
  Developer Guide
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Training" class="dropdown-title"><span class="title">Training</span> <span class="arrow down"></span></button> <button type="button" aria-label="Training" class="mobile-dropdown-title"><span class="title">Training</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/training/learner.html" class="nav-link">
  Training Loop
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/optimizer.html" class="nav-link">
  Optimizer
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/metrics.html" class="nav-link">
  Metrics
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/interpret.html" class="nav-link">
  Interpretation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/distributed.html" class="nav-link">
  Distributed
</a></li><li class="dropdown-item"><h4>
          Callbacks
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/callback/core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/schedule.html" class="nav-link">
  Schedulers
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/hook.html" class="nav-link">
  Hooks and callbacks
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/fp16.html" class="nav-link">
  Mixed precision
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/mixup.html" class="nav-link">
  Mixup
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/cutmix.html" class="nav-link">
  Cutmix
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/tracker.html" class="nav-link">
  Tracker
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/training.html" class="nav-link">
  Training
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/rnn.html" class="nav-link">
  RNN
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/data.html" class="nav-link">
  Data
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/progress.html" class="nav-link">
  Progress
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Data" class="dropdown-title"><span class="title">Data</span> <span class="arrow down"></span></button> <button type="button" aria-label="Data" class="mobile-dropdown-title"><span class="title">Data</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/data/block.html" class="nav-link">
  Data Blocks
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/transforms.html" class="nav-link">
  Data Transforms
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/external.html" class="nav-link">
  Data External
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/core.html" class="nav-link">
  Data Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/load.html" class="nav-link">
  DataLoaders
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Core" class="dropdown-title"><span class="title">Core</span> <span class="arrow down"></span></button> <button type="button" aria-label="Core" class="mobile-dropdown-title"><span class="title">Core</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/torch_core.html" class="nav-link">
  PyTorch Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/layers.html" class="nav-link">
  Layers
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vision" class="dropdown-title"><span class="title">Vision</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vision" class="mobile-dropdown-title"><span class="title">Vision</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/learner.html" class="nav-link">
  Vision Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/augment.html" class="nav-link">
  Vision Data Augmentation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/data.html" class="nav-link">
  Vision Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/core.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Vision Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/utils.html" class="nav-link">
  Vision Utils
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/widgets.html" class="nav-link">
  Vision Widgets
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/vision/models.xresnet.html" class="nav-link">
  XResNet
</a></li><li class="dropdown-subitem"><a href="/fastai/vision/models.unet.html" class="nav-link">
  UNet
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Text" class="dropdown-title"><span class="title">Text</span> <span class="arrow down"></span></button> <button type="button" aria-label="Text" class="mobile-dropdown-title"><span class="title">Text</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/core.html" class="nav-link">
  Text Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/data.html" class="nav-link">
  Text Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/learner.html" class="nav-link">
  Text Learner
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/text/models.core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.awdlstm.html" class="nav-link">
  AWD LSTM
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.qrnn.html" class="nav-link">
  QRNN
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tabular" class="dropdown-title"><span class="title">Tabular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tabular" class="mobile-dropdown-title"><span class="title">Tabular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/tabular/core.html" class="nav-link">
  Tabular Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/data.html" class="nav-link">
  Tabular Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/learner.html" class="nav-link">
  Tabular Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/model.html" class="nav-link">
  Tabular Model
</a></li><li class="dropdown-item"><!----> <a href="/fastai/collab.html" class="nav-link">
  Collab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Medical" class="dropdown-title"><span class="title">Medical</span> <span class="arrow down"></span></button> <button type="button" aria-label="Medical" class="mobile-dropdown-title"><span class="title">Medical</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/medical/imaging.html" class="nav-link">
  Medical imagery
</a></li><li class="dropdown-item"><!----> <a href="/fastai/medical/text.html" class="nav-link">
  Medical text
</a></li></ul></div></div> <a href="https://github.com/fastai/fastai" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/fastai/quick_start.html" class="nav-link">
  Quick Start
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tutorials" class="dropdown-title"><span class="title">Tutorials</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tutorials" class="mobile-dropdown-title"><span class="title">Tutorials</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/overview.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><h4>
          Beginners
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/vision.html" class="nav-link">
  Vision Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/text.html" class="nav-link">
  Text Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/tabular.html" class="nav-link">
  Tabular Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/colab.html" class="nav-link">
  Colab Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Intermediate
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/datablock.html" class="nav-link">
  Data Block Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/imagenette.html" class="nav-link">
  Imagenette Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/pets.html" class="nav-link">
  Pets Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/transformers.html" class="nav-link">
  Transformers Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/wikitext.html" class="nav-link">
  Wikitext Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Advanced
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/siamese.html" class="nav-link">
  Siamese Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/dev-setup.html" class="nav-link">
  Developer Guide
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Training" class="dropdown-title"><span class="title">Training</span> <span class="arrow down"></span></button> <button type="button" aria-label="Training" class="mobile-dropdown-title"><span class="title">Training</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/training/learner.html" class="nav-link">
  Training Loop
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/optimizer.html" class="nav-link">
  Optimizer
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/metrics.html" class="nav-link">
  Metrics
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/interpret.html" class="nav-link">
  Interpretation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/distributed.html" class="nav-link">
  Distributed
</a></li><li class="dropdown-item"><h4>
          Callbacks
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/callback/core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/schedule.html" class="nav-link">
  Schedulers
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/hook.html" class="nav-link">
  Hooks and callbacks
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/fp16.html" class="nav-link">
  Mixed precision
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/mixup.html" class="nav-link">
  Mixup
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/cutmix.html" class="nav-link">
  Cutmix
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/tracker.html" class="nav-link">
  Tracker
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/training.html" class="nav-link">
  Training
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/rnn.html" class="nav-link">
  RNN
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/data.html" class="nav-link">
  Data
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/progress.html" class="nav-link">
  Progress
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Data" class="dropdown-title"><span class="title">Data</span> <span class="arrow down"></span></button> <button type="button" aria-label="Data" class="mobile-dropdown-title"><span class="title">Data</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/data/block.html" class="nav-link">
  Data Blocks
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/transforms.html" class="nav-link">
  Data Transforms
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/external.html" class="nav-link">
  Data External
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/core.html" class="nav-link">
  Data Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/load.html" class="nav-link">
  DataLoaders
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Core" class="dropdown-title"><span class="title">Core</span> <span class="arrow down"></span></button> <button type="button" aria-label="Core" class="mobile-dropdown-title"><span class="title">Core</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/torch_core.html" class="nav-link">
  PyTorch Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/layers.html" class="nav-link">
  Layers
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vision" class="dropdown-title"><span class="title">Vision</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vision" class="mobile-dropdown-title"><span class="title">Vision</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/learner.html" class="nav-link">
  Vision Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/augment.html" class="nav-link">
  Vision Data Augmentation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/data.html" class="nav-link">
  Vision Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/core.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Vision Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/utils.html" class="nav-link">
  Vision Utils
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/widgets.html" class="nav-link">
  Vision Widgets
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/vision/models.xresnet.html" class="nav-link">
  XResNet
</a></li><li class="dropdown-subitem"><a href="/fastai/vision/models.unet.html" class="nav-link">
  UNet
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Text" class="dropdown-title"><span class="title">Text</span> <span class="arrow down"></span></button> <button type="button" aria-label="Text" class="mobile-dropdown-title"><span class="title">Text</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/core.html" class="nav-link">
  Text Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/data.html" class="nav-link">
  Text Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/learner.html" class="nav-link">
  Text Learner
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/text/models.core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.awdlstm.html" class="nav-link">
  AWD LSTM
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.qrnn.html" class="nav-link">
  QRNN
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tabular" class="dropdown-title"><span class="title">Tabular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tabular" class="mobile-dropdown-title"><span class="title">Tabular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/tabular/core.html" class="nav-link">
  Tabular Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/data.html" class="nav-link">
  Tabular Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/learner.html" class="nav-link">
  Tabular Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/model.html" class="nav-link">
  Tabular Model
</a></li><li class="dropdown-item"><!----> <a href="/fastai/collab.html" class="nav-link">
  Collab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Medical" class="dropdown-title"><span class="title">Medical</span> <span class="arrow down"></span></button> <button type="button" aria-label="Medical" class="mobile-dropdown-title"><span class="title">Medical</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/medical/imaging.html" class="nav-link">
  Medical imagery
</a></li><li class="dropdown-item"><!----> <a href="/fastai/medical/text.html" class="nav-link">
  Medical text
</a></li></ul></div></div> <a href="https://github.com/fastai/fastai" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Core vision</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fastai/vision/core.html#helpers" class="sidebar-link">Helpers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#image-n-px" class="sidebar-link" style="padding-left:3rem;">Image.n_px</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#image-shape" class="sidebar-link" style="padding-left:3rem;">Image.shape</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#image-aspect" class="sidebar-link" style="padding-left:3rem;">Image.aspect</a></li></ul></li><li><a href="/fastai/vision/core.html#basic-types" class="sidebar-link">Basic types</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#images" class="sidebar-link">Images</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#segmentation-masks" class="sidebar-link">Segmentation masks</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#points" class="sidebar-link">Points</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/core.html#bounding-boxes" class="sidebar-link">Bounding boxes</a></li></ul></li><li><a href="/fastai/vision/core.html#basic-transforms" class="sidebar-link">Basic Transforms</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="core-vision"><a href="#core-vision" class="header-anchor">#</a> Core vision</h1> <blockquote><p>Basic image opening/processing functionality</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> fastai<span class="token punctuation">.</span>data<span class="token punctuation">.</span>external <span class="token keyword">import</span> <span class="token operator">*</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#TODO: investigate</span>
</code></pre></div><h2 id="helpers"><a href="#helpers" class="header-anchor">#</a> Helpers</h2> <div class="language-python extra-class"><pre class="language-python"><code>im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>TEST_IMAGE<span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="n_px" class="doc_header"><code>n_px</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L30" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>n_px</code>(<strong><code>x</code></strong>:<code>Image</code>)</p></blockquote> <h4 id="image-n-px"><a href="#image-n-px" class="header-anchor">#</a> <code>Image.n_px</code></h4> <blockquote><p><code>Image.n_px</code> (property)</p></blockquote> <p>Number of pixels in image</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>n_px<span class="token punctuation">,</span> <span class="token number">30</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="shape" class="doc_header"><code>shape</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L34" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>shape</code>(<strong><code>x</code></strong>:<code>Image</code>)</p></blockquote> <h4 id="image-shape"><a href="#image-shape" class="header-anchor">#</a> <code>Image.shape</code></h4> <blockquote><p><code>Image.shape</code> (property)</p></blockquote> <p>Image (height,width) tuple (NB:opposite order of <code>Image.size()</code>, same order as numpy array and pytorch tensor)</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="aspect" class="doc_header"><code>aspect</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L38" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>aspect</code>(<strong><code>x</code></strong>:<code>Image</code>)</p></blockquote> <h4 id="image-aspect"><a href="#image-aspect" class="header-anchor">#</a> <code>Image.aspect</code></h4> <blockquote><p><code>Image.aspect</code> (property)</p></blockquote> <p>Aspect ratio of the image, i.e. <code>width/height</code></p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>aspect<span class="token punctuation">,</span> <span class="token number">30</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="Image.reshape" class="doc_header"><code>Image.reshape</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L42" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>Image.reshape</code>(<strong><code>x</code></strong>:<code>Image</code>, <strong><code>h</code></strong>, <strong><code>w</code></strong>, <strong><code>resample</code></strong>=<em><code>0</code></em>)</p></blockquote> <p><code>resize</code> <code>x</code> to <code>(w,h)</code></p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="Image.to_bytes_format" class="doc_header"><code>Image.to_bytes_format</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L48" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>Image.to_bytes_format</code>(<strong><code>im</code></strong>:<code>Image</code>, <strong><code>format</code></strong>=<em><code>'png'</code></em>)</p></blockquote> <p>Convert to bytes, default to PNG format</p> <h4 id="Image.to_thumb" class="doc_header"><code>Image.to_thumb</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L56" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>Image.to_thumb</code>(<strong><code>h</code></strong>, <strong><code>w</code></strong>=<em><code>None</code></em>)</p></blockquote> <p>Same as <code>thumbnail</code>, but uses a copy</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>resize_max<span class="token punctuation">(</span>max_px<span class="token operator">=</span><span class="token number">20</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>resize_max<span class="token punctuation">(</span>max_px<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">.</span>n_px<span class="token punctuation">,</span> <span class="token number">294</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>resize_max<span class="token punctuation">(</span>max_px<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> max_h<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> max_w<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>resize_max<span class="token punctuation">(</span>max_h<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> max_w<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>resize_max<span class="token punctuation">(</span>max_px<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> max_h<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> max_w<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="Image.resize_max" class="doc_header"><code>Image.resize_max</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L65" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>Image.resize_max</code>(<strong><code>x</code></strong>:<code>Image</code>, <strong><code>resample</code></strong>=<em><code>0</code></em>, <strong><code>max_px</code></strong>=<em><code>None</code></em>, <strong><code>max_h</code></strong>=<em><code>None</code></em>, <strong><code>max_w</code></strong>=<em><code>None</code></em>)</p></blockquote> <p><code>resize</code> <code>x</code> to <code>max_px</code>, or <code>max_h</code>, or <code>max_w</code></p> <h2 id="basic-types"><a href="#basic-types" class="header-anchor">#</a> Basic types</h2> <p>This section regroups the basic types used in vision with the transform that create objects of those types.</p> <h4 id="to_image" class="doc_header"><code>to_image</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L75" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>to_image</code>(<strong><code>x</code></strong>)</p></blockquote> <p>Convert a tensor or array to a PIL int8 Image</p> <h4 id="load_image" class="doc_header"><code>load_image</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L83" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>load_image</code>(<strong><code>fn</code></strong>, <strong><code>mode</code></strong>=<em><code>None</code></em>)</p></blockquote> <p>Open and load a <code>PIL.Image</code> and convert to <code>mode</code></p> <h4 id="image2tensor" class="doc_header"><code>image2tensor</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L91" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>image2tensor</code>(<strong><code>img</code></strong>)</p></blockquote> <p>Transform image to byte tensor in <code>c*h*w</code> dim order.</p> <h3 id="PILBase" class="doc_header"><code>class</code> <code>PILBase</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L98" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>PILBase</code>() :: <code>Image</code></p></blockquote> <p>This class represents an image object.  To create
:py:class:<code>~PIL.Image.Image</code> objects, use the appropriate factory
functions.  There's hardly ever any reason to call the Image constructor
directly.</p> <ul><li>:py:func:<code>~PIL.Image.open</code></li> <li>:py:func:<code>~PIL.Image.new</code></li> <li>:py:func:<code>~PIL.Image.frombytes</code></li></ul> <h3 id="PILImage" class="doc_header"><code>class</code> <code>PILImage</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L119" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>PILImage</code>() :: <a href="/fastai/vision.core.html#PILBase"><code>PILBase</code></a></p></blockquote> <p>This class represents an image object.  To create
:py:class:<code>~PIL.Image.Image</code> objects, use the appropriate factory
functions.  There's hardly ever any reason to call the Image constructor
directly.</p> <ul><li>:py:func:<code>~PIL.Image.open</code></li> <li>:py:func:<code>~PIL.Image.new</code></li> <li>:py:func:<code>~PIL.Image.frombytes</code></li></ul> <h3 id="PILImageBW" class="doc_header"><code>class</code> <code>PILImageBW</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L122" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>PILImageBW</code>() :: <a href="/fastai/vision.core.html#PILImage"><code>PILImage</code></a></p></blockquote> <p>This class represents an image object.  To create
:py:class:<code>~PIL.Image.Image</code> objects, use the appropriate factory
functions.  There's hardly ever any reason to call the Image constructor
directly.</p> <ul><li>:py:func:<code>~PIL.Image.open</code></li> <li>:py:func:<code>~PIL.Image.new</code></li> <li>:py:func:<code>~PIL.Image.frombytes</code></li></ul> <div class="language-python extra-class"><pre class="language-python"><code>im <span class="token operator">=</span> PILImage<span class="token punctuation">.</span>create<span class="token punctuation">(</span>TEST_IMAGE<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">,</span> PILImage<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>mode<span class="token punctuation">,</span> <span class="token string">'RGB'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'PILImage mode=RGB size=1200x803'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>im<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_46_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>ax <span class="token operator">=</span> im<span class="token punctuation">.</span>show<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_47_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>test_fig_exists<span class="token punctuation">(</span>ax<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>timg <span class="token operator">=</span> TensorImage<span class="token punctuation">(</span>image2tensor<span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">)</span>
tpil <span class="token operator">=</span> PILImage<span class="token punctuation">.</span>create<span class="token punctuation">(</span>timg<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>tpil<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_50_0.png" alt="png"></p> <h3 id="PILMask" class="doc_header"><code>class</code> <code>PILMask</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L125" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>PILMask</code>() :: <a href="/fastai/vision.core.html#PILBase"><code>PILBase</code></a></p></blockquote> <p>This class represents an image object.  To create
:py:class:<code>~PIL.Image.Image</code> objects, use the appropriate factory
functions.  There's hardly ever any reason to call the Image constructor
directly.</p> <ul><li>:py:func:<code>~PIL.Image.open</code></li> <li>:py:func:<code>~PIL.Image.new</code></li> <li>:py:func:<code>~PIL.Image.frombytes</code></li></ul> <div class="language-python extra-class"><pre class="language-python"><code>im <span class="token operator">=</span> PILMask<span class="token punctuation">.</span>create<span class="token punctuation">(</span>TEST_IMAGE<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">,</span> PILMask<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>im<span class="token punctuation">.</span>mode<span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'PILMask mode=L size=1200x803'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="images"><a href="#images" class="header-anchor">#</a> Images</h3> <div class="language-python extra-class"><pre class="language-python"><code>mnist <span class="token operator">=</span> untar_data<span class="token punctuation">(</span>URLs<span class="token punctuation">.</span>MNIST_TINY<span class="token punctuation">)</span>
fns <span class="token operator">=</span> get_image_files<span class="token punctuation">(</span>mnist<span class="token punctuation">)</span>
mnist_fn <span class="token operator">=</span> TEST_IMAGE_BW
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>timg <span class="token operator">=</span> Transform<span class="token punctuation">(</span>PILImageBW<span class="token punctuation">.</span>create<span class="token punctuation">)</span>
mnist_img <span class="token operator">=</span> timg<span class="token punctuation">(</span>mnist_fn<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>mnist_img<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>mnist_img<span class="token punctuation">,</span> PILImageBW<span class="token punctuation">)</span>
mnist_img
</code></pre></div><p><img src="output_57_0.png" alt="png"></p> <h3 id="segmentation-masks"><a href="#segmentation-masks" class="header-anchor">#</a> Segmentation masks</h3> <h3 id="AddMaskCodes" class="doc_header"><code>class</code> <code>AddMaskCodes</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L133" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>AddMaskCodes</code>(<strong><code>codes</code></strong>=<em><code>None</code></em>) :: <a href="https://fastcore.fast.ai/transform#Transform" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Add the code metadata to a <a href="/fastai/torch_core.html#TensorMask"><code>TensorMask</code></a></p> <div class="language-python extra-class"><pre class="language-python"><code>camvid <span class="token operator">=</span> untar_data<span class="token punctuation">(</span>URLs<span class="token punctuation">.</span>CAMVID_TINY<span class="token punctuation">)</span>
fns <span class="token operator">=</span> get_image_files<span class="token punctuation">(</span>camvid<span class="token operator">/</span><span class="token string">'images'</span><span class="token punctuation">)</span>
cam_fn <span class="token operator">=</span> fns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
mask_fn <span class="token operator">=</span> camvid<span class="token operator">/</span><span class="token string">'labels'</span><span class="token operator">/</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>cam_fn<span class="token punctuation">.</span>stem<span class="token punctuation">}</span></span><span class="token string">_P</span><span class="token interpolation"><span class="token punctuation">{</span>cam_fn<span class="token punctuation">.</span>suffix<span class="token punctuation">}</span></span><span class="token string">'</span></span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>cam_img <span class="token operator">=</span> PILImage<span class="token punctuation">.</span>create<span class="token punctuation">(</span>cam_fn<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>cam_img<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
tmask <span class="token operator">=</span> Transform<span class="token punctuation">(</span>PILMask<span class="token punctuation">.</span>create<span class="token punctuation">)</span>
mask <span class="token operator">=</span> tmask<span class="token punctuation">(</span>mask_fn<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">,</span> PILMask<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>mask<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cam_img<span class="token punctuation">.</span>show<span class="token punctuation">(</span>ctx<span class="token operator">=</span>axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'image'</span><span class="token punctuation">)</span>
mask<span class="token punctuation">.</span>show<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'mask'</span><span class="token punctuation">)</span>
cam_img<span class="token punctuation">.</span>show<span class="token punctuation">(</span>ctx<span class="token operator">=</span>axs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'superimposed'</span><span class="token punctuation">)</span>
mask<span class="token punctuation">.</span>show<span class="token punctuation">(</span>ctx<span class="token operator">=</span>axs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_63_0.png" alt="png"></p> <h3 id="points"><a href="#points" class="header-anchor">#</a> Points</h3> <h3 id="TensorPoint" class="doc_header"><code>class</code> <code>TensorPoint</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L144" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>TensorPoint</code>(<strong><code>x</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/torch_core.html#TensorBase"><code>TensorBase</code></a></p></blockquote> <p>Basic type for points in an image</p> <p>Points are expected to come as an array/tensor of shape <code>(n,2)</code> or as a list of lists with two elements. Unless you change the defaults in <a href="/fastai/vision.core.html#PointScaler"><code>PointScaler</code></a> (see later on), coordinates should go from 0 to width/height, with the first one being the column index (so from 0 to width) and the second one being the row index (so from 0 to height).
{% include note.html content='This is different from the usual indexing convention for arrays in numpy or in PyTorch, but its the way points are expected by matplotlib or the internal functions in PyTorch like <code>F.grid_sample</code>.' %}</p> <div class="language-python extra-class"><pre class="language-python"><code>pnt_img <span class="token operator">=</span> TensorImage<span class="token punctuation">(</span>mnist_img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pnts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tfm <span class="token operator">=</span> Transform<span class="token punctuation">(</span>TensorPoint<span class="token punctuation">.</span>create<span class="token punctuation">)</span>
tpnts <span class="token operator">=</span> tfm<span class="token punctuation">(</span>pnts<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tpnts<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tpnts<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>ctx <span class="token operator">=</span> pnt_img<span class="token punctuation">.</span>show<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span><span class="token punctuation">)</span>
tpnts<span class="token punctuation">.</span>show<span class="token punctuation">(</span>ctx<span class="token operator">=</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_70_0.png" alt="png"></p> <h3 id="bounding-boxes"><a href="#bounding-boxes" class="header-anchor">#</a> Bounding boxes</h3> <h4 id="get_annotations" class="doc_header"><code>get_annotations</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L165" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>get_annotations</code>(<strong><code>fname</code></strong>, <strong><code>prefix</code></strong>=<em><code>None</code></em>)</p></blockquote> <p>Open a COCO style json in <code>fname</code> and returns the lists of filenames (with maybe <code>prefix</code>) and labelled bboxes.</p> <h3 id="TensorBBox" class="doc_header"><code>class</code> <code>TensorBBox</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L195" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>TensorBBox</code>(<strong><code>x</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.core.html#TensorPoint"><code>TensorPoint</code></a></p></blockquote> <p>Basic type for a tensor of bounding boxes in an image</p> <p>Bounding boxes are expected to come as tuple with an array/tensor of shape <code>(n,4)</code> or as a list of lists with four elements and a list of corresponding labels. Unless you change the defaults in <a href="/fastai/vision.core.html#PointScaler"><code>PointScaler</code></a> (see later on), coordinates for each bounding box should go from 0 to width/height, with the following convention: x1, y1, x2, y2 where (x1,y1) is your top-left corner and (x2,y2) is your bottom-right corner.
{% include note.html content='We use the same convention as for points with x going from 0 to width and y going from 0 to height.' %}</p> <h3 id="LabeledBBox" class="doc_header"><code>class</code> <code>LabeledBBox</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L206" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>LabeledBBox</code>(<strong><code>items</code></strong>=<em><code>None</code></em>, <strong>*<code>rest</code></strong>, <strong><code>use_list</code></strong>=<em><code>False</code></em>, <strong><code>match</code></strong>=<em><code>None</code></em>) :: <a href="https://fastcore.fast.ai/foundation#L" target="_blank" rel="noopener noreferrer"><code>L</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Basic type for a list of bounding boxes in an image</p> <div class="language-python extra-class"><pre class="language-python"><code>coco <span class="token operator">=</span> untar_data<span class="token punctuation">(</span>URLs<span class="token punctuation">.</span>COCO_TINY<span class="token punctuation">)</span>
images<span class="token punctuation">,</span> lbl_bbox <span class="token operator">=</span> get_annotations<span class="token punctuation">(</span>coco<span class="token operator">/</span><span class="token string">'train.json'</span><span class="token punctuation">)</span>
idx<span class="token operator">=</span><span class="token number">2</span>
coco_fn<span class="token punctuation">,</span>bbox <span class="token operator">=</span> coco<span class="token operator">/</span><span class="token string">'train'</span><span class="token operator">/</span>images<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span>lbl_bbox<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
coco_img <span class="token operator">=</span> timg<span class="token punctuation">(</span>coco_fn<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>tbbox <span class="token operator">=</span> LabeledBBox<span class="token punctuation">(</span>TensorBBox<span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ctx <span class="token operator">=</span> coco_img<span class="token punctuation">.</span>show<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span><span class="token punctuation">)</span>
tbbox<span class="token punctuation">.</span>show<span class="token punctuation">(</span>ctx<span class="token operator">=</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_82_0.png" alt="png"></p> <h2 id="basic-transforms"><a href="#basic-transforms" class="header-anchor">#</a> Basic Transforms</h2> <p>Unless specifically mentioned, all the following transforms can be used as single-item transforms (in one of the list in the <code>tfms</code> you pass to a <code>TfmdDS</code> or a <code>Datasource</code>) or tuple transforms (in the <code>tuple_tfms</code> you pass to a <code>TfmdDS</code> or a <code>Datasource</code>). The safest way that will work across applications is to always use them as <code>tuple_tfms</code>. For instance, if you have points or bounding boxes as targets and use <a href="/fastai/vision.augment.html#Resize"><code>Resize</code></a> as a single-item transform, when you get to <a href="/fastai/vision.core.html#PointScaler"><code>PointScaler</code></a> (which is a tuple transform) you won't have the correct size of the image to properly scale your points.</p> <h4 id="encodes" class="doc_header"><code>encodes</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L281" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>encodes</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>)</p></blockquote> <h4 id="encodes" class="doc_header"><code>encodes</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L281" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>encodes</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>)</p></blockquote> <p>Any data augmentation transform that runs on PIL Images must be run before this transform.</p> <div class="language-python extra-class"><pre class="language-python"><code>tfm <span class="token operator">=</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tfm<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>mnist_img<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>tfm<span class="token punctuation">(</span>mnist_img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>ToTensor:
(PILMask,object) -&gt; encodes
(PILBase,object) -&gt; encodes
 
&lt;class '__main__.PILImageBW'&gt;
&lt;class 'fastai.torch_core.TensorImageBW'&gt;
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>tfm <span class="token operator">=</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tfm<span class="token punctuation">(</span>mnist_img<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>tfm<span class="token punctuation">(</span>mnist_img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TensorImageBW<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tfm<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>tfm<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TensorMask<span class="token punctuation">)</span>
</code></pre></div><p>Let's confirm we can pipeline this with <a href="/fastai/vision.core.html#PILImage.create"><code>PILImage.create</code></a>.</p> <div class="language-python extra-class"><pre class="language-python"><code>pipe_img <span class="token operator">=</span> Pipeline<span class="token punctuation">(</span><span class="token punctuation">[</span>PILImageBW<span class="token punctuation">.</span>create<span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> pipe_img<span class="token punctuation">(</span>mnist_fn<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorImageBW<span class="token punctuation">)</span>
pipe_img<span class="token punctuation">.</span>show<span class="token punctuation">(</span>img<span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_93_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_cam_lbl</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> mask_fn
cam_tds <span class="token operator">=</span> Datasets<span class="token punctuation">(</span><span class="token punctuation">[</span>cam_fn<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>_cam_lbl<span class="token punctuation">,</span> PILMask<span class="token punctuation">.</span>create<span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
show_at<span class="token punctuation">(</span>cam_tds<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_94_0.png" alt="png"></p> <p>To work with data augmentation, and in particular the <code>grid_sample</code> method, points need to be represented with coordinates going from -1 to 1 (-1 being top or left, 1 bottom or right), which will be done unless you pass <code>do_scale=False</code>. We also need to make sure they are following our convention of points being x,y coordinates, so pass along <code>y_first=True</code> if you have your data in an y,x format to add a flip.
{% include warning.html content='This transform needs to run on the tuple level, before any transform that changes the image size.' %}</p> <h3 id="PointScaler" class="doc_header"><code>class</code> <code>PointScaler</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L235" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>PointScaler</code>(<strong><code>do_scale</code></strong>=<em><code>True</code></em>, <strong><code>y_first</code></strong>=<em><code>False</code></em>) :: <a href="https://fastcore.fast.ai/transform#Transform" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Scale a tensor representing points</p> <p>To work with data augmentation, and in particular the <code>grid_sample</code> method, points need to be represented with coordinates going from -1 to 1 (-1 being top or left, 1 bottom or right), which will be done unless you pass <code>do_scale=False</code>. We also need to make sure they are following our convention of points being x,y coordinates, so pass along <code>y_first=True</code> if you have your data in an y,x format to add a flip.
{% include note.html content='This transform automatically grabs the sizes of the images it sees before a <code>TensorPoint</code> object and embeds it in them. For this to work, those images need to be before any points in the order of your final tuple. If you dont have such images, you need to embed the size of the corresponding image when creating a <code>TensorPoint</code> by passing it with <code>sz=...</code>.' %}</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_pnt_lbl</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> TensorPoint<span class="token punctuation">.</span>create<span class="token punctuation">(</span>pnts<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_pnt_open</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> PILImage<span class="token punctuation">(</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pnt_tds <span class="token operator">=</span> Datasets<span class="token punctuation">(</span><span class="token punctuation">[</span>mnist_fn<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>_pnt_open<span class="token punctuation">,</span> <span class="token punctuation">[</span>_pnt_lbl<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pnt_tdl <span class="token operator">=</span> TfmdDL<span class="token punctuation">(</span>pnt_tds<span class="token punctuation">,</span> bs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> after_item<span class="token operator">=</span><span class="token punctuation">[</span>PointScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>pnt_tdl<span class="token punctuation">.</span>after_item<span class="token punctuation">.</span>c<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>x<span class="token punctuation">,</span>y <span class="token operator">=</span> pnt_tdl<span class="token punctuation">.</span>one_batch<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#Scaling and flipping properly done</span>
<span class="token comment">#NB: we added a point earlier at (9,17); formula below scales to (-1,1) coords</span>
test_close<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">14</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token operator">/</span><span class="token number">17.5</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">,</span>b <span class="token operator">=</span> pnt_tdl<span class="token punctuation">.</span>decode_batch<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
test_eq<span class="token punctuation">(</span>b<span class="token punctuation">,</span> tensor<span class="token punctuation">(</span>pnts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#Check types</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorImage<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorPoint<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorImage<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorPoint<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>b<span class="token punctuation">.</span>get_meta<span class="token punctuation">(</span><span class="token string">'img_size'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#Automatically picked the size of the input</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>pnt_tdl<span class="token punctuation">.</span>show_batch<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_103_0.png" alt="png"></p> <h3 id="BBoxLabeler" class="doc_header"><code>class</code> <code>BBoxLabeler</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L260" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>BBoxLabeler</code>(<strong><code>enc</code></strong>=<em><code>None</code></em>, <strong><code>dec</code></strong>=<em><code>None</code></em>, <strong><code>split_idx</code></strong>=<em><code>None</code></em>, <strong><code>order</code></strong>=<em><code>None</code></em>) :: <a href="https://fastcore.fast.ai/transform#Transform" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<a href="/fastai/tabular.core.html#encodes"><code>encodes</code></a>,<a href="/fastai/tabular.core.html#decodes"><code>decodes</code></a>,<a href="/fastai/tabular.core.html#setups"><code>setups</code></a>) if <code>split_idx</code> matches</p> <h4 id="decodes" class="doc_header"><code>decodes</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L286" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>decodes</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>)</p></blockquote> <h4 id="encodes" class="doc_header"><code>encodes</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L281" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>encodes</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>)</p></blockquote> <h4 id="decodes" class="doc_header"><code>decodes</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/core.py#L286" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>decodes</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>)</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_coco_bb</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> TensorBBox<span class="token punctuation">.</span>create<span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_coco_lbl</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

coco_tds <span class="token operator">=</span> Datasets<span class="token punctuation">(</span><span class="token punctuation">[</span>coco_fn<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">,</span> <span class="token punctuation">[</span>_coco_bb<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>_coco_lbl<span class="token punctuation">,</span> MultiCategorize<span class="token punctuation">(</span>add_na<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_inp<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
coco_tdl <span class="token operator">=</span> TfmdDL<span class="token punctuation">(</span>coco_tds<span class="token punctuation">,</span> bs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> after_item<span class="token operator">=</span><span class="token punctuation">[</span>BBoxLabeler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PointScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>Categorize<span class="token punctuation">(</span>add_na<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Categorize: {'vocab': None, 'add_na': True}:
(object,object) -&gt; encodes
 (object,object) -&gt; decodes
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>coco_tds<span class="token punctuation">.</span>tfms
</code></pre></div><div class="language- extra-class"><pre><code>(#3) [Pipeline: PILBase.create,Pipeline: _coco_bb,Pipeline: _coco_lbl -&gt; MultiCategorize: {'vocab': (#2) ['#na#','vase'], 'add_na': True}]
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z
</code></pre></div><div class="language- extra-class"><pre><code>(PILImage mode=RGB size=128x128,
 TensorBBox([[-0.9011, -0.4606,  0.1416,  0.6764],
         [ 0.2000, -0.2405,  1.0000,  0.9102],
         [ 0.4909, -0.9325,  0.9284, -0.5011]]),
 TensorMultiCategory([1, 1, 1]))
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z <span class="token operator">=</span> coco_tdl<span class="token punctuation">.</span>one_batch<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_close<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span>tensor<span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">64</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>z<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token operator">=</span> coco_tdl<span class="token punctuation">.</span>decode_batch<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
test_close<span class="token punctuation">(</span>b<span class="token punctuation">,</span> tensor<span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>c<span class="token punctuation">.</span>bbox<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>c<span class="token punctuation">.</span>lbl<span class="token punctuation">,</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#Check types</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorImage<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorBBox<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorMultiCategory<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorImage<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> TensorBBox<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> LabeledBBox<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>y<span class="token punctuation">.</span>get_meta<span class="token punctuation">(</span><span class="token string">'img_size'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>coco_tdl<span class="token punctuation">.</span>show_batch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_116_0.png" alt="png"></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/fastai/assets/js/app.e4c088e4.js" defer></script><script src="/fastai/assets/js/2.f1c4f916.js" defer></script><script src="/fastai/assets/js/68.d013d2de.js" defer></script>
  </body>
</html>
