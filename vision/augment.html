<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data augmentation in computer vision</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Welcome to fastai">
    <link rel="preload" href="/fastai/assets/css/0.styles.24b54ae9.css" as="style"><link rel="preload" href="/fastai/assets/js/app.e4c088e4.js" as="script"><link rel="preload" href="/fastai/assets/js/2.f1c4f916.js" as="script"><link rel="preload" href="/fastai/assets/js/67.31ee059f.js" as="script"><link rel="prefetch" href="/fastai/assets/js/10.99994145.js"><link rel="prefetch" href="/fastai/assets/js/11.08687312.js"><link rel="prefetch" href="/fastai/assets/js/12.40b88a98.js"><link rel="prefetch" href="/fastai/assets/js/13.83861397.js"><link rel="prefetch" href="/fastai/assets/js/14.3a1586b8.js"><link rel="prefetch" href="/fastai/assets/js/15.1cbd093c.js"><link rel="prefetch" href="/fastai/assets/js/16.c850565b.js"><link rel="prefetch" href="/fastai/assets/js/17.9c3f07b2.js"><link rel="prefetch" href="/fastai/assets/js/18.db37b5bb.js"><link rel="prefetch" href="/fastai/assets/js/19.c91272fe.js"><link rel="prefetch" href="/fastai/assets/js/20.a9c5f90d.js"><link rel="prefetch" href="/fastai/assets/js/21.e40307f7.js"><link rel="prefetch" href="/fastai/assets/js/22.8fcdc465.js"><link rel="prefetch" href="/fastai/assets/js/23.14fb4a2d.js"><link rel="prefetch" href="/fastai/assets/js/24.720b52ea.js"><link rel="prefetch" href="/fastai/assets/js/25.7912d1b1.js"><link rel="prefetch" href="/fastai/assets/js/26.366239e0.js"><link rel="prefetch" href="/fastai/assets/js/27.6db2df9e.js"><link rel="prefetch" href="/fastai/assets/js/28.ffbcb114.js"><link rel="prefetch" href="/fastai/assets/js/29.7b21b9fd.js"><link rel="prefetch" href="/fastai/assets/js/3.6e2ab6c3.js"><link rel="prefetch" href="/fastai/assets/js/30.248393fd.js"><link rel="prefetch" href="/fastai/assets/js/31.b22a56a0.js"><link rel="prefetch" href="/fastai/assets/js/32.85f7da41.js"><link rel="prefetch" href="/fastai/assets/js/33.e44ef8ee.js"><link rel="prefetch" href="/fastai/assets/js/34.9ce56e10.js"><link rel="prefetch" href="/fastai/assets/js/35.4bdc5816.js"><link rel="prefetch" href="/fastai/assets/js/36.67e5f7d9.js"><link rel="prefetch" href="/fastai/assets/js/37.36c20575.js"><link rel="prefetch" href="/fastai/assets/js/38.06c462ff.js"><link rel="prefetch" href="/fastai/assets/js/39.749b6672.js"><link rel="prefetch" href="/fastai/assets/js/4.a083dd6e.js"><link rel="prefetch" href="/fastai/assets/js/40.c732859b.js"><link rel="prefetch" href="/fastai/assets/js/41.4474ab47.js"><link rel="prefetch" href="/fastai/assets/js/42.5ee2fc2f.js"><link rel="prefetch" href="/fastai/assets/js/43.cc635513.js"><link rel="prefetch" href="/fastai/assets/js/44.152c8da5.js"><link rel="prefetch" href="/fastai/assets/js/45.4cff1d71.js"><link rel="prefetch" href="/fastai/assets/js/46.85dce95d.js"><link rel="prefetch" href="/fastai/assets/js/47.59fb5617.js"><link rel="prefetch" href="/fastai/assets/js/48.f20ef06e.js"><link rel="prefetch" href="/fastai/assets/js/49.9625880a.js"><link rel="prefetch" href="/fastai/assets/js/5.bb68e855.js"><link rel="prefetch" href="/fastai/assets/js/50.b2e6dee9.js"><link rel="prefetch" href="/fastai/assets/js/51.267442e2.js"><link rel="prefetch" href="/fastai/assets/js/52.10494ddd.js"><link rel="prefetch" href="/fastai/assets/js/53.093941a1.js"><link rel="prefetch" href="/fastai/assets/js/54.fbc03694.js"><link rel="prefetch" href="/fastai/assets/js/55.0b1efc19.js"><link rel="prefetch" href="/fastai/assets/js/56.5f3c1da5.js"><link rel="prefetch" href="/fastai/assets/js/57.a3e942a9.js"><link rel="prefetch" href="/fastai/assets/js/58.d3ded5e3.js"><link rel="prefetch" href="/fastai/assets/js/59.ec1d3156.js"><link rel="prefetch" href="/fastai/assets/js/6.f6c9602c.js"><link rel="prefetch" href="/fastai/assets/js/60.37aa0b8a.js"><link rel="prefetch" href="/fastai/assets/js/61.ef622343.js"><link rel="prefetch" href="/fastai/assets/js/62.e733d0f9.js"><link rel="prefetch" href="/fastai/assets/js/63.a3aa571a.js"><link rel="prefetch" href="/fastai/assets/js/64.8b06642f.js"><link rel="prefetch" href="/fastai/assets/js/65.97cf2dfa.js"><link rel="prefetch" href="/fastai/assets/js/66.7f97711c.js"><link rel="prefetch" href="/fastai/assets/js/68.d013d2de.js"><link rel="prefetch" href="/fastai/assets/js/69.50b9f11d.js"><link rel="prefetch" href="/fastai/assets/js/7.c1cdf251.js"><link rel="prefetch" href="/fastai/assets/js/70.1b6f8370.js"><link rel="prefetch" href="/fastai/assets/js/71.8c3557b5.js"><link rel="prefetch" href="/fastai/assets/js/72.2d857b7b.js"><link rel="prefetch" href="/fastai/assets/js/73.0be86c71.js"><link rel="prefetch" href="/fastai/assets/js/74.a9279ff6.js"><link rel="prefetch" href="/fastai/assets/js/75.f6ce5fb3.js"><link rel="prefetch" href="/fastai/assets/js/8.be08f3ee.js"><link rel="prefetch" href="/fastai/assets/js/9.209ff10c.js">
    <link rel="stylesheet" href="/fastai/assets/css/0.styles.24b54ae9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fastai/" class="home-link router-link-active"><img src="https://images.exxactcorp.com/CMS/landing-page/resource-center/supported-software/logo/Deep-Learning/fastai-logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/fastai/quick_start.html" class="nav-link">
  Quick Start
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tutorials" class="dropdown-title"><span class="title">Tutorials</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tutorials" class="mobile-dropdown-title"><span class="title">Tutorials</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/overview.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><h4>
          Beginners
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/vision.html" class="nav-link">
  Vision Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/text.html" class="nav-link">
  Text Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/tabular.html" class="nav-link">
  Tabular Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/colab.html" class="nav-link">
  Colab Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Intermediate
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/datablock.html" class="nav-link">
  Data Block Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/imagenette.html" class="nav-link">
  Imagenette Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/pets.html" class="nav-link">
  Pets Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/transformers.html" class="nav-link">
  Transformers Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/wikitext.html" class="nav-link">
  Wikitext Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Advanced
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/siamese.html" class="nav-link">
  Siamese Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/dev-setup.html" class="nav-link">
  Developer Guide
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Training" class="dropdown-title"><span class="title">Training</span> <span class="arrow down"></span></button> <button type="button" aria-label="Training" class="mobile-dropdown-title"><span class="title">Training</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/training/learner.html" class="nav-link">
  Training Loop
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/optimizer.html" class="nav-link">
  Optimizer
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/metrics.html" class="nav-link">
  Metrics
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/interpret.html" class="nav-link">
  Interpretation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/distributed.html" class="nav-link">
  Distributed
</a></li><li class="dropdown-item"><h4>
          Callbacks
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/callback/core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/schedule.html" class="nav-link">
  Schedulers
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/hook.html" class="nav-link">
  Hooks and callbacks
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/fp16.html" class="nav-link">
  Mixed precision
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/mixup.html" class="nav-link">
  Mixup
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/cutmix.html" class="nav-link">
  Cutmix
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/tracker.html" class="nav-link">
  Tracker
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/training.html" class="nav-link">
  Training
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/rnn.html" class="nav-link">
  RNN
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/data.html" class="nav-link">
  Data
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/progress.html" class="nav-link">
  Progress
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Data" class="dropdown-title"><span class="title">Data</span> <span class="arrow down"></span></button> <button type="button" aria-label="Data" class="mobile-dropdown-title"><span class="title">Data</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/data/block.html" class="nav-link">
  Data Blocks
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/transforms.html" class="nav-link">
  Data Transforms
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/external.html" class="nav-link">
  Data External
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/core.html" class="nav-link">
  Data Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/load.html" class="nav-link">
  DataLoaders
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Core" class="dropdown-title"><span class="title">Core</span> <span class="arrow down"></span></button> <button type="button" aria-label="Core" class="mobile-dropdown-title"><span class="title">Core</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/torch_core.html" class="nav-link">
  PyTorch Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/layers.html" class="nav-link">
  Layers
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vision" class="dropdown-title"><span class="title">Vision</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vision" class="mobile-dropdown-title"><span class="title">Vision</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/learner.html" class="nav-link">
  Vision Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/augment.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Vision Data Augmentation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/data.html" class="nav-link">
  Vision Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/core.html" class="nav-link">
  Vision Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/utils.html" class="nav-link">
  Vision Utils
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/widgets.html" class="nav-link">
  Vision Widgets
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/vision/models.xresnet.html" class="nav-link">
  XResNet
</a></li><li class="dropdown-subitem"><a href="/fastai/vision/models.unet.html" class="nav-link">
  UNet
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Text" class="dropdown-title"><span class="title">Text</span> <span class="arrow down"></span></button> <button type="button" aria-label="Text" class="mobile-dropdown-title"><span class="title">Text</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/core.html" class="nav-link">
  Text Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/data.html" class="nav-link">
  Text Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/learner.html" class="nav-link">
  Text Learner
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/text/models.core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.awdlstm.html" class="nav-link">
  AWD LSTM
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.qrnn.html" class="nav-link">
  QRNN
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tabular" class="dropdown-title"><span class="title">Tabular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tabular" class="mobile-dropdown-title"><span class="title">Tabular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/tabular/core.html" class="nav-link">
  Tabular Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/data.html" class="nav-link">
  Tabular Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/learner.html" class="nav-link">
  Tabular Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/model.html" class="nav-link">
  Tabular Model
</a></li><li class="dropdown-item"><!----> <a href="/fastai/collab.html" class="nav-link">
  Collab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Medical" class="dropdown-title"><span class="title">Medical</span> <span class="arrow down"></span></button> <button type="button" aria-label="Medical" class="mobile-dropdown-title"><span class="title">Medical</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/medical/imaging.html" class="nav-link">
  Medical imagery
</a></li><li class="dropdown-item"><!----> <a href="/fastai/medical/text.html" class="nav-link">
  Medical text
</a></li></ul></div></div> <a href="https://github.com/fastai/fastai" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/fastai/quick_start.html" class="nav-link">
  Quick Start
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tutorials" class="dropdown-title"><span class="title">Tutorials</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tutorials" class="mobile-dropdown-title"><span class="title">Tutorials</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/overview.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><h4>
          Beginners
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/vision.html" class="nav-link">
  Vision Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/text.html" class="nav-link">
  Text Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/tabular.html" class="nav-link">
  Tabular Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/colab.html" class="nav-link">
  Colab Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Intermediate
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/datablock.html" class="nav-link">
  Data Block Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/imagenette.html" class="nav-link">
  Imagenette Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/pets.html" class="nav-link">
  Pets Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/transformers.html" class="nav-link">
  Transformers Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/wikitext.html" class="nav-link">
  Wikitext Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Advanced
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/siamese.html" class="nav-link">
  Siamese Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/dev-setup.html" class="nav-link">
  Developer Guide
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Training" class="dropdown-title"><span class="title">Training</span> <span class="arrow down"></span></button> <button type="button" aria-label="Training" class="mobile-dropdown-title"><span class="title">Training</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/training/learner.html" class="nav-link">
  Training Loop
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/optimizer.html" class="nav-link">
  Optimizer
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/metrics.html" class="nav-link">
  Metrics
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/interpret.html" class="nav-link">
  Interpretation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/distributed.html" class="nav-link">
  Distributed
</a></li><li class="dropdown-item"><h4>
          Callbacks
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/callback/core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/schedule.html" class="nav-link">
  Schedulers
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/hook.html" class="nav-link">
  Hooks and callbacks
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/fp16.html" class="nav-link">
  Mixed precision
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/mixup.html" class="nav-link">
  Mixup
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/cutmix.html" class="nav-link">
  Cutmix
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/tracker.html" class="nav-link">
  Tracker
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/training.html" class="nav-link">
  Training
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/rnn.html" class="nav-link">
  RNN
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/data.html" class="nav-link">
  Data
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/progress.html" class="nav-link">
  Progress
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Data" class="dropdown-title"><span class="title">Data</span> <span class="arrow down"></span></button> <button type="button" aria-label="Data" class="mobile-dropdown-title"><span class="title">Data</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/data/block.html" class="nav-link">
  Data Blocks
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/transforms.html" class="nav-link">
  Data Transforms
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/external.html" class="nav-link">
  Data External
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/core.html" class="nav-link">
  Data Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/load.html" class="nav-link">
  DataLoaders
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Core" class="dropdown-title"><span class="title">Core</span> <span class="arrow down"></span></button> <button type="button" aria-label="Core" class="mobile-dropdown-title"><span class="title">Core</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/torch_core.html" class="nav-link">
  PyTorch Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/layers.html" class="nav-link">
  Layers
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vision" class="dropdown-title"><span class="title">Vision</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vision" class="mobile-dropdown-title"><span class="title">Vision</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/learner.html" class="nav-link">
  Vision Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/augment.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Vision Data Augmentation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/data.html" class="nav-link">
  Vision Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/core.html" class="nav-link">
  Vision Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/utils.html" class="nav-link">
  Vision Utils
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/widgets.html" class="nav-link">
  Vision Widgets
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/vision/models.xresnet.html" class="nav-link">
  XResNet
</a></li><li class="dropdown-subitem"><a href="/fastai/vision/models.unet.html" class="nav-link">
  UNet
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Text" class="dropdown-title"><span class="title">Text</span> <span class="arrow down"></span></button> <button type="button" aria-label="Text" class="mobile-dropdown-title"><span class="title">Text</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/core.html" class="nav-link">
  Text Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/data.html" class="nav-link">
  Text Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/learner.html" class="nav-link">
  Text Learner
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/text/models.core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.awdlstm.html" class="nav-link">
  AWD LSTM
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.qrnn.html" class="nav-link">
  QRNN
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tabular" class="dropdown-title"><span class="title">Tabular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tabular" class="mobile-dropdown-title"><span class="title">Tabular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/tabular/core.html" class="nav-link">
  Tabular Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/data.html" class="nav-link">
  Tabular Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/learner.html" class="nav-link">
  Tabular Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/model.html" class="nav-link">
  Tabular Model
</a></li><li class="dropdown-item"><!----> <a href="/fastai/collab.html" class="nav-link">
  Collab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Medical" class="dropdown-title"><span class="title">Medical</span> <span class="arrow down"></span></button> <button type="button" aria-label="Medical" class="mobile-dropdown-title"><span class="title">Medical</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/medical/imaging.html" class="nav-link">
  Medical imagery
</a></li><li class="dropdown-item"><!----> <a href="/fastai/medical/text.html" class="nav-link">
  Medical text
</a></li></ul></div></div> <a href="https://github.com/fastai/fastai" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Data augmentation in computer vision</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fastai/vision/augment.html#item-transforms" class="sidebar-link">Item transforms</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fastai/vision/augment.html#resize-with-crop-pad-or-squish" class="sidebar-link">Resize with crop, pad or squish</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fastai/vision/augment.html#affine-and-coord-tfm-on-the-gpu" class="sidebar-link">Affine and coord tfm on the GPU</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fastai/vision/augment.html#flip-dihedral-gpu-helpers" class="sidebar-link">Flip/Dihedral GPU helpers</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/augment.html#warping" class="sidebar-link">Warping</a></li></ul></li><li><a href="/fastai/vision/augment.html#lighting-transforms" class="sidebar-link">Lighting transforms</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fastai/vision/augment.html#randomerasing" class="sidebar-link">RandomErasing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fastai/vision/augment.html#all-together" class="sidebar-link">All together</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fastai/vision/augment.html#integration-tests" class="sidebar-link">Integration tests</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fastai/vision/augment.html#segmentation" class="sidebar-link">Segmentation</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/augment.html#point-targets" class="sidebar-link">Point targets</a></li><li class="sidebar-sub-header"><a href="/fastai/vision/augment.html#bounding-boxes" class="sidebar-link">Bounding boxes</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="data-augmentation-in-computer-vision"><a href="#data-augmentation-in-computer-vision" class="header-anchor">#</a> Data augmentation in computer vision</h1> <blockquote><p>Transforms to apply data augmentation in Computer Vision</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code>img <span class="token operator">=</span> PILImage<span class="token punctuation">(</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">(</span>TEST_IMAGE<span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="RandTransform" class="doc_header"><code>class</code> <code>RandTransform</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L21" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RandTransform</code>(<strong><code>p</code></strong>=<em><code>1.0</code></em>, <strong><code>nm</code></strong>=<em><code>None</code></em>, <strong><code>before_call</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="https://fastcore.fast.ai/transform#DisplayedTransform" target="_blank" rel="noopener noreferrer"><code>DisplayedTransform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>A transform that before_call its state at each <code>__call__</code></p> <p>As for all <a href="https://fastcore.fast.ai/transform#Transform" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> you can pass <code>encodes</code> and <code>decodes</code> at init or subclass and implement them. You can do the same for the <code>before_call</code> method that is called at each <code>__call__</code>. Note that to have a consistent state for inputs and targets, a <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a> must be applied at the tuple level.</p> <p>By default the before_call behavior is to execute the transform with probability <code>p</code> (if subclassing and wanting to tweak that behavior, the attribute <code>self.do</code>, if it exists, is looked for to decide if the transform is executed or not).
{% include note.html content='A <code>RandTransform</code> is only applied to the training set by default, so you have to pass <code>split_idx=0</code> if you are calling it directly and not through a <code>Datasets</code>. That behavior can be changed by setting the attr <code>split_idx</code> of the transform to <code>None</code>.' %}</p> <h4 id="RandTransform.before_call" class="doc_header"><code>RandTransform.before_call</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L170" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>RandTransform.before_call</code>(<strong><code>b</code></strong>, <strong><code>split_idx</code></strong>)</p></blockquote> <p>Set <code>self.do</code> based on <code>self.p</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_add1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">1</span>
dumb_tfm <span class="token operator">=</span> RandTransform<span class="token punctuation">(</span>enc<span class="token operator">=</span>_add1<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
start<span class="token punctuation">,</span>d1<span class="token punctuation">,</span>d2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> dumb_tfm<span class="token punctuation">(</span>start<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> dumb_tfm<span class="token punctuation">.</span>do<span class="token punctuation">:</span> test_eq<span class="token punctuation">(</span>t<span class="token punctuation">,</span> start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> d1<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>           test_eq<span class="token punctuation">(</span>t<span class="token punctuation">,</span> start<span class="token punctuation">)</span>  <span class="token punctuation">;</span> d2<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token keyword">assert</span> d1 <span class="token keyword">and</span> d2
dumb_tfm
</code></pre></div><div class="language- extra-class"><pre><code>_add1 -- {'p': 0.5}:
encodes: (object,object) -&gt; _add1decodes: 
</code></pre></div><h2 id="item-transforms"><a href="#item-transforms" class="header-anchor">#</a> Item transforms</h2> <h4 id="Image.flip_lr" class="doc_header"><code>Image.flip_lr</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L45" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>Image.flip_lr</code>(<strong><code>x</code></strong>:<code>Image</code>)</p></blockquote> <h4 id="TensorImageBase.flip_lr" class="doc_header"><code>TensorImageBase.flip_lr</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L47" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImageBase.flip_lr</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImageBase"><code>TensorImageBase</code></a>)</p></blockquote> <h4 id="TensorPoint.flip_lr" class="doc_header"><code>TensorPoint.flip_lr</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L49" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.flip_lr</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorPoint"><code>TensorPoint</code></a>)</p></blockquote> <h4 id="TensorBBox.flip_lr" class="doc_header"><code>TensorBBox.flip_lr</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L51" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.flip_lr</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>)</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
show_image<span class="token punctuation">(</span>img<span class="token punctuation">,</span> ctx<span class="token operator">=</span>axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'original'</span><span class="token punctuation">)</span>
show_image<span class="token punctuation">(</span>img<span class="token punctuation">.</span>flip_lr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'flipped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_16_0.png" alt="png"></p> <h3 id="FlipItem" class="doc_header"><code>class</code> <code>FlipItem</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L55" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>FlipItem</code>(<strong><code>p</code></strong>=<em><code>0.5</code></em>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Randomly flip with probability <code>p</code></p> <div class="language-python extra-class"><pre class="language-python"><code>tflip <span class="token operator">=</span> FlipItem<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tflip<span class="token punctuation">(</span>bbox<span class="token punctuation">,</span>split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="PILImage.dihedral" class="doc_header"><code>PILImage.dihedral</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L61" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>PILImage.dihedral</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#PILImage"><code>PILImage</code></a>, <strong><code>k</code></strong>)</p></blockquote> <h4 id="TensorImage.dihedral" class="doc_header"><code>TensorImage.dihedral</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L63" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.dihedral</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong><code>k</code></strong>)</p></blockquote> <h4 id="TensorPoint.dihedral" class="doc_header"><code>TensorPoint.dihedral</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L69" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.dihedral</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorPoint"><code>TensorPoint</code></a>, <strong><code>k</code></strong>)</p></blockquote> <h4 id="TensorBBox.dihedral" class="doc_header"><code>TensorBBox.dihedral</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L75" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.dihedral</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>, <strong><code>k</code></strong>)</p></blockquote> <p>By default each of the 8 dihedral transformations (including noop) have the same probability of being picked when the transform is applied. You can customize this behavior by passing your own <code>draw</code> function. To force a specific flip, you can also pass an integer between 0 and 7.</p> <h3 id="DihedralItem" class="doc_header"><code>class</code> <code>DihedralItem</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L82" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>DihedralItem</code>(<strong><code>p</code></strong>=<em><code>1.0</code></em>, <strong><code>nm</code></strong>=<em><code>None</code></em>, <strong><code>before_call</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Randomly flip with probability <code>p</code></p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>DihedralItem<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_28_0.png" alt="png"></p> <h2 id="resize-with-crop-pad-or-squish"><a href="#resize-with-crop-pad-or-squish" class="header-anchor">#</a> Resize with crop, pad or squish</h2> <h3 id="PadMode" class="doc_header"><code>class</code> <code>PadMode</code><a href="" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>PadMode</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <p>All possible padding mode as attributes to get tab-completion and typo-proofing</p> <h4 id="TensorBBox.crop_pad" class="doc_header"><code>TensorBBox.crop_pad</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L129" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.crop_pad</code>(<strong><code>x</code></strong>:<code>Image'&gt;)</code>, <strong><code>sz</code></strong>, <strong><code>tl</code></strong>=<em><code>None</code></em>, <strong><code>orig_sz</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong><code>resize_mode</code></strong>=<em><code>2</code></em>, <strong><code>resize_to</code></strong>=<em><code>None</code></em>)</p></blockquote> <h4 id="TensorPoint.crop_pad" class="doc_header"><code>TensorPoint.crop_pad</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L129" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.crop_pad</code>(<strong><code>x</code></strong>:<code>Image'&gt;)</code>, <strong><code>sz</code></strong>, <strong><code>tl</code></strong>=<em><code>None</code></em>, <strong><code>orig_sz</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong><code>resize_mode</code></strong>=<em><code>2</code></em>, <strong><code>resize_to</code></strong>=<em><code>None</code></em>)</p></blockquote> <h4 id="Image.crop_pad" class="doc_header"><code>Image.crop_pad</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L129" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>Image.crop_pad</code>(<strong><code>x</code></strong>:<code>Image'&gt;)</code>, <strong><code>sz</code></strong>, <strong><code>tl</code></strong>=<em><code>None</code></em>, <strong><code>orig_sz</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong><code>resize_mode</code></strong>=<em><code>2</code></em>, <strong><code>resize_to</code></strong>=<em><code>None</code></em>)</p></blockquote> <h3 id="CropPad" class="doc_header"><code>class</code> <code>CropPad</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L149" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>CropPad</code>(<strong><code>size</code></strong>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="https://fastcore.fast.ai/transform#DisplayedTransform" target="_blank" rel="noopener noreferrer"><code>DisplayedTransform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Center crop or pad an image to <code>size</code></p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax<span class="token punctuation">,</span>sz <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>img<span class="token punctuation">.</span>crop_pad<span class="token punctuation">(</span>sz<span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Size </span><span class="token interpolation"><span class="token punctuation">{</span>sz<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_41_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax<span class="token punctuation">,</span>mode <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>PadMode<span class="token punctuation">.</span>Zeros<span class="token punctuation">,</span> PadMode<span class="token punctuation">.</span>Border<span class="token punctuation">,</span> PadMode<span class="token punctuation">.</span>Reflection<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>img<span class="token punctuation">.</span>crop_pad<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_mode<span class="token operator">=</span>mode<span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_42_0.png" alt="png"></p> <h3 id="RandTransform" class="doc_header"><code>class</code> <code>RandTransform</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L21" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RandTransform</code>(<strong><code>p</code></strong>=<em><code>1.0</code></em>, <strong><code>nm</code></strong>=<em><code>None</code></em>, <strong><code>before_call</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="https://fastcore.fast.ai/transform#DisplayedTransform" target="_blank" rel="noopener noreferrer"><code>DisplayedTransform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>A transform that before_call its state at each <code>__call__</code></p> <h3 id="CropPad" class="doc_header"><code>class</code> <code>CropPad</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L149" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>CropPad</code>(<strong><code>size</code></strong>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="https://fastcore.fast.ai/transform#DisplayedTransform" target="_blank" rel="noopener noreferrer"><code>DisplayedTransform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Center crop or pad an image to <code>size</code></p> <h3 id="RandomCrop" class="doc_header"><code>class</code> <code>RandomCrop</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L194" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RandomCrop</code>(<strong><code>size</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Randomly crop an image to <code>size</code></p> <h3 id="OldRandomCrop" class="doc_header"><code>class</code> <code>OldRandomCrop</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L210" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>OldRandomCrop</code>(<strong><code>size</code></strong>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>) :: <a href="/fastai/vision.augment.html#CropPad"><code>CropPad</code></a></p></blockquote> <p>Randomly crop an image to <code>size</code></p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> RandomCrop<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>f<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_51_0.png" alt="png"></p> <p>On the validation set, we take a center crop.</p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>f<span class="token punctuation">(</span>img<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_53_0.png" alt="png"></p> <h3 id="ResizeMethod" class="doc_header"><code>class</code> <code>ResizeMethod</code><a href="" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>ResizeMethod</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <p>All possible resize method as attributes to get tab-completion and typo-proofing</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>ResizeMethod<span class="token punctuation">.</span>Squish<span class="token punctuation">,</span> <span class="token string">'squish'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="Resize" class="doc_header"><code>class</code> <code>Resize</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L226" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Resize</code>(<strong><code>size</code></strong>, <strong><code>method</code></strong>=<em><code>'crop'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>resamples</code></strong>=<em><code>(2, 0)</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>A transform that before_call its state at each <code>__call__</code></p> <div class="language-python extra-class"><pre class="language-python"><code>Resize<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Resize -- {'size': (224, 224), 'method': 'crop', 'pad_mode': 'reflection'}:
encodes: (TensorBBox,object) -&gt; encodes
(TensorPoint,object) -&gt; encodes
(Image,object) -&gt; encodes
decodes: 
</code></pre></div><p><code>size</code> can be an integer (in which case images will be resized to a square) or a tuple. Depending on the <a href="https://fastcore.fast.ai/foundation#method" target="_blank" rel="noopener noreferrer"><code>method</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <ul><li>we squish any rectangle to <code>size</code></li> <li>we resize so that the shorter dimension is a match an use padding with <code>pad_mode</code></li> <li>we resize so that the larger dimension is match and crop (randomly on the training set, center crop for the validation set)</li></ul> <p>When doing the resize, we use <code>resamples[0]</code> for images and <code>resamples[1]</code> for segmentation masks.</p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax<span class="token punctuation">,</span>method <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ResizeMethod<span class="token punctuation">.</span>Squish<span class="token punctuation">,</span> ResizeMethod<span class="token punctuation">.</span>Pad<span class="token punctuation">,</span> ResizeMethod<span class="token punctuation">.</span>Crop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rsz <span class="token operator">=</span> Resize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> method<span class="token operator">=</span>method<span class="token punctuation">)</span>
    show_image<span class="token punctuation">(</span>rsz<span class="token punctuation">(</span>img<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_62_0.png" alt="png"></p> <p>On the validation set, the crop is always a center crop (on the dimension that's cropped).</p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax<span class="token punctuation">,</span>method <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ResizeMethod<span class="token punctuation">.</span>Squish<span class="token punctuation">,</span> ResizeMethod<span class="token punctuation">.</span>Pad<span class="token punctuation">,</span> ResizeMethod<span class="token punctuation">.</span>Crop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rsz <span class="token operator">=</span> Resize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> method<span class="token operator">=</span>method<span class="token punctuation">)</span>
    show_image<span class="token punctuation">(</span>rsz<span class="token punctuation">(</span>img<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_64_0.png" alt="png"></p> <h3 id="RandomResizedCrop" class="doc_header"><code>class</code> <code>RandomResizedCrop</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L255" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RandomResizedCrop</code>(<strong><code>size</code></strong>, <strong><code>min_scale</code></strong>=<em><code>0.08</code></em>, <strong><code>ratio</code></strong>=<em><code>(0.75, 1.3333333333333333)</code></em>, <strong><code>resamples</code></strong>=<em><code>(2, 0)</code></em>, <strong><code>val_xtra</code></strong>=<em><code>0.14</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Picks a random scaled crop of an image and resize it to <code>size</code></p> <p>The crop picked as a random scale in range <code>(min_scale,1)</code> and <code>ratio</code> in the range passed, then the resize is done with <code>resamples[0]</code> for images and <code>resamples[1]</code> for segmentation masks. On the validation set, we center crop the image if it's ratio isn't in the range (to the minmum or maximum value) then resize.</p> <div class="language-python extra-class"><pre class="language-python"><code>crop <span class="token operator">=</span> RandomResizedCrop<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cropped <span class="token operator">=</span> crop<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    show_image<span class="token punctuation">(</span>cropped<span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_68_0.png" alt="png"></p> <p>Squish is used on the validation set, removing <code>val_xtra</code> proportion of each side first.</p> <div class="language-python extra-class"><pre class="language-python"><code>_<span class="token punctuation">,</span>axs <span class="token operator">=</span> subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>crop<span class="token punctuation">(</span>img<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_70_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>cropped<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="RatioResize" class="doc_header"><code>class</code> <code>RatioResize</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L293" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RatioResize</code>(<strong><code>max_sz</code></strong>, <strong><code>resamples</code></strong>=<em><code>(2, 0)</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="https://fastcore.fast.ai/transform#DisplayedTransform" target="_blank" rel="noopener noreferrer"><code>DisplayedTransform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Resizes the biggest dimension of an image to <code>max_sz</code> maintaining the aspect ratio</p> <div class="language-python extra-class"><pre class="language-python"><code>RatioResize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_74_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>RatioResize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>RatioResize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>dihedral<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="affine-and-coord-tfm-on-the-gpu"><a href="#affine-and-coord-tfm-on-the-gpu" class="header-anchor">#</a> Affine and coord tfm on the GPU</h2> <div class="language-python extra-class"><pre class="language-python"><code>timg <span class="token operator">=</span> TensorImage<span class="token punctuation">(</span>array<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> <span class="token function">_batch_ex</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> TensorImage<span class="token punctuation">(</span>timg<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span>bs<span class="token punctuation">,</span> <span class="token operator">*</span>timg<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">.</span>clone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="TensorImage.affine_coord" class="doc_header"><code>TensorImage.affine_coord</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L329" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.affine_coord</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong><code>mat</code></strong>=<em><code>None</code></em>, <strong><code>coord_tfm</code></strong>=<em><code>None</code></em>, <strong><code>sz</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h4 id="TensorMask.affine_coord" class="doc_header"><code>TensorMask.affine_coord</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L339" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorMask.affine_coord</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorMask"><code>TensorMask</code></a>, <strong><code>mat</code></strong>=<em><code>None</code></em>, <strong><code>coord_tfm</code></strong>=<em><code>None</code></em>, <strong><code>sz</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'nearest'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h4 id="TensorPoint.affine_coord" class="doc_header"><code>TensorPoint.affine_coord</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L348" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.affine_coord</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorPoint"><code>TensorPoint</code></a>, <strong><code>mat</code></strong>=<em><code>None</code></em>, <strong><code>coord_tfm</code></strong>=<em><code>None</code></em>, <strong><code>sz</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'nearest'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h4 id="TensorBBox.affine_coord" class="doc_header"><code>TensorBBox.affine_coord</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L357" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.affine_coord</code>(<strong><code>x</code></strong>:<a href="/fastai/vision.core.html#TensorBBox"><code>TensorBBox</code></a>, <strong><code>mat</code></strong>=<em><code>None</code></em>, <strong><code>coord_tfm</code></strong>=<em><code>None</code></em>, <strong><code>sz</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'nearest'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'zeros'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h3 id="AffineCoordTfm" class="doc_header"><code>class</code> <code>AffineCoordTfm</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L380" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>AffineCoordTfm</code>(<strong><code>aff_fs</code></strong>=<em><code>None</code></em>, <strong><code>coord_fs</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>mode_mask</code></strong>=<em><code>'nearest'</code></em>, <strong><code>align_corners</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Combine and apply affine and coord transforms</p> <p>Multipliy all the matrices returned by <code>aff_fs</code> before doing the corresponding affine transformation on a basic grid corresponding to <code>size</code>, then applies all <code>coord_fs</code> on the resulting flow of coordinates before finally doing an interpolation with <code>mode</code> and <code>pad_mode</code>.</p> <h4 id="AffineCoordTfm.compose" class="doc_header"><code>AffineCoordTfm.compose</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L395" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>AffineCoordTfm.compose</code>(<strong><code>tfm</code></strong>)</p></blockquote> <p>Compose <code>self</code> with another <a href="/fastai/vision.augment.html#AffineCoordTfm"><code>AffineCoordTfm</code></a> to only do the interpolation step once</p> <h3 id="RandomResizedCropGPU" class="doc_header"><code>class</code> <code>RandomResizedCropGPU</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L419" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RandomResizedCropGPU</code>(<strong><code>size</code></strong>, <strong><code>min_scale</code></strong>=<em><code>0.08</code></em>, <strong><code>ratio</code></strong>=<em><code>(0.75, 1.3333333333333333)</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>valid_scale</code></strong>=<em><code>1.0</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Picks a random scaled crop of an image and resize it to <code>size</code></p> <div class="language-python extra-class"><pre class="language-python"><code>t <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
rrc <span class="token operator">=</span> RandomResizedCropGPU<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> rrc<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_92_0.png" alt="png"></p> <h3 id="flip-dihedral-gpu-helpers"><a href="#flip-dihedral-gpu-helpers" class="header-anchor">#</a> Flip/Dihedral GPU helpers</h3> <h4 id="affine_mat" class="doc_header"><code>affine_mat</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L450" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>affine_mat</code>(<strong>*<code>ms</code></strong>)</p></blockquote> <p>Restructure length-6 vector <code>ms</code> into an affine matrix with 0,0,1 in the last line</p> <h4 id="mask_tensor" class="doc_header"><code>mask_tensor</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L457" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>mask_tensor</code>(<strong><code>x</code></strong>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>neutral</code></strong>=<em><code>0.0</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Mask elements of <code>x</code> with <code>neutral</code> with probability <code>1-p</code></p> <div class="language-python extra-class"><pre class="language-python"><code>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
def_draw <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t <span class="token operator">=</span> _draw_mask<span class="token punctuation">(</span>x<span class="token punctuation">,</span> def_draw<span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token operator">&lt;=</span> t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
t <span class="token operator">=</span> _draw_mask<span class="token punctuation">(</span>x<span class="token punctuation">,</span> def_draw<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token operator">&lt;=</span> t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
test_eq<span class="token punctuation">(</span>_draw_mask<span class="token punctuation">(</span>x<span class="token punctuation">,</span> def_draw<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>_draw_mask<span class="token punctuation">(</span>x<span class="token punctuation">,</span> def_draw<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> _draw_mask<span class="token punctuation">(</span>x<span class="token punctuation">,</span> def_draw<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> batch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>t<span class="token operator">==</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>t<span class="token operator">==</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="flip_mat" class="doc_header"><code>flip_mat</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L477" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>flip_mat</code>(<strong><code>x</code></strong>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Return a random flip matrix</p> <div class="language-python extra-class"><pre class="language-python"><code>x <span class="token operator">=</span> flip_mat<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#might fail with probability 2*2**(-100) (picked only 1s or -1s)</span>
</code></pre></div><h4 id="TensorImage.flip_batch" class="doc_header"><code>TensorImage.flip_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L493" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.flip_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <h4 id="TensorMask.flip_batch" class="doc_header"><code>TensorMask.flip_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L493" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorMask.flip_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <h4 id="TensorPoint.flip_batch" class="doc_header"><code>TensorPoint.flip_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L493" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.flip_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <h4 id="TensorBBox.flip_batch" class="doc_header"><code>TensorBBox.flip_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L493" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.flip_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code>t <span class="token operator">=</span> _pnt2tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> TensorImage<span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flip_batch<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>y<span class="token punctuation">,</span> _pnt2tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

pnts <span class="token operator">=</span> TensorPoint<span class="token punctuation">(</span><span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>pnts<span class="token punctuation">.</span>flip_batch<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

bbox <span class="token operator">=</span> TensorBBox<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>bbox<span class="token punctuation">.</span>flip_batch<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="Flip" class="doc_header"><code>class</code> <code>Flip</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L501" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Flip</code>(<strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#AffineCoordTfm"><code>AffineCoordTfm</code></a></p></blockquote> <p>Randomly flip a batch of images with a probability <code>p</code></p> <div class="language-python extra-class"><pre class="language-python"><code>Flip<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Flip -- {'p': 0.3, 'size': None, 'mode': 'bilinear', 'pad_mode': 'reflection', 'mode_mask': 'nearest', 'align_corners': True}:
encodes: (TensorBBox,object) -&gt; encodes
(TensorPoint,object) -&gt; encodes
(TensorImage,object) -&gt; encodes
(TensorMask,object) -&gt; encodes
decodes: 
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>flip <span class="token operator">=</span> Flip<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
t <span class="token operator">=</span> _pnt2tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> flip<span class="token punctuation">(</span>TensorImage<span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>y<span class="token punctuation">,</span> _pnt2tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

pnts <span class="token operator">=</span> TensorPoint<span class="token punctuation">(</span><span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>flip<span class="token punctuation">(</span>pnts<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

bbox <span class="token operator">=</span> TensorBBox<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>flip<span class="token punctuation">(</span>bbox<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="DeterministicDraw" class="doc_header"><code>class</code> <code>DeterministicDraw</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L508" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>DeterministicDraw</code>(<strong><code>vals</code></strong>)</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code>t <span class="token operator">=</span>  _batch_ex<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
draw <span class="token operator">=</span> DeterministicDraw<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span> test_eq<span class="token punctuation">(</span>draw<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="DeterministicFlip" class="doc_header"><code>class</code> <code>DeterministicFlip</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L516" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>DeterministicFlip</code>(<strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#Flip"><code>Flip</code></a></p></blockquote> <p>Flip the batch every other call</p> <div class="language-python extra-class"><pre class="language-python"><code>dih <span class="token operator">=</span> DeterministicFlip<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'p'</span><span class="token punctuation">:</span><span class="token number">.3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>t <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
dih <span class="token operator">=</span> DeterministicFlip<span class="token punctuation">(</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y <span class="token operator">=</span> dih<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Call </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_120_0.png" alt="png"></p> <h4 id="dihedral_mat" class="doc_header"><code>dihedral_mat</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L522" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>dihedral_mat</code>(<strong><code>x</code></strong>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Return a random dihedral matrix</p> <h4 id="TensorImage.dihedral_batch" class="doc_header"><code>TensorImage.dihedral_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L535" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.dihedral_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h4 id="TensorMask.dihedral_batch" class="doc_header"><code>TensorMask.dihedral_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L535" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorMask.dihedral_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h4 id="TensorPoint.dihedral_batch" class="doc_header"><code>TensorPoint.dihedral_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L535" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.dihedral_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h4 id="TensorBBox.dihedral_batch" class="doc_header"><code>TensorBBox.dihedral_batch</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L535" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.dihedral_batch</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>)</p></blockquote> <h3 id="Dihedral" class="doc_header"><code>class</code> <code>Dihedral</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L543" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Dihedral</code>(<strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#AffineCoordTfm"><code>AffineCoordTfm</code></a></p></blockquote> <p>Apply a random dihedral transformation to a batch of images with a probability <code>p</code></p> <p><code>draw</code> can be specified if you want to customize which flip is picked when the transform is applied (default is a random number between 0 and 7). It can be an integer between 0 and 7, a list of such integers (which then should have a length equal to the size of the batch) or a callable that returns an integer between 0 and 7.</p> <div class="language-python extra-class"><pre class="language-python"><code>t <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
dih <span class="token operator">=</span> Dihedral<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> dih<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
y <span class="token operator">=</span> t<span class="token punctuation">.</span>dihedral_batch<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Flip </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_131_0.png" alt="png"></p> <h3 id="DeterministicDihedral" class="doc_header"><code>class</code> <code>DeterministicDihedral</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L550" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>DeterministicDihedral</code>(<strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>None</code></em>) :: <a href="/fastai/vision.augment.html#Dihedral"><code>Dihedral</code></a></p></blockquote> <p>Apply a random dihedral transformation to a batch of images with a probability <code>p</code></p> <div class="language-python extra-class"><pre class="language-python"><code>t <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
dih <span class="token operator">=</span> DeterministicDihedral<span class="token punctuation">(</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y <span class="token operator">=</span> dih<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Call </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_134_0.png" alt="png"></p> <h4 id="rotate_mat" class="doc_header"><code>rotate_mat</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L556" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>rotate_mat</code>(<strong><code>x</code></strong>, <strong><code>max_deg</code></strong>=<em><code>10</code></em>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Return a random rotation matrix with <code>max_deg</code> and <code>p</code></p> <h4 id="TensorImage.rotate" class="doc_header"><code>TensorImage.rotate</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L565" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.rotate</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorMask.rotate" class="doc_header"><code>TensorMask.rotate</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L565" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorMask.rotate</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorPoint.rotate" class="doc_header"><code>TensorPoint.rotate</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L565" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.rotate</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorBBox.rotate" class="doc_header"><code>TensorBBox.rotate</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L565" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.rotate</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>pad_mode</code></strong>=<em><code>None</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Rotate" class="doc_header"><code>class</code> <code>Rotate</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L573" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Rotate</code>(<strong><code>max_deg</code></strong>=<em><code>10</code></em>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#AffineCoordTfm"><code>AffineCoordTfm</code></a></p></blockquote> <p>Apply a random rotation of at most <code>max_deg</code> with probability <code>p</code> to a batch of images</p> <p><code>draw</code> can be specified if you want to customize which angle is picked when the transform is applied (default is a random flaot between <code>-max_deg</code> and <code>max_deg</code>). It can be a float, a list of floats (which then should have a length equal to the size of the batch) or a callable that returns a float.</p> <div class="language-python extra-class"><pre class="language-python"><code>thetas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>draw<span class="token operator">=</span>thetas<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>thetas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> degrees'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_145_0.png" alt="png"></p> <h4 id="zoom_mat" class="doc_header"><code>zoom_mat</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L580" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>zoom_mat</code>(<strong><code>x</code></strong>, <strong><code>min_zoom</code></strong>=<em><code>1.0</code></em>, <strong><code>max_zoom</code></strong>=<em><code>1.1</code></em>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>draw_x</code></strong>=<em><code>None</code></em>, <strong><code>draw_y</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Return a random zoom matrix with <code>max_zoom</code> and <code>p</code></p> <h4 id="TensorImage.zoom" class="doc_header"><code>TensorImage.zoom</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L597" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.zoom</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorMask.zoom" class="doc_header"><code>TensorMask.zoom</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L597" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorMask.zoom</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorPoint.zoom" class="doc_header"><code>TensorPoint.zoom</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L597" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.zoom</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorBBox.zoom" class="doc_header"><code>TensorBBox.zoom</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L597" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.zoom</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Zoom" class="doc_header"><code>class</code> <code>Zoom</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L605" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Zoom</code>(<strong><code>min_zoom</code></strong>=<em><code>1.0</code></em>, <strong><code>max_zoom</code></strong>=<em><code>1.1</code></em>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>draw_x</code></strong>=<em><code>None</code></em>, <strong><code>draw_y</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>) :: <a href="/fastai/vision.augment.html#AffineCoordTfm"><code>AffineCoordTfm</code></a></p></blockquote> <p>Apply a random zoom of at most <code>max_zoom</code> with probability <code>p</code> to a batch of images</p> <p><code>draw</code>, <code>draw_x</code> and <code>draw_y</code> can be specified if you want to customize which scale and center are picked when the transform is applied (default is a random float between 1 and <code>max_zoom</code> for the first, between 0 and 1 for the last two). Each can be a float, a list of floats (which then should have a length equal to the size of the batch) or a callbale that returns a float.</p> <p><code>draw_x</code> and <code>draw_y</code> are expected to be the position of the center in pct, 0 meaning the most left/top possible and 1 meaning the most right/bottom possible.</p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span>
n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>scales<span class="token punctuation">)</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span>zoom<span class="token punctuation">(</span>draw<span class="token operator">=</span>scales<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw_x<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> draw_y<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Center zoom with different scales'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'scale </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_156_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zoom<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Constant scale and different random centers'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_157_0.png" alt="png"></p> <h3 id="warping"><a href="#warping" class="header-anchor">#</a> Warping</h3> <h4 id="find_coeffs" class="doc_header"><code>find_coeffs</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L613" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>find_coeffs</code>(<strong><code>p1</code></strong>, <strong><code>p2</code></strong>)</p></blockquote> <p>Find coefficients for warp tfm from <code>p1</code> to <code>p2</code></p> <h4 id="apply_perspective" class="doc_header"><code>apply_perspective</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L627" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>apply_perspective</code>(<strong><code>coords</code></strong>, <strong><code>coeffs</code></strong>)</p></blockquote> <p>Apply perspective tranfom on <code>coords</code> with <code>coeffs</code></p> <h4 id="TensorImage.warp" class="doc_header"><code>TensorImage.warp</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L662" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.warp</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorMask.warp" class="doc_header"><code>TensorMask.warp</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L662" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorMask.warp</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorPoint.warp" class="doc_header"><code>TensorPoint.warp</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L662" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorPoint.warp</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h4 id="TensorBBox.warp" class="doc_header"><code>TensorBBox.warp</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L662" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorBBox.warp</code>(<strong><code>x</code></strong>:<code>TensorBBox'&gt;)</code>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Warp" class="doc_header"><code>class</code> <code>Warp</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L672" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Warp</code>(<strong><code>magnitude</code></strong>=<em><code>0.2</code></em>, <strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>draw_x</code></strong>=<em><code>None</code></em>, <strong><code>draw_y</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>) :: <a href="/fastai/vision.augment.html#AffineCoordTfm"><code>AffineCoordTfm</code></a></p></blockquote> <p>Apply perspective warping with <code>magnitude</code> and <code>p</code> on a batch of matrices</p> <p><code>draw_x</code> and <code>draw_y</code> can be specified if you want to customize the magnitudes that are picked when the transform is applied (default is a random float between <code>-magnitude</code> and <code>magnitude</code>. Each can be a float, a list of floats (which then should have a length equal to the size of the batch) or a callable that returns a float.</p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">]</span>
warp <span class="token operator">=</span> Warp<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw_y<span class="token operator">=</span>scales<span class="token punctuation">,</span> draw_x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> warp<span class="token punctuation">(</span>_batch_ex<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Vertical warping'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'magnitude </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_172_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">]</span>
warp <span class="token operator">=</span> Warp<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw_x<span class="token operator">=</span>scales<span class="token punctuation">,</span> draw_y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> warp<span class="token punctuation">(</span>_batch_ex<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Horizontal warping'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'magnitude </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_173_0.png" alt="png"></p> <h2 id="lighting-transforms"><a href="#lighting-transforms" class="header-anchor">#</a> Lighting transforms</h2> <p>Lighting transforms are transforms that effect how light is represented in an image. These don't change the location of the object like previous transforms, but instead simulate how light could change in a scene. The <a href="https://arxiv.org/abs/2002.05709" target="_blank" rel="noopener noreferrer">simclr paper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> evaluates these transforms against other transforms for their use case of self-supurved image classification, note they use &quot;color&quot; and &quot;color distortion&quot; to refer to a combination of these transforms.</p> <h4 id="TensorImage.lighting" class="doc_header"><code>TensorImage.lighting</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L681" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.lighting</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong><code>func</code></strong>)</p></blockquote> <p>Most lighting transforms work better in &quot;logit space&quot;, as we do not want to blowout the image by going over maximum or minimum brightness. Taking the sigmoid of the logit allows us to get back to &quot;linear space.&quot;</p> <div class="language-python extra-class"><pre class="language-python"><code>x<span class="token operator">=</span>TensorImage<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">.01</span><span class="token operator">*</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f_lin<span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clamp<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#blue line</span>
f_log<span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token number">2</span><span class="token operator">*</span>x <span class="token comment">#red line</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>f_lin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span>x<span class="token punctuation">.</span>lighting<span class="token punctuation">(</span>f_log<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>[&lt;matplotlib.lines.Line2D at 0x7f12cc15e4d0&gt;,
 &lt;matplotlib.lines.Line2D at 0x7f13250a1d10&gt;]
</code></pre></div><p><img src="output_179_1.png" alt="png"></p> <p>The above graph shows the results of doing a contrast transformation in both linear and logit space. Notice how the blue linear plot has to be clamped, and we have lost information on how large 0.0 is by comparision to 0.2. While in the red plot the values curve, so we keep this relative information.</p> <h3 id="LightingTfm" class="doc_header"><code>class</code> <code>LightingTfm</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L686" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>LightingTfm</code>(<strong><code>fs</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Apply <code>fs</code> to the logits</p> <p>Brightness refers to the amount of light on a scene. This can be zero in which the image is completely black or one where the image is completely white. This may be especially useful if you expect your dataset to have over or under exposed images.</p> <h4 id="TensorImage.brightness" class="doc_header"><code>TensorImage.brightness</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L719" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.brightness</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Brightness" class="doc_header"><code>class</code> <code>Brightness</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L727" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Brightness</code>(<strong><code>max_lighting</code></strong>=<em><code>0.2</code></em>, <strong><code>p</code></strong>=<em><code>0.75</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#LightingTfm"><code>LightingTfm</code></a></p></blockquote> <p>Apply <code>fs</code> to the logits</p> <div class="language-python extra-class"><pre class="language-python"><code>Brightness<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Brightness -- {'p': 1.0, 'max_lighting': 0.5}:
encodes: (TensorImage,object) -&gt; encodes
decodes: 
</code></pre></div><p><code>draw</code> can be specified if you want to customize the magnitude that is picked when the transform is applied (default is a random float between <code>-0.5*(1-max_lighting)</code> and <code>0.5*(1+max_lighting)</code>. Each can be a float, a list of floats (which then should have a length equal to the size of the batch) or a callable that returns a float.</p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>brightness<span class="token punctuation">(</span>draw<span class="token operator">=</span>scales<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'scale </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_191_0.png" alt="png"></p> <p>Contrast pushes pixels to either the maximum or minimum values. The minimum value for contrast is a solid gray image. As an example take a picture of a bright light source in a dark room. Your eyes should be able to see some detail in the room, but the photo taken should instead have much higher contrast, with all of the detail in the background missing to the darkness. This is one example of what this transform can help simulate.</p> <h4 id="TensorImage.contrast" class="doc_header"><code>TensorImage.contrast</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L749" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.contrast</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Contrast" class="doc_header"><code>class</code> <code>Contrast</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L757" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Contrast</code>(<strong><code>max_lighting</code></strong>=<em><code>0.2</code></em>, <strong><code>p</code></strong>=<em><code>0.75</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#LightingTfm"><code>LightingTfm</code></a></p></blockquote> <p>Apply change in contrast of <code>max_lighting</code> to batch of images with probability <code>p</code>.</p> <p><code>draw</code> can be specified if you want to customize the magnitude that is picked when the transform is applied (default is a random float taken with the log uniform distribution between <code>(1-max_lighting)</code> and <code>1/(1-max_lighting)</code>. Each can be a float, a list of floats (which then should have a length equal to the size of the batch) or a callable that returns a float.</p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">,</span> <span class="token number">1.55</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contrast<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw<span class="token operator">=</span>scales<span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'scale </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_199_0.png" alt="png"></p> <h4 id="grayscale" class="doc_header"><code>grayscale</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L765" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>grayscale</code>(<strong><code>x</code></strong>)</p></blockquote> <p>Tensor to grayscale tensor. Uses the ITU-R 601-2 luma transform.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">'%.3f'</span> <span class="token operator">%</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.2989</span><span class="token punctuation">,</span><span class="token number">0.5870</span><span class="token punctuation">,</span><span class="token number">0.1140</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>'1.000'
</code></pre></div><p>The above is just one way to convert to grayscale. We chose this one because it was fast. Notice that the sum of the weight of each channel is 1.</p> <h4 id="TensorImage.saturation" class="doc_header"><code>TensorImage.saturation</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L790" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.saturation</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Saturation" class="doc_header"><code>class</code> <code>Saturation</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L798" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Saturation</code>(<strong><code>max_lighting</code></strong>=<em><code>0.2</code></em>, <strong><code>p</code></strong>=<em><code>0.75</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#LightingTfm"><code>LightingTfm</code></a></p></blockquote> <p>Apply change in saturation of <code>max_lighting</code> to batch of images with probability <code>p</code>.
Ref: https://pytorch.org/docs/stable/torchvision/transforms.html#torchvision.transforms.functional.adjust_saturation</p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saturation<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw<span class="token operator">=</span>scales<span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'scale </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_209_0.png" alt="png"></p> <p>Saturation controls the amount of color in the image, but not the lightness or darkness of an image. If has no effect on neutral colors such as whites,grays and blacks. At zero saturation you actually get a grayscale image. Pushing saturation past one causes more neutral colors to take on any underlying chromatic color.</p> <h4 id="rgb2hsv" class="doc_header"><code>rgb2hsv</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L808" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>rgb2hsv</code>(<strong><code>img</code></strong>)</p></blockquote> <p>Converts a RGB image to an HSV image.
Note: Will not work on logit space images.</p> <h4 id="hsv2rgb" class="doc_header"><code>hsv2rgb</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L833" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>hsv2rgb</code>(<strong><code>img</code></strong>)</p></blockquote> <p>Converts a HSV image to an RGB image.</p> <div class="language-python extra-class"><pre class="language-python"><code>fig<span class="token punctuation">,</span>axs<span class="token operator">=</span>plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ncols<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ax <span class="token keyword">in</span> axs<span class="token punctuation">:</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Hue'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Saturation'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

hsv<span class="token operator">=</span>torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2.1</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.05</span><span class="token punctuation">,</span><span class="token number">0.005</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">210</span><span class="token punctuation">,</span><span class="token number">210</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> ax<span class="token punctuation">,</span>i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>axs<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span> hsv<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mul_<span class="token punctuation">(</span><span class="token number">0.80</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'V='</span><span class="token operator">+</span><span class="token string">'%.1f'</span> <span class="token operator">%</span><span class="token number">0.8</span><span class="token operator">**</span>i<span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>hsv2rgb<span class="token punctuation">(</span>hsv<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_215_0.png" alt="png"></p> <p>For the Hue transform we are using hsv space instead of logit space. HSV stands for hue,saturation and value. Hue in hsv space just cycles through colors of the rainbow. Notices how there is no maximum, because the colors just repeat.</p> <p>Above are some examples of Hue(H) and Saturation(S) at various Values(V). One property of note in HSV space is that V controls the color you get at minimum saturation when in HSV space.</p> <h4 id="TensorImage.hue" class="doc_header"><code>TensorImage.hue</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L877" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>TensorImage.hue</code>(<strong><code>x</code></strong>:<a href="/fastai/torch_core.html#TensorImage"><code>TensorImage</code></a>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <h3 id="Hue" class="doc_header"><code>class</code> <code>Hue</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L885" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Hue</code>(<strong><code>max_hue</code></strong>=<em><code>0.1</code></em>, <strong><code>p</code></strong>=<em><code>0.75</code></em>, <strong><code>draw</code></strong>=<em><code>None</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Apply change in hue of <code>max_hue</code> to batch of images with probability <code>p</code>.
Ref: https://pytorch.org/docs/stable/torchvision/transforms.html#torchvision.transforms.functional.adjust_hue</p> <div class="language-python extra-class"><pre class="language-python"><code>scales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.75</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>scales<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hue<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> draw<span class="token operator">=</span>scales<span class="token punctuation">)</span>
fig<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>scales<span class="token punctuation">)</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'scale </span><span class="token interpolation"><span class="token punctuation">{</span>scales<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_222_0.png" alt="png"></p> <h2 id="randomerasing"><a href="#randomerasing" class="header-anchor">#</a> RandomErasing</h2> <p><a href="https://arxiv.org/pdf/1708.04896.pdf" target="_blank" rel="noopener noreferrer">Random Erasing Data Augmentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. This variant, designed by Ross Wightman, is applied to either a batch or single image tensor after it has been normalized.</p> <h4 id="cutout_gaussian" class="doc_header"><code>cutout_gaussian</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L895" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>cutout_gaussian</code>(<strong><code>x</code></strong>, <strong><code>areas</code></strong>)</p></blockquote> <p>Replace all <code>areas</code> in <code>x</code> with N(0,1) noise</p> <p>Since this should be applied after normalization, we'll define a helper to apply a function inside normalization.</p> <h4 id="norm_apply_denorm" class="doc_header"><code>norm_apply_denorm</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L902" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>norm_apply_denorm</code>(<strong><code>x</code></strong>, <strong><code>f</code></strong>, <strong><code>nrm</code></strong>)</p></blockquote> <p>Normalize <code>x</code> with <code>nrm</code>, then apply <code>f</code>, then denormalize</p> <div class="language-python extra-class"><pre class="language-python"><code>nrm <span class="token operator">=</span> Normalize<span class="token punctuation">.</span>from_stats<span class="token punctuation">(</span><span class="token operator">*</span>imagenet_stats<span class="token punctuation">,</span> cuda<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>f <span class="token operator">=</span> partial<span class="token punctuation">(</span>cutout_gaussian<span class="token punctuation">,</span> areas<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
show_image<span class="token punctuation">(</span>norm_apply_denorm<span class="token punctuation">(</span>timg<span class="token punctuation">,</span> f<span class="token punctuation">,</span> nrm<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="output_231_0.png" alt="png"></p> <h3 id="RandomErasing" class="doc_header"><code>class</code> <code>RandomErasing</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L914" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>RandomErasing</code>(<strong><code>p</code></strong>=<em><code>0.5</code></em>, <strong><code>sl</code></strong>=<em><code>0.0</code></em>, <strong><code>sh</code></strong>=<em><code>0.3</code></em>, <strong><code>min_aspect</code></strong>=<em><code>0.3</code></em>, <strong><code>max_count</code></strong>=<em><code>1</code></em>) :: <a href="/fastai/vision.augment.html#RandTransform"><code>RandTransform</code></a></p></blockquote> <p>Randomly selects a rectangle region in an image and randomizes its pixels.</p> <p><strong>Args:</strong></p> <ul><li>p: The probability that the Random Erasing operation will be performed</li> <li>sl: Minimum proportion of erased area</li> <li>sh: Maximum proportion of erased area</li> <li>min_aspect: Minimum aspect ratio of erased area</li> <li>max_count: maximum number of erasing blocks per image, area per box is scaled by count</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>tfm <span class="token operator">=</span> RandomErasing<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> max_count<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span>axs <span class="token operator">=</span> subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> partial<span class="token punctuation">(</span>tfm<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>norm_apply_denorm<span class="token punctuation">(</span>timg<span class="token punctuation">,</span> f<span class="token punctuation">,</span> nrm<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_236_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> norm_apply_denorm<span class="token punctuation">(</span>y<span class="token punctuation">,</span> f<span class="token punctuation">,</span> nrm<span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_237_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>tfm <span class="token operator">=</span> RandomErasing<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> max_count<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span>axs <span class="token operator">=</span> subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> partial<span class="token punctuation">(</span>tfm<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>norm_apply_denorm<span class="token punctuation">(</span>timg<span class="token punctuation">,</span> f<span class="token punctuation">,</span> nrm<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_238_0.png" alt="png"></p> <h2 id="all-together"><a href="#all-together" class="header-anchor">#</a> All together</h2> <h4 id="setup_aug_tfms" class="doc_header"><code>setup_aug_tfms</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L944" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>setup_aug_tfms</code>(<strong><code>tfms</code></strong>)</p></blockquote> <p>Go through <code>tfms</code> and combines together affine/coord or lighting transforms</p> <div class="language-python extra-class"><pre class="language-python"><code>tfms <span class="token operator">=</span> <span class="token punctuation">[</span>Rotate<span class="token punctuation">(</span>draw<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Zoom<span class="token punctuation">(</span>draw<span class="token operator">=</span><span class="token number">1.1</span><span class="token punctuation">,</span> draw_x<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> draw_y<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
comp <span class="token operator">=</span> setup_aug_tfms<span class="token punctuation">(</span><span class="token punctuation">[</span>Rotate<span class="token punctuation">(</span>draw<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Zoom<span class="token punctuation">(</span>draw<span class="token operator">=</span><span class="token number">1.1</span><span class="token punctuation">,</span> draw_x<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> draw_y<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
test_close<span class="token punctuation">(</span>comp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_get_affine_mat<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>tfms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_get_affine_mat<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> @ tfms<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_get_affine_mat<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#We can't test that the ouput of comp or the composition of tfms on x is the same cause it's not (1 interpol vs 2 sp)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>tfms <span class="token operator">=</span> <span class="token punctuation">[</span>Rotate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Zoom<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Warp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Brightness<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Flip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Contrast<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
comp <span class="token operator">=</span> setup_aug_tfms<span class="token punctuation">(</span>tfms<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>aff_tfm<span class="token punctuation">,</span>lig_tfm <span class="token operator">=</span> comp
test_eq<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>aff_tfm<span class="token punctuation">.</span>aff_fs<span class="token operator">+</span>aff_tfm<span class="token punctuation">.</span>coord_fs<span class="token operator">+</span>comp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>aff_tfm<span class="token punctuation">.</span>aff_fs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>aff_tfm<span class="token punctuation">.</span>coord_fs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lig_tfm<span class="token punctuation">.</span>fs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="aug_transforms" class="doc_header"><code>aug_transforms</code><a href="https://github.com/fastai/fastai/tree/master/fastai/vision/augment.py#L956" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>aug_transforms</code>(<strong><code>mult</code></strong>=<em><code>1.0</code></em>, <strong><code>do_flip</code></strong>=<em><code>True</code></em>, <strong><code>flip_vert</code></strong>=<em><code>False</code></em>, <strong><code>max_rotate</code></strong>=<em><code>10.0</code></em>, <strong><code>min_zoom</code></strong>=<em><code>1.0</code></em>, <strong><code>max_zoom</code></strong>=<em><code>1.1</code></em>, <strong><code>max_lighting</code></strong>=<em><code>0.2</code></em>, <strong><code>max_warp</code></strong>=<em><code>0.2</code></em>, <strong><code>p_affine</code></strong>=<em><code>0.75</code></em>, <strong><code>p_lighting</code></strong>=<em><code>0.75</code></em>, <strong><code>xtra_tfms</code></strong>=<em><code>None</code></em>, <strong><code>size</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'bilinear'</code></em>, <strong><code>pad_mode</code></strong>=<em><code>'reflection'</code></em>, <strong><code>align_corners</code></strong>=<em><code>True</code></em>, <strong><code>batch</code></strong>=<em><code>False</code></em>, <strong><code>min_scale</code></strong>=<em><code>1.0</code></em>)</p></blockquote> <p>Utility func to easily create a list of flip, rotate, zoom, warp, lighting transforms.</p> <p>Random flip (or dihedral if <code>flip_vert=True</code>) with <code>p=0.5</code> is added when <code>do_flip=True</code>. With <code>p_affine</code> we apply a random rotation of <code>max_rotate</code> degrees, a random zoom between <code>min_zoom</code> and <code>max_zoom</code> and a perspective warping of <code>max_warp</code>. With <code>p_lighting</code> we apply a change in brightness and contrast of <code>max_lighting</code>. Custon <code>xtra_tfms</code> can be added. <code>size</code>, <code>mode</code> and <code>pad_mode</code> will be used for the interpolation. <code>max_rotate,max_lighting,max_warp</code> are multiplied by <code>mult</code> so you can more easily increase or decrease augmentation with a single parameter.</p> <div class="language-python extra-class"><pre class="language-python"><code>tfms <span class="token operator">=</span> aug_transforms<span class="token punctuation">(</span>pad_mode<span class="token operator">=</span><span class="token string">'zeros'</span><span class="token punctuation">,</span> mult<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_scale<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> tfms<span class="token punctuation">:</span> y <span class="token operator">=</span> t<span class="token punctuation">(</span>y<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_249_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>tfms <span class="token operator">=</span> aug_transforms<span class="token punctuation">(</span>pad_mode<span class="token operator">=</span><span class="token string">'zeros'</span><span class="token punctuation">,</span> mult<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> batch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> _batch_ex<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> tfms<span class="token punctuation">:</span> y <span class="token operator">=</span> t<span class="token punctuation">(</span>y<span class="token punctuation">,</span> split_idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span>axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axs<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> show_image<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>ax<span class="token punctuation">)</span>
</code></pre></div><p><img src="output_250_0.png" alt="png"></p> <h2 id="integration-tests"><a href="#integration-tests" class="header-anchor">#</a> Integration tests</h2> <h3 id="segmentation"><a href="#segmentation" class="header-anchor">#</a> Segmentation</h3> <div class="language-python extra-class"><pre class="language-python"><code>camvid <span class="token operator">=</span> untar_data<span class="token punctuation">(</span>URLs<span class="token punctuation">.</span>CAMVID_TINY<span class="token punctuation">)</span>
fns <span class="token operator">=</span> get_image_files<span class="token punctuation">(</span>camvid<span class="token operator">/</span><span class="token string">'images'</span><span class="token punctuation">)</span>
cam_fn <span class="token operator">=</span> fns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
mask_fn <span class="token operator">=</span> camvid<span class="token operator">/</span><span class="token string">'labels'</span><span class="token operator">/</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>cam_fn<span class="token punctuation">.</span>stem<span class="token punctuation">}</span></span><span class="token string">_P</span><span class="token interpolation"><span class="token punctuation">{</span>cam_fn<span class="token punctuation">.</span>suffix<span class="token punctuation">}</span></span><span class="token string">'</span></span>
<span class="token keyword">def</span> <span class="token function">_cam_lbl</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> mask_fn
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>cam_dsrc <span class="token operator">=</span> Datasets<span class="token punctuation">(</span><span class="token punctuation">[</span>cam_fn<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">,</span> <span class="token punctuation">[</span>_cam_lbl<span class="token punctuation">,</span> PILMask<span class="token punctuation">.</span>create<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cam_tdl <span class="token operator">=</span> TfmdDL<span class="token punctuation">(</span>cam_dsrc<span class="token punctuation">.</span>train<span class="token punctuation">,</span> after_item<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                 after_batch<span class="token operator">=</span><span class="token punctuation">[</span>IntToFloatTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>aug_transforms<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bs<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
cam_tdl<span class="token punctuation">.</span>show_batch<span class="token punctuation">(</span>max_n<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_254_0.png" alt="png"></p> <h3 id="point-targets"><a href="#point-targets" class="header-anchor">#</a> Point targets</h3> <div class="language-python extra-class"><pre class="language-python"><code>mnist <span class="token operator">=</span> untar_data<span class="token punctuation">(</span>URLs<span class="token punctuation">.</span>MNIST_TINY<span class="token punctuation">)</span>
mnist_fn <span class="token operator">=</span> <span class="token string">'images/mnist3.png'</span>
pnts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_pnt_lbl</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">return</span> TensorPoint<span class="token punctuation">.</span>create<span class="token punctuation">(</span>pnts<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>pnt_dsrc <span class="token operator">=</span> Datasets<span class="token punctuation">(</span><span class="token punctuation">[</span>mnist_fn<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">,</span> Resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _pnt_lbl<span class="token punctuation">]</span><span class="token punctuation">)</span>
pnt_tdl <span class="token operator">=</span> TfmdDL<span class="token punctuation">(</span>pnt_dsrc<span class="token punctuation">.</span>train<span class="token punctuation">,</span> after_item<span class="token operator">=</span><span class="token punctuation">[</span>PointScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 after_batch<span class="token operator">=</span><span class="token punctuation">[</span>IntToFloatTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>aug_transforms<span class="token punctuation">(</span>max_warp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bs<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
pnt_tdl<span class="token punctuation">.</span>show_batch<span class="token punctuation">(</span>max_n<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_257_0.png" alt="png"></p> <h3 id="bounding-boxes"><a href="#bounding-boxes" class="header-anchor">#</a> Bounding boxes</h3> <div class="language-python extra-class"><pre class="language-python"><code>coco <span class="token operator">=</span> untar_data<span class="token punctuation">(</span>URLs<span class="token punctuation">.</span>COCO_TINY<span class="token punctuation">)</span>
images<span class="token punctuation">,</span> lbl_bbox <span class="token operator">=</span> get_annotations<span class="token punctuation">(</span>coco<span class="token operator">/</span><span class="token string">'train.json'</span><span class="token punctuation">)</span>
idx<span class="token operator">=</span><span class="token number">2</span>
coco_fn<span class="token punctuation">,</span>bbox <span class="token operator">=</span> coco<span class="token operator">/</span><span class="token string">'train'</span><span class="token operator">/</span>images<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span>lbl_bbox<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">_coco_bb</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> TensorBBox<span class="token punctuation">.</span>create<span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_coco_lbl</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>coco_dsrc <span class="token operator">=</span> Datasets<span class="token punctuation">(</span><span class="token punctuation">[</span>coco_fn<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>PILImage<span class="token punctuation">.</span>create<span class="token punctuation">,</span> <span class="token punctuation">[</span>_coco_bb<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>_coco_lbl<span class="token punctuation">,</span> MultiCategorize<span class="token punctuation">(</span>add_na<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_inp<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
coco_tdl <span class="token operator">=</span> TfmdDL<span class="token punctuation">(</span>coco_dsrc<span class="token punctuation">,</span> bs<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> after_item<span class="token operator">=</span><span class="token punctuation">[</span>BBoxLabeler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PointScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  after_batch<span class="token operator">=</span><span class="token punctuation">[</span>IntToFloatTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>aug_transforms<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

coco_tdl<span class="token punctuation">.</span>show_batch<span class="token punctuation">(</span>max_n<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="output_260_0.png" alt="png"></p> <div class="language-python extra-class"><pre class="language-python"><code>coco_tdl<span class="token punctuation">.</span>after_batch
</code></pre></div><div class="language- extra-class"><pre><code>Pipeline: IntToFloatTensor -- {'div': 255.0, 'div_mask': 1} -&gt; Flip -- {'p': 0.5, 'size': None, 'mode': 'bilinear', 'pad_mode': 'reflection', 'mode_mask': 'nearest', 'align_corners': True} -&gt; Brightness -- {'p': 1.0, 'max_lighting': 0.2}
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/fastai/assets/js/app.e4c088e4.js" defer></script><script src="/fastai/assets/js/2.f1c4f916.js" defer></script><script src="/fastai/assets/js/67.31ee059f.js" defer></script>
  </body>
</html>
