(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{359:function(t,a,s){"use strict";s.r(a);var e=s(42),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"learner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#learner"}},[t._v("#")]),t._v(" Learner")]),t._v(" "),s("blockquote",[s("p",[t._v("Basic class for handling the training loop")])]),t._v(" "),s("p",[t._v("You probably want to jump directly to the definition of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(".")],1),t._v(" "),s("h2",{attrs:{id:"utils-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utils-function"}},[t._v("#")]),t._v(" Utils function")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"replacing_yield"}},[s("code",[t._v("replacing_yield")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L29"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("replacing_yield")]),t._v("("),s("strong",[s("code",[t._v("o")])]),t._v(", "),s("strong",[s("code",[t._v("attr")])]),t._v(", "),s("strong",[s("code",[t._v("val")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Context manager to temporarily replace an attribute")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("_A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a\n    "),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@contextmanager")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("a_changed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" replacing_yield"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\na "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a_changed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    test_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"mk_metric"}},[s("code",[t._v("mk_metric")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L36"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("mk_metric")]),t._v("("),s("strong",[s("code",[t._v("m")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Convert "),s("code",[t._v("m")]),t._v(" to an "),s("RouterLink",{attrs:{to:"/learner.html#AvgMetric"}},[s("code",[t._v("AvgMetric")])]),t._v(", unless it's already a "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])])],1),t._v(" "),s("p",[t._v("See the class "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])]),t._v(" below for more information.")],1),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"save_model"}},[s("code",[t._v("save_model")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L41"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("save_model")]),t._v("("),s("strong",[s("code",[t._v("file")])]),t._v(", "),s("strong",[s("code",[t._v("model")])]),t._v(", "),s("strong",[s("code",[t._v("opt")])]),t._v(", "),s("strong",[s("code",[t._v("with_opt")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("pickle_protocol")])]),t._v("="),s("em",[s("code",[t._v("2")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Save "),s("code",[t._v("model")]),t._v(" to "),s("code",[t._v("file")]),t._v(" along with "),s("code",[t._v("opt")]),t._v(" (if available, and if "),s("code",[t._v("with_opt")]),t._v(")")]),t._v(" "),s("p",[s("code",[t._v("file")]),t._v(" can be a "),s("code",[t._v("Path")]),t._v(" object, a string or an opened file object. "),s("code",[t._v("pickle_protocol")]),t._v(" is passed along to "),s("code",[t._v("torch.save")])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"load_model"}},[s("code",[t._v("load_model")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L50"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("load_model")]),t._v("("),s("strong",[s("code",[t._v("file")])]),t._v(", "),s("strong",[s("code",[t._v("model")])]),t._v(", "),s("strong",[s("code",[t._v("opt")])]),t._v(", "),s("strong",[s("code",[t._v("with_opt")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("device")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("strict")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Load "),s("code",[t._v("model")]),t._v(" from "),s("code",[t._v("file")]),t._v(" along with "),s("code",[t._v("opt")]),t._v(" (if available, and if "),s("code",[t._v("with_opt")]),t._v(")")]),t._v(" "),s("p",[s("code",[t._v("file")]),t._v(" can be a "),s("code",[t._v("Path")]),t._v(" object, a string or an opened file object. If a "),s("code",[t._v("device")]),t._v(" is passed, the model is loaded on it, otherwise it's loaded on the CPU.")]),t._v(" "),s("p",[t._v("If "),s("code",[t._v("strict")]),t._v(" is "),s("code",[t._v("True")]),t._v(", the file must exactly contain weights for every parameter key in "),s("code",[t._v("model")]),t._v(", if "),s("code",[t._v("strict")]),t._v(" is "),s("code",[t._v("False")]),t._v(", only the keys that are in the saved model are loaded in "),s("code",[t._v("model")]),t._v(".")]),t._v(" "),s("h2",{staticClass:"doc_header",attrs:{id:"Learner"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("Learner")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L82"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner")]),t._v("("),s("strong",[s("code",[t._v("dls")])]),t._v(", "),s("strong",[s("code",[t._v("model")])]),t._v(", "),s("strong",[s("code",[t._v("loss_func")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("opt_func")])]),t._v("="),s("em",[s("code",[t._v("Adam")])]),t._v(", "),s("strong",[s("code",[t._v("lr")])]),t._v("="),s("em",[s("code",[t._v("0.001")])]),t._v(", "),s("strong",[s("code",[t._v("splitter")])]),t._v("="),s("em",[s("code",[t._v("trainable_params")])]),t._v(", "),s("strong",[s("code",[t._v("cbs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("metrics")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("path")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("model_dir")])]),t._v("="),s("em",[s("code",[t._v("'models'")])]),t._v(", "),s("strong",[s("code",[t._v("wd")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("wd_bn_bias")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("train_bn")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("moms")])]),t._v("="),s("em",[s("code",[t._v("(0.95, 0.85, 0.95)")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Group together a "),s("code",[t._v("model")]),t._v(", some "),s("code",[t._v("dls")]),t._v(" and a "),s("code",[t._v("loss_func")]),t._v(" to handle training")]),t._v(" "),s("p",[s("code",[t._v("opt_func")]),t._v(" will be used to create an optimizer when "),s("RouterLink",{attrs:{to:"/learner.html#Learner.fit"}},[s("code",[t._v("Learner.fit")])]),t._v(" is called, with "),s("code",[t._v("lr")]),t._v(" as a default learning rate. "),s("code",[t._v("splitter")]),t._v(" is a function that takes "),s("code",[t._v("self.model")]),t._v(" and returns a list of parameter groups (or just one parameter group if there are no different parameter groups). The default is "),s("RouterLink",{attrs:{to:"/torch_core.html#trainable_params"}},[s("code",[t._v("trainable_params")])]),t._v(", which returns all trainable parameters of the model.")],1),t._v(" "),s("p",[s("code",[t._v("cbs")]),t._v(" is one or a list of "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s  to pass to the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(". "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s are used for every tweak of the training loop. Each "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" is registered as an attribute of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" (with camel case). At creation, all the callbacks in "),s("a",{attrs:{href:"https://fastcore.fast.ai/foundation#defaults.callbacks",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("defaults.callbacks")]),s("OutboundLink")],1),t._v(" ("),s("RouterLink",{attrs:{to:"/callback.core.html#TrainEvalCallback"}},[s("code",[t._v("TrainEvalCallback")])]),t._v(", "),s("RouterLink",{attrs:{to:"/learner.html#Recorder"}},[s("code",[t._v("Recorder")])]),t._v(" and "),s("RouterLink",{attrs:{to:"/callback.progress.html#ProgressCallback"}},[s("code",[t._v("ProgressCallback")])]),t._v(") are associated to the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(".")],1),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/metrics.html"}},[s("code",[t._v("metrics")])]),t._v(" is an optional list of metrics, that can be either functions or "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])]),t._v("s (see below).")],1),t._v(" "),s("p",[s("code",[t._v("path")]),t._v(" and "),s("code",[t._v("model_dir")]),t._v(" are used to save and/or load models. Often "),s("code",[t._v("path")]),t._v(" will be inferred from "),s("code",[t._v("dls")]),t._v(", but you can override it or pass a "),s("code",[t._v("Path")]),t._v("  object to "),s("code",[t._v("model_dir")]),t._v(". Make sure you can write in "),s("code",[t._v("path/model_dir")]),t._v("!")]),t._v(" "),s("p",[s("code",[t._v("wd")]),t._v(" is the default weight decay used when training the model; "),s("code",[t._v("moms")]),t._v(", the default momentums used in "),s("RouterLink",{attrs:{to:"/callback.schedule.html#Learner.fit_one_cycle"}},[s("code",[t._v("Learner.fit_one_cycle")])]),t._v(". "),s("code",[t._v("wd_bn_bias")]),t._v(" controls if weight decay is applied to "),s("RouterLink",{attrs:{to:"/layers.html#BatchNorm"}},[s("code",[t._v("BatchNorm")])]),t._v(" layers and bias.")],1),t._v(" "),s("p",[t._v("Lastly, "),s("code",[t._v("train_bn")]),t._v(" controls if "),s("RouterLink",{attrs:{to:"/layers.html#BatchNorm"}},[s("code",[t._v("BatchNorm")])]),t._v(" layers are trained even when they are supposed to be frozen according to the "),s("code",[t._v("splitter")]),t._v(". Our empirical experiments have shown that it's the best behavior for those layers in transfer learning.")],1),t._v(" "),s("h3",{attrs:{id:"pytorch-interop"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pytorch-interop"}},[t._v("#")]),t._v(" PyTorch interop")]),t._v(" "),s("p",[t._v("You can use regular PyTorch functionality for most of the arguments of the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(", although the experience will be smoother with pure fastai objects and you will be able to use the full functionality of the library. The expectation is that the training loop will work smoothly even if you did not use fastai end to end. What you might lose are interpretation objects or showing functionality. The list below explains how to use plain PyTorch objects for all the arguments and what you might lose.")],1),t._v(" "),s("p",[t._v("The most important is "),s("code",[t._v("opt_func")]),t._v(". If you are not using a fastai optimizer, you will need to write a function that wraps your PyTorch optimizer in an "),s("RouterLink",{attrs:{to:"/optimizer.html#OptimWrapper"}},[s("code",[t._v("OptimWrapper")])]),t._v(". See the "),s("a",{attrs:{href:"http://docs.fast.ai/optimizer",target:"_blank",rel:"noopener noreferrer"}},[t._v("optimizer module"),s("OutboundLink")],1),t._v(" for more details. This is to ensure the library's schedulers/freeze API work with your code.")],1),t._v(" "),s("ul",[s("li",[s("code",[t._v("dls")]),t._v(" is a "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])]),t._v(" object, that you can create from standard PyTorch dataloaders. By doing so, you will lose all showing functionality like "),s("code",[t._v("show_batch")]),t._v("/"),s("code",[t._v("show_results")]),t._v(". You can check the "),s("a",{attrs:{href:"http://docs.fast.ai/tutorial.datablock",target:"_blank",rel:"noopener noreferrer"}},[t._v("data block API"),s("OutboundLink")],1),t._v(" or the "),s("a",{attrs:{href:"http://docs.fast.ai/tutorial.pets",target:"_blank",rel:"noopener noreferrer"}},[t._v("mid-level data API tutorial"),s("OutboundLink")],1),t._v(" to learn how to use fastai to gather your data!")],1),t._v(" "),s("li",[s("code",[t._v("model")]),t._v(" is a standard PyTorch model. You can use anyone you like, just make sure it accepts the number of inputs you have in your "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])]),t._v(" and returns as many outputs as you have targets.")],1),t._v(" "),s("li",[s("code",[t._v("loss_func")]),t._v(" can be any loss function you like. It needs to be one of fastai's if you want to use "),s("code",[t._v("Learn.predict")]),t._v(" or "),s("code",[t._v("Learn.get_preds")]),t._v(", or you will have to implement special methods (see more details after the "),s("RouterLink",{attrs:{to:"/layers.html#BaseLoss"}},[s("code",[t._v("BaseLoss")])]),t._v(" documentation).")],1)]),t._v(" "),s("p",[t._v("Now let's look at the main thing the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" class implements: the training loop.")],1),t._v(" "),s("h3",{attrs:{id:"training-loop"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#training-loop"}},[t._v("#")]),t._v(" Training loop")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.fit"}},[s("code",[t._v("Learner.fit")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L196"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.fit")]),t._v("("),s("strong",[s("code",[t._v("n_epoch")])]),t._v(", "),s("strong",[s("code",[t._v("lr")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("wd")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("cbs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("reset_opt")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Fit "),s("code",[t._v("self.model")]),t._v(" for "),s("code",[t._v("n_epoch")]),t._v(" using "),s("code",[t._v("cbs")]),t._v(". Optionally "),s("code",[t._v("reset_opt")]),t._v(".")]),t._v(" "),s("p",[t._v("Uses "),s("code",[t._v("lr")]),t._v(" and "),s("code",[t._v("wd")]),t._v(" if they are provided, otherwise use the defaults values given by the "),s("code",[t._v("lr")]),t._v(" and "),s("code",[t._v("wd")]),t._v(" attributes of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(".")],1),t._v(" "),s("p",[t._v("All the examples use "),s("RouterLink",{attrs:{to:"/test_utils.html#synth_learner"}},[s("code",[t._v("synth_learner")])]),t._v(" which is a simple "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" training a linear regression model.")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5e")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("yb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("one_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ninit_loss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" yb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("yb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("one_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nfinal_loss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" yb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" final_loss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" init_loss\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.one_batch"}},[s("code",[t._v("Learner.one_batch")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L173"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.one_batch")]),t._v("("),s("strong",[s("code",[t._v("i")])]),t._v(", "),s("strong",[s("code",[t._v("b")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Train or evaluate "),s("code",[t._v("self.model")]),t._v(" on batch "),s("code",[t._v("(xb,yb)")])]),t._v(" "),s("p",[t._v("This is an internal method called by "),s("RouterLink",{attrs:{to:"/learner.html#Learner.fit"}},[s("code",[t._v("Learner.fit")])]),t._v(". If passed, "),s("code",[t._v("i")]),t._v(" is the index of this iteration in the epoch. In training mode, this does a full training step on the batch (compute predictions, loss, gradients, update the model parameters and zero the gradients). In validation mode, it stops at the loss computation. Training or validation is controlled internally by the "),s("RouterLink",{attrs:{to:"/callback.core.html#TrainEvalCallback"}},[s("code",[t._v("TrainEvalCallback")])]),t._v(" through the "),s("code",[t._v("training")]),t._v(" attribute.")],1),t._v(" "),s("p",[t._v("Nothing is returned, but the attributes "),s("code",[t._v("x")]),t._v(", "),s("code",[t._v("y")]),t._v(", "),s("code",[t._v("pred")]),t._v(", "),s("code",[t._v("loss")]),t._v(" of the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" are set with the proper values:")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("one_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("one_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pred"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("More generally, the following attributes of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" are available and updated during the training loop:")],1),t._v(" "),s("ul",[s("li",[s("code",[t._v("model")]),t._v(": the model used for training/validation")]),t._v(" "),s("li",[s("code",[t._v("data")]),t._v(": the underlying "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])])],1),t._v(" "),s("li",[s("code",[t._v("loss_func")]),t._v(": the loss function used")]),t._v(" "),s("li",[s("code",[t._v("opt")]),t._v(": the optimizer used to update the model parameters")]),t._v(" "),s("li",[s("code",[t._v("opt_func")]),t._v(": the function used to create the optimizer")]),t._v(" "),s("li",[s("code",[t._v("cbs")]),t._v(": the list containing all "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s")],1),t._v(" "),s("li",[s("code",[t._v("dl")]),t._v(": current "),s("RouterLink",{attrs:{to:"/data.load.html#DataLoader"}},[s("code",[t._v("DataLoader")])]),t._v(" used for iteration")],1),t._v(" "),s("li",[s("code",[t._v("x")]),t._v("/"),s("code",[t._v("xb")]),t._v(": last input drawn from "),s("code",[t._v("self.dl")]),t._v(" (potentially modified by callbacks). "),s("code",[t._v("xb")]),t._v(" is always a tuple (potentially with one element) and "),s("code",[t._v("x")]),t._v(" is detuplified. You can only assign to "),s("code",[t._v("xb")]),t._v(".")]),t._v(" "),s("li",[s("code",[t._v("y")]),t._v("/"),s("code",[t._v("yb")]),t._v(": last target drawn from "),s("code",[t._v("self.dl")]),t._v(" (potentially modified by callbacks). "),s("code",[t._v("yb")]),t._v(" is always a tuple (potentially with one element) and "),s("code",[t._v("y")]),t._v(" is detuplified. You can only assign to "),s("code",[t._v("yb")]),t._v(".")]),t._v(" "),s("li",[s("code",[t._v("pred")]),t._v(": last predictions from "),s("code",[t._v("self.model")]),t._v(" (potentially modified by callbacks)")]),t._v(" "),s("li",[s("code",[t._v("loss")]),t._v(": last computed loss (potentially modified by callbacks)")]),t._v(" "),s("li",[s("code",[t._v("n_epoch")]),t._v(": the number of epochs in this training")]),t._v(" "),s("li",[s("code",[t._v("n_iter")]),t._v(": the number of iterations in the current "),s("code",[t._v("self.dl")])]),t._v(" "),s("li",[s("code",[t._v("epoch")]),t._v(": the current epoch index (from 0 to "),s("code",[t._v("n_epoch-1")]),t._v(")")]),t._v(" "),s("li",[s("code",[t._v("iter")]),t._v(": the current iteration index in "),s("code",[t._v("self.dl")]),t._v(" (from 0 to "),s("code",[t._v("n_iter-1")]),t._v(")")])]),t._v(" "),s("p",[t._v("The following attributes are added by "),s("RouterLink",{attrs:{to:"/callback.core.html#TrainEvalCallback"}},[s("code",[t._v("TrainEvalCallback")])]),t._v(" and should be available unless you went out of your way to remove that callback:")],1),t._v(" "),s("ul",[s("li",[s("code",[t._v("train_iter")]),t._v(": the number of training iterations done since the beginning of this training")]),t._v(" "),s("li",[s("code",[t._v("pct_train")]),t._v(": from 0. to 1., the percentage of training iterations completed")]),t._v(" "),s("li",[s("code",[t._v("training")]),t._v(":  flag to indicate if we're in training mode or not")])]),t._v(" "),s("p",[t._v("The following attribute is added by "),s("RouterLink",{attrs:{to:"/learner.html#Recorder"}},[s("code",[t._v("Recorder")])]),t._v(" and should be available unless you went out of your way to remove that callback:")],1),t._v(" "),s("ul",[s("li",[s("code",[t._v("smooth_loss")]),t._v(": an exponentially-averaged version of the training loss")])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.all_batches"}},[s("code",[t._v("Learner.all_batches")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L159"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.all_batches")]),t._v("()")])]),t._v(" "),s("p",[t._v("Train or evaluate "),s("code",[t._v("self.model")]),t._v(" on all the batches of "),s("code",[t._v("self.dl")])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.create_opt"}},[s("code",[t._v("Learner.create_opt")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L140"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.create_opt")]),t._v("()")])]),t._v(" "),s("p",[t._v("Create an optimizer with default hyper-parameters")]),t._v(" "),s("p",[t._v("This method is called internally to create the optimizer, the hyper-parameters are then adjusted by what you pass to "),s("RouterLink",{attrs:{to:"/learner.html#Learner.fit"}},[s("code",[t._v("Learner.fit")])]),t._v(" or your particular schedulers (see "),s("RouterLink",{attrs:{to:"/callback.schedule.html"}},[s("code",[t._v("callback.schedule")])]),t._v(").")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n_train"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cbs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("VerboseCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hypers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lr'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"serializing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serializing"}},[t._v("#")]),t._v(" Serializing")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.save"}},[s("code",[t._v("Learner.save")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L277"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.save")]),t._v("("),s("strong",[s("code",[t._v("file")])]),t._v(", "),s("strong",[s("code",[t._v("with_opt")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("pickle_protocol")])]),t._v("="),s("em",[s("code",[t._v("2")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Save model and optimizer state (if "),s("code",[t._v("with_opt")]),t._v(") to "),s("code",[t._v("self.path/self.model_dir/file")])]),t._v(" "),s("p",[s("code",[t._v("file")]),t._v(" can be a "),s("code",[t._v("Path")]),t._v(", a "),s("code",[t._v("string")]),t._v(" or a buffer. "),s("code",[t._v("pickle_protocol")]),t._v(" is passed along to "),s("code",[t._v("torch.save")]),t._v(".")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.load"}},[s("code",[t._v("Learner.load")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L283"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.load")]),t._v("("),s("strong",[s("code",[t._v("file")])]),t._v(", "),s("strong",[s("code",[t._v("with_opt")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("device")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("strict")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Load model and optimizer state (if "),s("code",[t._v("with_opt")]),t._v(") from "),s("code",[t._v("self.path/self.model_dir/file")]),t._v(" using "),s("code",[t._v("device")])]),t._v(" "),s("p",[s("code",[t._v("file")]),t._v(" can be a "),s("code",[t._v("Path")]),t._v(", a "),s("code",[t._v("string")]),t._v(" or a buffer. Use "),s("code",[t._v("device")]),t._v(" to load the model/optimizer state on a device different from the one it was saved.")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" tempfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TemporaryDirectory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Test save created a file")]),t._v("\n    learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tmp'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'models/tmp.pth'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Test load did load the model")]),t._v("\n    learn1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    learn1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tmp'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    test_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    test_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    test_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state_dict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state_dict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"callback-handling"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#callback-handling"}},[t._v("#")]),t._v(" Callback handling")]),t._v(" "),s("p",[t._v("We only describe the basic functionality linked to "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s here. To learn more about "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s an how to write them, check the "),s("a",{attrs:{href:"http://docs.fast.ai/callback.core",target:"_blank",rel:"noopener noreferrer"}},[t._v("callback.core"),s("OutboundLink")],1),t._v(" module documentation.")],1),t._v(" "),s("p",[t._v("Let's first see how the "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s become attributes of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(":")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TstCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("batch_begin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\ntst_learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst_learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("isinstance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst_learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("hasattr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst_learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'train_eval'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ntst_learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("TstCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst_learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("isinstance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst_learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TstCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("hasattr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst_learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tst'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("A name that becomes an existing attribute of the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" will throw an exception (here add_cb is a method of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(").")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AddCbCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\ntest_fail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("AddCbCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.__call__"}},[s("code",[t._v("Learner.__call__")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L133"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner."),s("strong",[t._v("call")])]),t._v("("),s("strong",[s("code",[t._v("event_name")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Call "),s("code",[t._v("event_name")]),t._v(" for all "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s in "),s("code",[t._v("self.cbs")])],1),t._v(" "),s("p",[t._v("This how the "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s are called internally. For instance a "),s("RouterLink",{attrs:{to:"/test_utils.html#VerboseCallback"}},[s("code",[t._v("VerboseCallback")])]),t._v(" just prints the event names (can be useful for debugging):")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("VerboseCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'after_fit'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("after_fit\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.add_cb"}},[s("code",[t._v("Learner.add_cb")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L104"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.add_cb")]),t._v("("),s("strong",[s("code",[t._v("cb")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Add "),s("code",[t._v("cb")]),t._v(" to the list of "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" and register "),s("code",[t._v("self")]),t._v(" as their learner")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("isinstance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train_eval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.add_cbs"}},[s("code",[t._v("Learner.add_cbs")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L102"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.add_cbs")]),t._v("("),s("strong",[s("code",[t._v("cbs")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Add "),s("code",[t._v("cbs")]),t._v(" to the list of "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" and register "),s("code",[t._v("self")]),t._v(" as their learner")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.added_cbs"}},[s("code",[t._v("Learner.added_cbs")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L119"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.added_cbs")]),t._v("("),s("strong",[s("code",[t._v("cbs")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Context manage that temporarily adds "),s("code",[t._v("cbs")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("added_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    test_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.ordered_cbs"}},[s("code",[t._v("Learner.ordered_cbs")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L131"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.ordered_cbs")]),t._v("("),s("strong",[s("code",[t._v("event")])]),t._v(")")])]),t._v(" "),s("p",[t._v("List of "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s, in order, for an "),s("code",[t._v("event")]),t._v(" in the training loop")],1),t._v(" "),s("p",[t._v("By order, we mean using the internal ordering of the "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v("s (see "),s("RouterLink",{attrs:{to:"/callback.core.html"}},[s("code",[t._v("callback.core")])]),t._v(" for more information on how it works).")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ordered_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'before_fit'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("[TrainEvalCallback, TestTrainEvalCallback]\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.remove_cb"}},[s("code",[t._v("Learner.remove_cb")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L112"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.remove_cb")]),t._v("("),s("strong",[s("code",[t._v("cb")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Add "),s("code",[t._v("cb")]),t._v(" from the list of "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" and deregister "),s("code",[t._v("self")]),t._v(" as their learner")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remove_cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("learn "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("getattr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_train_eval'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("code",[t._v("cb")]),t._v(" can simply be the class of the "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" we want to remove (in which case all instances of that callback are removed).")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remove_cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("getattr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_train_eval'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.remove_cbs"}},[s("code",[t._v("Learner.remove_cbs")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L103"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.remove_cbs")]),t._v("("),s("strong",[s("code",[t._v("cbs")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Remove "),s("code",[t._v("cbs")]),t._v(" from the list of "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" and deregister "),s("code",[t._v("self")]),t._v(" as their learner")],1),t._v(" "),s("p",[t._v("Elements of "),s("code",[t._v("cbs")]),t._v(" can either be types of callbacks or actual callbacks of the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(".")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remove_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.removed_cbs"}},[s("code",[t._v("Learner.removed_cbs")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L125"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.removed_cbs")]),t._v("("),s("strong",[s("code",[t._v("cbs")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Context manage that temporarily removes "),s("code",[t._v("cbs")])]),t._v(" "),s("p",[t._v("Elements of "),s("code",[t._v("cbs")]),t._v(" can either be types of callbacks or actual callbacks of the "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(".")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_cb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestTrainEvalCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("removed_cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    test_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.show_training_loop"}},[s("code",[t._v("Learner.show_training_loop")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L260"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.show_training_loop")]),t._v("()")])]),t._v(" "),s("p",[t._v("Show each step in the training loop")]),t._v(" "),s("p",[t._v("At each step, callbacks are shown in order, which can help debugging.")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("show_training_loop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("Start Fit\n   - before_fit     : [TrainEvalCallback]\n  Start Epoch Loop\n     - before_epoch   : []\n    Start Train\n       - before_train   : [TrainEvalCallback]\n      Start Batch Loop\n         - before_batch   : []\n         - after_pred     : []\n         - after_loss     : []\n         - before_backward: []\n         - after_backward : []\n         - after_step     : []\n         - after_cancel_batch: []\n         - after_batch    : [TrainEvalCallback]\n      End Batch Loop\n    End Train\n     - after_cancel_train: []\n     - after_train    : []\n    Start Valid\n       - before_validate: [TrainEvalCallback]\n      Start Batch Loop\n         - **CBs same as train batch**: []\n      End Batch Loop\n    End Valid\n     - after_cancel_validate: []\n     - after_validate : []\n  End Epoch Loop\n   - after_cancel_epoch: []\n   - after_epoch    : []\nEnd Fit\n - after_cancel_fit: []\n - after_fit      : []\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"before_batch_cb"}},[s("code",[t._v("before_batch_cb")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L326"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("before_batch_cb")]),t._v("("),s("strong",[s("code",[t._v("f")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Shortcut for creating a Callback on the "),s("code",[t._v("before_batch")]),t._v(" event, which takes and returns "),s("code",[t._v("xb,yb")])]),t._v(" "),s("p",[t._v("In order to change the data passed to your model, you will generally want to hook into the "),s("code",[t._v("before_batch")]),t._v(" event, like so:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TstCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("before_batch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n")])])]),s("p",[t._v("Since that is so common, we provide the "),s("RouterLink",{attrs:{to:"/learner.html#before_batch_cb"}},[s("code",[t._v("before_batch_cb")])]),t._v(" decorator to make it easier.")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@before_batch_cb")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" yb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" xb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("yb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n")])])]),s("h3",{staticClass:"doc_header",attrs:{id:"Metric"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("Metric")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L332"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Metric")]),t._v("()")])]),t._v(" "),s("p",[t._v("Blueprint for defining a metric")]),t._v(" "),s("p",[t._v("Metrics can be simple averages (like accuracy) but sometimes their computation is a little bit more complex and can't be averaged over batches (like precision or recall), which is why we need a special class for them. For simple functions that can be computed as averages over batches, we can use the class "),s("RouterLink",{attrs:{to:"/learner.html#AvgMetric"}},[s("code",[t._v("AvgMetric")])]),t._v(", otherwise you'll need to implement the following methods.\n{% include note.html content='If your "),s("code",[t._v("Metric")]),t._v(" has state depending on tensors, dont forget to store it on the CPU to avoid any potential memory leaks.' %}")],1),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Metric.reset"}},[s("code",[t._v("Metric.reset")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L334"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Metric.reset")]),t._v("()")])]),t._v(" "),s("p",[t._v("Reset inner state to prepare for new computation")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Metric.accumulate"}},[s("code",[t._v("Metric.accumulate")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L335"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Metric.accumulate")]),t._v("("),s("strong",[s("code",[t._v("learn")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Use "),s("code",[t._v("learn")]),t._v(" to update the state with new results")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Metric.value"}},[s("code",[t._v("Metric.value")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:""}},[t._v("[source]")])]),t._v(" "),s("p",[t._v("The value of the metric")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Metric.name"}},[s("code",[t._v("Metric.name")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:""}},[t._v("[source]")])]),t._v(" "),s("p",[t._v("Name of the "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])]),t._v(", camel-cased and with Metric removed")],1),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"AvgMetric"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("AvgMetric")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L357"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AvgMetric")]),t._v("("),s("strong",[s("code",[t._v("func")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])])],1)]),t._v(" "),s("p",[t._v("Average the values of "),s("code",[t._v("func")]),t._v(" taking into account potential different batch sizes")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntst "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AvgMetric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("abs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pred"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("u"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accumulate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("u"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("abs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{staticClass:"doc_header",attrs:{id:"AvgLoss"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("AvgLoss")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L371"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AvgLoss")]),t._v("() :: "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])])],1)]),t._v(" "),s("p",[t._v("Average the losses taking into account potential different batch sizes")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("tst "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AvgLoss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accumulate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{staticClass:"doc_header",attrs:{id:"AvgSmoothLoss"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("AvgSmoothLoss")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L384"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AvgSmoothLoss")]),t._v("("),s("strong",[s("code",[t._v("beta")])]),t._v("="),s("em",[s("code",[t._v("0.98")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])])],1)]),t._v(" "),s("p",[t._v("Smooth average of the losses (exponentially weighted with "),s("code",[t._v("beta")]),t._v(")")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("tst "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AvgSmoothLoss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nval "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accumulate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.98")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.98")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    test_close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.98")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{staticClass:"doc_header",attrs:{id:"ValueMetric"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("ValueMetric")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L395"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("ValueMetric")]),t._v("("),s("strong",[s("code",[t._v("func")])]),t._v(", "),s("strong",[s("code",[t._v("metric_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/learner.html#Metric"}},[s("code",[t._v("Metric")])])],1)]),t._v(" "),s("p",[t._v("Use to include a pre-calculated metric value (for insance calculated in a "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(") and returned by "),s("code",[t._v("func")])],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("metric_value_fn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5e")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\nvm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ValueMetric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("metric_value_fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'custom_value_metric'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5e")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'custom_value_metric'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nvm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ValueMetric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("metric_value_fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'metric_value_fn'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{staticClass:"doc_header",attrs:{id:"Recorder"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("Recorder")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L413"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder")]),t._v("("),s("strong",[s("code",[t._v("add_time")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("train_metrics")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("valid_metrics")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("beta")])]),t._v("="),s("em",[s("code",[t._v("0.98")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])])],1)]),t._v(" "),s("p",[t._v("Callback that registers statistics (lr, loss and metrics) during training")]),t._v(" "),s("p",[t._v("By default, metrics are computed on the validation set only, although that can be changed by adjusting "),s("code",[t._v("train_metrics")]),t._v(" and "),s("code",[t._v("valid_metrics")]),t._v(". "),s("code",[t._v("beta")]),t._v(" is the weight used to compute the exponentially weighted average of the losses (which gives the "),s("code",[t._v("smooth_loss")]),t._v(" attribute to "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(").")],1),t._v(" "),s("p",[t._v("The "),s("code",[t._v("logger")]),t._v(" attribute of a "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" determines what happens to those metrics. By default, it just print them:")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tst_metric")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" targ"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" F"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mse_loss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" targ"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n_train"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" metrics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tst_metric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npat "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("r\"[tensor\\(\\d.\\d*\\), tensor\\(\\d.\\d*\\), tensor\\(\\d.\\d*\\), 'dd:dd']\"")]),t._v("\ntest_stdout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" regex"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"internals"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#internals"}},[t._v("#")]),t._v(" Internals")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Recorder.before_fit"}},[s("code",[t._v("Recorder.before_fit")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L421"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder.before_fit")]),t._v("()")])]),t._v(" "),s("p",[t._v("Prepare state for training")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Recorder.before_epoch"}},[s("code",[t._v("Recorder.before_epoch")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L444"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder.before_epoch")]),t._v("()")])]),t._v(" "),s("p",[t._v("Set timer if "),s("code",[t._v("self.add_time=True")])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Recorder.before_validate"}},[s("code",[t._v("Recorder.before_validate")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L451"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder.before_validate")]),t._v("()")])]),t._v(" "),s("p",[t._v("Reset loss and metrics state")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Recorder.after_batch"}},[s("code",[t._v("Recorder.after_batch")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L434"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder.after_batch")]),t._v("()")])]),t._v(" "),s("p",[t._v("Update all metrics and records lr and smooth loss in training")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Recorder.after_epoch"}},[s("code",[t._v("Recorder.after_epoch")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L457"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder.after_epoch")]),t._v("()")])]),t._v(" "),s("p",[t._v("Store and log the loss/metric values")]),t._v(" "),s("h3",{attrs:{id:"plotting-tools"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plotting-tools"}},[t._v("#")]),t._v(" Plotting tools")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Recorder.plot_loss"}},[s("code",[t._v("Recorder.plot_loss")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L475"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Recorder.plot_loss")]),t._v("("),s("strong",[s("code",[t._v("skip_start")])]),t._v("="),s("em",[s("code",[t._v("5")])]),t._v(", "),s("strong",[s("code",[t._v("with_valid")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Plot the losses from "),s("code",[t._v("skip_start")]),t._v(" and onward")]),t._v(" "),s("h2",{attrs:{id:"inference-functions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inference-functions"}},[t._v("#")]),t._v(" Inference functions")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.validate"}},[s("code",[t._v("Learner.validate")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L216"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.validate")]),t._v("("),s("strong",[s("code",[t._v("ds_idx")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("dl")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("cbs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Validate on "),s("code",[t._v("dl")]),t._v(" with potential new "),s("code",[t._v("cbs")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n_train"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" metrics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tst_metric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("valid_ds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tensors\ntest_close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" F"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mse_loss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.get_preds"}},[s("code",[t._v("Learner.get_preds")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L221"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.get_preds")]),t._v("("),s("strong",[s("code",[t._v("ds_idx")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("dl")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("with_input")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("with_decoded")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("with_loss")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("act")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("inner")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("reorder")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("cbs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("save_preds")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("save_targs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("concat_dim")])]),t._v("="),s("em",[s("code",[t._v("0")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Get the predictions and targets on the "),s("code",[t._v("ds_idx")]),t._v("-th dbunchset or "),s("code",[t._v("dl")]),t._v(", optionally "),s("code",[t._v("with_input")]),t._v(" and "),s("code",[t._v("with_loss")])]),t._v(" "),s("p",[s("code",[t._v("with_decoded")]),t._v(" will also return the decoded predictions using the "),s("code",[t._v("decodes")]),t._v(" function of the loss function (if it exists). For instance, fastai's "),s("code",[t._v("CrossEntropyFlat")]),t._v(" takes the argmax or predictions in its decodes.")]),t._v(" "),s("p",[t._v("Depending on the "),s("code",[t._v("loss_func")]),t._v(" attribute of "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(", an activation function will be picked automatically so that the predictions make sense. For instance if the loss is a case of cross-entropy, a softmax will be applied, or if the loss is binary cross entropy with logits, a sigmoid will be applied. If you want to make sure a certain activation function is applied, you can pass it with "),s("code",[t._v("act")]),t._v(".")],1),t._v(" "),s("p",[s("code",[t._v("save_preds")]),t._v(" and "),s("code",[t._v("save_targs")]),t._v(" should be used when your predictions are too big to fit all in memory. Give a "),s("code",[t._v("Path")]),t._v(" object that points to a folder where the predictions and targets will be saved.")]),t._v(" "),s("p",[s("code",[t._v("concat_dim")]),t._v(" is the batch dimension, where all the tensors will be concatenated.")]),t._v(" "),s("p",[s("code",[t._v("inner")]),t._v(" is an internal attribute that tells "),s("code",[t._v("get_preds")]),t._v(" it's called internally, inside another training loop, to avoid recursion errors.")]),t._v(" "),s("p",[t._v("{% include note.html content='If you want to use the option "),s("code",[t._v("with_loss=True")]),t._v(" on a custom loss function, make sure you have implemented a "),s("code",[t._v("reduction")]),t._v(" attribute that supports none ' %}")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n_train"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" metrics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tst_metric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npreds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("targs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_preds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("valid_ds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tensors\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("targs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("preds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\npreds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("targs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_preds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("act "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sigmoid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("targs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("preds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sigmoid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.predict"}},[s("code",[t._v("Learner.predict")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L243"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.predict")]),t._v("("),s("strong",[s("code",[t._v("item")])]),t._v(", "),s("strong",[s("code",[t._v("rm_type_tfms")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("with_input")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Prediction on "),s("code",[t._v("item")]),t._v(", fully decoded, loss function decoded and probabilities")]),t._v(" "),s("p",[t._v("It returns a tuple of three elements with, in reverse order,")]),t._v(" "),s("ul",[s("li",[t._v("the prediction from the model, potentially passed through the activation of the loss function (if it has one)")]),t._v(" "),s("li",[t._v("the decoded prediction, using the potential "),s("code",[t._v("decodes")]),t._v(" method from it")]),t._v(" "),s("li",[t._v("the fully decoded prediction, using the transforms used to build the "),s("RouterLink",{attrs:{to:"/data.core.html#Datasets"}},[s("code",[t._v("Datasets")])]),t._v("/"),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])])],1)]),t._v(" "),s("p",[s("code",[t._v("rm_type_tfms")]),t._v(" is a deprecated argument that should not be used and will be removed in a future version. "),s("code",[t._v("with_input")]),t._v(" will add the decoded inputs to the result.")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("_FakeLossFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    reduction "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forward")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" F"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mse_loss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("activation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("x\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("_Add1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Transform"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    \nlearn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n_train"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TfmdDL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Datasets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tfms "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("L"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_Add1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dls "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DataLoaders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loss_func "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _FakeLossFunc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detach"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#applying model + activation")]),t._v("\ndec "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("out                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#decodes from loss function")]),t._v("\nfull_dec "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dec"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("                   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#decodes from _Add1")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("full_dec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" with_input"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("inp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("full_dec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.show_results"}},[s("code",[t._v("Learner.show_results")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L254"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.show_results")]),t._v("("),s("strong",[s("code",[t._v("ds_idx")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("dl")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("max_n")])]),t._v("="),s("em",[s("code",[t._v("9")])]),t._v(", "),s("strong",[s("code",[t._v("shuffle")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[t._v("**"),s("code",[t._v("kwargs")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Show some predictions on "),s("code",[t._v("ds_idx")]),t._v("-th dataset or "),s("code",[t._v("dl")])]),t._v(" "),s("p",[t._v("Will show "),s("code",[t._v("max_n")]),t._v(" samples (unless the batch size of "),s("code",[t._v("ds_idx")]),t._v(" or "),s("code",[t._v("dl")]),t._v(" is less than "),s("code",[t._v("max_n")]),t._v(", in which case it will show as many samples) and "),s("code",[t._v("shuffle")]),t._v(" the data unless you pass "),s("code",[t._v("false")]),t._v(" to that flag. "),s("code",[t._v("kwargs")]),t._v(" are application-dependant.")]),t._v(" "),s("p",[t._v("We can't show an example on our synthetic "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(", but check all the beginners tutorials which will show you how that method works across applications.")],1),t._v(" "),s("p",[t._v("The last functions in this section are used internally for inference, but should be less useful to you.")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.no_logging"}},[s("code",[t._v("Learner.no_logging")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L267"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.no_logging")]),t._v("()")])]),t._v(" "),s("p",[t._v("Context manager to temporarily remove "),s("code",[t._v("logger")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n_train"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" metrics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tst_metric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("no_logging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    test_stdout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.loss_not_reduced"}},[s("code",[t._v("Learner.loss_not_reduced")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L272"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.loss_not_reduced")]),t._v("()")])]),t._v(" "),s("p",[t._v("A context manager to evaluate "),s("code",[t._v("loss_func")]),t._v(" with reduction set to none.")]),t._v(" "),s("p",[t._v("This requires your loss function to either have a "),s("code",[t._v("reduction")]),t._v(" attribute or a "),s("code",[t._v("reduction")]),t._v(" argument (like all fastai and PyTorch loss functions).")]),t._v(" "),s("h2",{attrs:{id:"transfer-learning"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#transfer-learning"}},[t._v("#")]),t._v(" Transfer learning")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.freeze_to"}},[s("code",[t._v("Learner.freeze_to")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L496"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.freeze_to")]),t._v("("),s("strong",[s("code",[t._v("n")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Freeze parameter groups up to "),s("code",[t._v("n")])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.freeze"}},[s("code",[t._v("Learner.freeze")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L502"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.freeze")]),t._v("()")])]),t._v(" "),s("p",[t._v("Freeze up to last parameter group")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.unfreeze"}},[s("code",[t._v("Learner.unfreeze")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L505"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.unfreeze")]),t._v("()")])]),t._v(" "),s("p",[t._v("Unfreeze the entire model")]),t._v(" "),s("h3",{attrs:{id:"exporting-a-learner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exporting-a-learner"}},[t._v("#")]),t._v(" Exporting a "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])])],1),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.export"}},[s("code",[t._v("Learner.export")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L514"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.export")]),t._v("("),s("strong",[s("code",[t._v("fname")])]),t._v("="),s("em",[s("code",[t._v("'export.pkl'")])]),t._v(", "),s("strong",[s("code",[t._v("pickle_protocol")])]),t._v("="),s("em",[s("code",[t._v("2")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Export the content of "),s("code",[t._v("self")]),t._v(" without the items and the optimizer state for inference")]),t._v(" "),s("p",[t._v("The "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" is saved in "),s("code",[t._v("self.path/fname")]),t._v(", using "),s("code",[t._v("pickle_protocol")]),t._v(". Note that serialization in Python saves the names of functions, not the code itself. Therefore, any custom code you have for models, data transformation, loss function etc... should be put in a module that you will import in your training environment before exporting, and in your deployment environment before loading it.")],1),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"load_learner"}},[s("code",[t._v("load_learner")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L532"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("load_learner")]),t._v("("),s("strong",[s("code",[t._v("fname")])]),t._v(", "),s("strong",[s("code",[t._v("cpu")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Load a "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" object in "),s("code",[t._v("fname")]),t._v(", optionally putting it on the "),s("code",[t._v("cpu")])],1),t._v(" "),s("p",[t._v("{% include warning.html content='"),s("RouterLink",{attrs:{to:"/learner.html#load_learner"}},[s("code",[t._v("load_learner")])]),t._v(" requires all your custom code be in the exact same place as when exporting your "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" (the main script, or the module you imported it from).' %}")],1),t._v(" "),s("h2",{attrs:{id:"tta"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tta"}},[t._v("#")]),t._v(" TTA")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.tta"}},[s("code",[t._v("Learner.tta")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L554"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.tta")]),t._v("("),s("strong",[s("code",[t._v("ds_idx")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("dl")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("n")])]),t._v("="),s("em",[s("code",[t._v("4")])]),t._v(", "),s("strong",[s("code",[t._v("item_tfms")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("batch_tfms")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("beta")])]),t._v("="),s("em",[s("code",[t._v("0.25")])]),t._v(", "),s("strong",[s("code",[t._v("use_max")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Return predictions on the "),s("code",[t._v("ds_idx")]),t._v(" dataset or "),s("code",[t._v("dl")]),t._v(" using Test Time Augmentation")]),t._v(" "),s("p",[t._v("In practice, we get the predictions "),s("code",[t._v("n")]),t._v(" times with the transforms of the training set and average those. The final predictions are "),s("code",[t._v("(1-beta)")]),t._v(" multiplied by this average + "),s("code",[t._v("beta")]),t._v(" multiplied by the predictions obtained with the transforms of the dataset. Set "),s("code",[t._v("beta")]),t._v(" to "),s("code",[t._v("None")]),t._v(" to get a tuple of the predictions and tta results. You can also use the maximum of all predictions instead of an average by setting "),s("code",[t._v("use_max=True")]),t._v(".")]),t._v(" "),s("p",[t._v("If you want to use new transforms, you can pass them with "),s("code",[t._v("item_tfms")]),t._v(" and "),s("code",[t._v("batch_tfms")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"gather-arguments"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gather-arguments"}},[t._v("#")]),t._v(" Gather arguments")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"Learner.gather_args"}},[s("code",[t._v("Learner.gather_args")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/learner.py#L579"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Learner.gather_args")]),t._v("()")])]),t._v(" "),s("p",[t._v("Gather config parameters accessible to the learner")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" synth_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1e")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init_args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Learner.__init__.lr'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);