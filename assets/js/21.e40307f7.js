(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{387:function(t,a,s){"use strict";s.r(a);var e=s(42),o=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"collaborative-filtering"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#collaborative-filtering"}},[t._v("#")]),t._v(" Collaborative filtering")]),t._v(" "),s("blockquote",[s("p",[t._v("Tools to quickly get the data and train models suitable for collaborative filtering")])]),t._v(" "),s("p",[t._v("This module contains all the high-level functions you need in a collaborative filtering application to assemble your data, get a model and train it with a "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(". We will go other those in order but you can also check the "),s("a",{attrs:{href:"http://docs.fast.ai/tutorial.collab",target:"_blank",rel:"noopener noreferrer"}},[t._v("collaborative filtering tutorial"),s("OutboundLink")],1),t._v(".")],1),t._v(" "),s("h2",{attrs:{id:"gather-the-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gather-the-data"}},[t._v("#")]),t._v(" Gather the data")]),t._v(" "),s("h2",{staticClass:"doc_header",attrs:{id:"TabularCollab"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("TabularCollab")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L9"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("TabularCollab")]),t._v("("),s("strong",[s("code",[t._v("df")])]),t._v(", "),s("strong",[s("code",[t._v("procs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("cat_names")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("cont_names")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("y_names")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("y_block")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("splits")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("do_setup")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("device")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("inplace")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("reduce_memory")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/tabular.core.html#TabularPandas"}},[s("code",[t._v("TabularPandas")])])],1)]),t._v(" "),s("p",[t._v("Instance of "),s("RouterLink",{attrs:{to:"/tabular.core.html#TabularPandas"}},[s("code",[t._v("TabularPandas")])]),t._v(" suitable for collaborative filtering (with no continuous variable)")],1),t._v(" "),s("p",[t._v("This is just to use the internal of the tabular application, don't worry about it.")]),t._v(" "),s("h2",{staticClass:"doc_header",attrs:{id:"CollabDataLoaders"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("CollabDataLoaders")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L14"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("CollabDataLoaders")]),t._v("("),s("strong",[t._v("*"),s("code",[t._v("loaders")])]),t._v(", "),s("strong",[s("code",[t._v("path")])]),t._v("="),s("em",[s("code",[t._v("'.'")])]),t._v(", "),s("strong",[s("code",[t._v("device")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])])],1)]),t._v(" "),s("p",[t._v("Base "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])]),t._v(" for collaborative filtering.")],1),t._v(" "),s("p",[t._v("This class should not be used directly, one of the factory methods should be preferred instead. All those factory methods accept as arguments:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("valid_pct")]),t._v(": the random percentage of the dataset to set aside for validation (with an optional "),s("code",[t._v("seed")]),t._v(")")]),t._v(" "),s("li",[s("code",[t._v("user_name")]),t._v(": the name of the column containing the user (defaults to the first column)")]),t._v(" "),s("li",[s("code",[t._v("item_name")]),t._v(": the name of the column containing the item (defaults to the second column)")]),t._v(" "),s("li",[s("code",[t._v("rating_name")]),t._v(": the name of the column containing the rating (defaults to the third column)")]),t._v(" "),s("li",[s("code",[t._v("path")]),t._v(": the folder where to work")]),t._v(" "),s("li",[s("code",[t._v("bs")]),t._v(": the batch size")]),t._v(" "),s("li",[s("code",[t._v("val_bs")]),t._v(": the batch size for the validation "),s("RouterLink",{attrs:{to:"/data.load.html#DataLoader"}},[s("code",[t._v("DataLoader")])]),t._v(" (defaults to "),s("code",[t._v("bs")]),t._v(")")],1),t._v(" "),s("li",[s("code",[t._v("shuffle_train")]),t._v(": if we shuffle the training "),s("RouterLink",{attrs:{to:"/data.load.html#DataLoader"}},[s("code",[t._v("DataLoader")])]),t._v(" or not")],1),t._v(" "),s("li",[s("code",[t._v("device")]),t._v(": the PyTorch device to use (defaults to "),s("code",[t._v("default_device()")]),t._v(")")])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"CollabDataLoaders.from_df"}},[s("code",[t._v("CollabDataLoaders.from_df")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L16"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("CollabDataLoaders.from_df")]),t._v("("),s("strong",[s("code",[t._v("ratings")])]),t._v(", "),s("strong",[s("code",[t._v("valid_pct")])]),t._v("="),s("em",[s("code",[t._v("0.2")])]),t._v(", "),s("strong",[s("code",[t._v("user_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("item_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("rating_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("seed")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("path")])]),t._v("="),s("em",[s("code",[t._v("'.'")])]),t._v(", "),s("strong",[s("code",[t._v("bs")])]),t._v("="),s("em",[s("code",[t._v("64")])]),t._v(", "),s("strong",[s("code",[t._v("val_bs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("shuffle_train")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("device")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Create a "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])]),t._v(" suitable for collaborative filtering from "),s("code",[t._v("ratings")]),t._v(".")],1),t._v(" "),s("p",[t._v("Let's see how this works on an example:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" untar_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("URLs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ML_SAMPLE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nratings "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_csv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ratings.csv'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nratings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",[s("style",{attrs:{scoped:""}},[t._v('\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\x3c!--beforebegin--\x3e<div class="language- extra-class">\x3c!--afterbegin--\x3e<pre><code>.dataframe tbody tr th {\n    vertical-align: top;\n}\n\n.dataframe thead th {\n    text-align: right;\n}\n</code></pre>\n\x3c!--beforeend--\x3e</div>\x3c!--afterend--\x3e')]),t._v(" "),s("table",{staticClass:"dataframe",attrs:{border:"1"}},[s("thead",[s("tr",{staticStyle:{"text-align":"right"}},[s("th"),t._v(" "),s("th",[t._v("userId")]),t._v(" "),s("th",[t._v("movieId")]),t._v(" "),s("th",[t._v("rating")]),t._v(" "),s("th",[t._v("timestamp")])])]),t._v(" "),s("tbody",[s("tr",[s("th",[t._v("0")]),t._v(" "),s("td",[t._v("73")]),t._v(" "),s("td",[t._v("1097")]),t._v(" "),s("td",[t._v("4.0")]),t._v(" "),s("td",[t._v("1255504951")])]),t._v(" "),s("tr",[s("th",[t._v("1")]),t._v(" "),s("td",[t._v("561")]),t._v(" "),s("td",[t._v("924")]),t._v(" "),s("td",[t._v("3.5")]),t._v(" "),s("td",[t._v("1172695223")])]),t._v(" "),s("tr",[s("th",[t._v("2")]),t._v(" "),s("td",[t._v("157")]),t._v(" "),s("td",[t._v("260")]),t._v(" "),s("td",[t._v("3.5")]),t._v(" "),s("td",[t._v("1291598691")])]),t._v(" "),s("tr",[s("th",[t._v("3")]),t._v(" "),s("td",[t._v("358")]),t._v(" "),s("td",[t._v("1210")]),t._v(" "),s("td",[t._v("5.0")]),t._v(" "),s("td",[t._v("957481884")])]),t._v(" "),s("tr",[s("th",[t._v("4")]),t._v(" "),s("td",[t._v("130")]),t._v(" "),s("td",[t._v("316")]),t._v(" "),s("td",[t._v("2.0")]),t._v(" "),s("td",[t._v("1138999234")])])])])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("dls "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CollabDataLoaders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_df"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ratings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("show_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("table",{staticClass:"dataframe",attrs:{border:"1"}},[s("thead",[s("tr",{staticStyle:{"text-align":"right"}},[s("th"),t._v(" "),s("th",[t._v("userId")]),t._v(" "),s("th",[t._v("movieId")]),t._v(" "),s("th",[t._v("rating")])])]),t._v(" "),s("tbody",[s("tr",[s("th",[t._v("0")]),t._v(" "),s("td",[t._v("157")]),t._v(" "),s("td",[t._v("1265")]),t._v(" "),s("td",[t._v("3.0")])]),t._v(" "),s("tr",[s("th",[t._v("1")]),t._v(" "),s("td",[t._v("130")]),t._v(" "),s("td",[t._v("2858")]),t._v(" "),s("td",[t._v("2.0")])]),t._v(" "),s("tr",[s("th",[t._v("2")]),t._v(" "),s("td",[t._v("481")]),t._v(" "),s("td",[t._v("1196")]),t._v(" "),s("td",[t._v("5.0")])]),t._v(" "),s("tr",[s("th",[t._v("3")]),t._v(" "),s("td",[t._v("105")]),t._v(" "),s("td",[t._v("597")]),t._v(" "),s("td",[t._v("3.5")])]),t._v(" "),s("tr",[s("th",[t._v("4")]),t._v(" "),s("td",[t._v("128")]),t._v(" "),s("td",[t._v("597")]),t._v(" "),s("td",[t._v("5.0")])]),t._v(" "),s("tr",[s("th",[t._v("5")]),t._v(" "),s("td",[t._v("587")]),t._v(" "),s("td",[t._v("5952")]),t._v(" "),s("td",[t._v("4.0")])]),t._v(" "),s("tr",[s("th",[t._v("6")]),t._v(" "),s("td",[t._v("111")]),t._v(" "),s("td",[t._v("2571")]),t._v(" "),s("td",[t._v("5.0")])]),t._v(" "),s("tr",[s("th",[t._v("7")]),t._v(" "),s("td",[t._v("105")]),t._v(" "),s("td",[t._v("356")]),t._v(" "),s("td",[t._v("3.0")])]),t._v(" "),s("tr",[s("th",[t._v("8")]),t._v(" "),s("td",[t._v("77")]),t._v(" "),s("td",[t._v("5349")]),t._v(" "),s("td",[t._v("4.0")])]),t._v(" "),s("tr",[s("th",[t._v("9")]),t._v(" "),s("td",[t._v("119")]),t._v(" "),s("td",[t._v("1240")]),t._v(" "),s("td",[t._v("4.0")])])])]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"CollabDataLoaders.from_csv"}},[s("code",[t._v("CollabDataLoaders.from_csv")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L28"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("CollabDataLoaders.from_csv")]),t._v("("),s("strong",[s("code",[t._v("csv")])]),t._v(", "),s("strong",[s("code",[t._v("valid_pct")])]),t._v("="),s("em",[s("code",[t._v("0.2")])]),t._v(", "),s("strong",[s("code",[t._v("user_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("item_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("rating_name")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("seed")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("path")])]),t._v("="),s("em",[s("code",[t._v("'.'")])]),t._v(", "),s("strong",[s("code",[t._v("bs")])]),t._v("="),s("em",[s("code",[t._v("64")])]),t._v(", "),s("strong",[s("code",[t._v("val_bs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("shuffle_train")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("device")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Create a "),s("RouterLink",{attrs:{to:"/data.core.html#DataLoaders"}},[s("code",[t._v("DataLoaders")])]),t._v(" suitable for collaborative filtering from "),s("code",[t._v("csv")]),t._v(".")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("dls "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CollabDataLoaders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_csv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ratings.csv'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"models"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#models"}},[t._v("#")]),t._v(" Models")]),t._v(" "),s("p",[t._v("fastai provides two kinds of models for collaborative filtering: a dot-product model and a neural net.")]),t._v(" "),s("h2",{staticClass:"doc_header",attrs:{id:"EmbeddingDotBias"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("EmbeddingDotBias")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L36"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("EmbeddingDotBias")]),t._v("("),s("strong",[s("code",[t._v("n_factors")])]),t._v(", "),s("strong",[s("code",[t._v("n_users")])]),t._v(", "),s("strong",[s("code",[t._v("n_items")])]),t._v(", "),s("strong",[s("code",[t._v("y_range")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/torch_core.html#Module"}},[s("code",[t._v("Module")])])],1)]),t._v(" "),s("p",[t._v("Base dot model for collaborative filtering.")]),t._v(" "),s("p",[t._v("The model is built with "),s("code",[t._v("n_factors")]),t._v(" (the length of the internal vectors), "),s("code",[t._v("n_users")]),t._v(" and "),s("code",[t._v("n_items")]),t._v(". For a given user and item, it grabs the corresponding weights and bias and returns")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user_w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" item_w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" user_b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" item_b\n")])])]),s("p",[t._v("Optionally, if "),s("code",[t._v("y_range")]),t._v(" is passed, it applies a "),s("RouterLink",{attrs:{to:"/layers.html#SigmoidRange"}},[s("code",[t._v("SigmoidRange")])]),t._v(" to that result.")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("one_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmodel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" EmbeddingDotBias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'userId'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'movieId'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y_range"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"EmbeddingDotBias.from_classes"}},[s("code",[t._v("EmbeddingDotBias.from_classes")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L51"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("EmbeddingDotBias.from_classes")]),t._v("("),s("strong",[s("code",[t._v("n_factors")])]),t._v(", "),s("strong",[s("code",[t._v("classes")])]),t._v(", "),s("strong",[s("code",[t._v("user")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("item")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("y_range")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Build a model with "),s("code",[t._v("n_factors")]),t._v(" by inferring "),s("code",[t._v("n_users")]),t._v(" and  "),s("code",[t._v("n_items")]),t._v(" from "),s("code",[t._v("classes")])]),t._v(" "),s("p",[s("code",[t._v("y_range")]),t._v(" is passed to the main init. "),s("code",[t._v("user")]),t._v(" and "),s("code",[t._v("item")]),t._v(" are the names of the keys for users and items in "),s("code",[t._v("classes")]),t._v(" (default to the first and second key respectively). "),s("code",[t._v("classes")]),t._v(" is expected to be a dictionary key to list of categories like the result of "),s("code",[t._v("dls.classes")]),t._v(" in a "),s("RouterLink",{attrs:{to:"/collab.html#CollabDataLoaders"}},[s("code",[t._v("CollabDataLoaders")])]),t._v(":")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classes\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("{'userId': (#101) ['#na#',15,17,19,23,30,48,56,73,77...],\n 'movieId': (#101) ['#na#',1,10,32,34,39,47,50,110,150...]}\n")])])]),s("p",[t._v("Let's see how it can be used in practice:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("model "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" EmbeddingDotBias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_classes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  y_range"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                                     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Two convenience methods are added to easily access the weights and bias when a model is created with "),s("RouterLink",{attrs:{to:"/collab.html#EmbeddingDotBias.from_classes"}},[s("code",[t._v("EmbeddingDotBias.from_classes")])]),t._v(":")],1),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"EmbeddingDotBias.weight"}},[s("code",[t._v("EmbeddingDotBias.weight")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L76"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("EmbeddingDotBias.weight")]),t._v("("),s("strong",[s("code",[t._v("arr")])]),t._v(", "),s("strong",[s("code",[t._v("is_item")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Weight for item or user (based on "),s("code",[t._v("is_item")]),t._v(") for all in "),s("code",[t._v("arr")])]),t._v(" "),s("p",[t._v("The elements of "),s("code",[t._v("arr")]),t._v(" are expected to be class names (which is why the model needs to be created with "),s("RouterLink",{attrs:{to:"/collab.html#EmbeddingDotBias.from_classes"}},[s("code",[t._v("EmbeddingDotBias.from_classes")])]),t._v(")")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("mov "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'movieId'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \nw "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mov"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("i_weight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"EmbeddingDotBias.bias"}},[s("code",[t._v("EmbeddingDotBias.bias")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L70"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("EmbeddingDotBias.bias")]),t._v("("),s("strong",[s("code",[t._v("arr")])]),t._v(", "),s("strong",[s("code",[t._v("is_item")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Bias for item or user (based on "),s("code",[t._v("is_item")]),t._v(") for all in "),s("code",[t._v("arr")])]),t._v(" "),s("p",[t._v("The elements of "),s("code",[t._v("arr")]),t._v(" are expected to be class names (which is why the model needs to be created with "),s("RouterLink",{attrs:{to:"/collab.html#EmbeddingDotBias.from_classes"}},[s("code",[t._v("EmbeddingDotBias.from_classes")])]),t._v(")")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("mov "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'movieId'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \nb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mov"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("i_bias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{staticClass:"doc_header",attrs:{id:"EmbeddingNN"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("EmbeddingNN")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L83"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("EmbeddingNN")]),t._v("("),s("strong",[s("code",[t._v("emb_szs")])]),t._v(", "),s("strong",[s("code",[t._v("layers")])]),t._v(", "),s("strong",[s("code",[t._v("ps")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("embed_p")])]),t._v("="),s("em",[s("code",[t._v("0.0")])]),t._v(", "),s("strong",[s("code",[t._v("y_range")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("use_bn")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("bn_final")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("bn_cont")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/tabular.model.html#TabularModel"}},[s("code",[t._v("TabularModel")])])],1)]),t._v(" "),s("p",[t._v("Subclass "),s("RouterLink",{attrs:{to:"/tabular.model.html#TabularModel"}},[s("code",[t._v("TabularModel")])]),t._v(" to create a NN suitable for collaborative filtering.")],1),t._v(" "),s("p",[s("code",[t._v("emb_szs")]),t._v(" should be a list of two tuples, one for the users, one for the items, each tuple containing the number of users/items and the corresponding embedding size (the function "),s("RouterLink",{attrs:{to:"/tabular.model.html#get_emb_sz"}},[s("code",[t._v("get_emb_sz")])]),t._v(" can give a good default). All the other arguments are passed to "),s("RouterLink",{attrs:{to:"/tabular.model.html#TabularModel"}},[s("code",[t._v("TabularModel")])]),t._v(".")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("emb_szs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_emb_sz"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train_ds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmodel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" EmbeddingNN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("emb_szs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y_range"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"create-a-learner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-learner"}},[t._v("#")]),t._v(" Create a "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])])],1),t._v(" "),s("p",[t._v("The following function lets us quickly create a "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" for collaborative filtering from the data.")],1),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"collab_learner"}},[s("code",[t._v("collab_learner")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/collab.py#L90"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("collab_learner")]),t._v("("),s("strong",[s("code",[t._v("dls")])]),t._v(", "),s("strong",[s("code",[t._v("n_factors")])]),t._v("="),s("em",[s("code",[t._v("50")])]),t._v(", "),s("strong",[s("code",[t._v("use_nn")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("emb_szs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("layers")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("config")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("y_range")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("loss_func")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("opt_func")])]),t._v("="),s("em",[s("code",[t._v("Adam")])]),t._v(", "),s("strong",[s("code",[t._v("lr")])]),t._v("="),s("em",[s("code",[t._v("0.001")])]),t._v(", "),s("strong",[s("code",[t._v("splitter")])]),t._v("="),s("em",[s("code",[t._v("trainable_params")])]),t._v(", "),s("strong",[s("code",[t._v("cbs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("metrics")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("path")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("model_dir")])]),t._v("="),s("em",[s("code",[t._v("'models'")])]),t._v(", "),s("strong",[s("code",[t._v("wd")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("wd_bn_bias")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("train_bn")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("moms")])]),t._v("="),s("em",[s("code",[t._v("(0.95, 0.85, 0.95)")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Create a Learner for collaborative filtering on "),s("code",[t._v("dls")]),t._v(".")]),t._v(" "),s("p",[t._v("If "),s("code",[t._v("use_nn=False")]),t._v(", the model used is an "),s("RouterLink",{attrs:{to:"/collab.html#EmbeddingDotBias"}},[s("code",[t._v("EmbeddingDotBias")])]),t._v(" with "),s("code",[t._v("n_factors")]),t._v(" and "),s("code",[t._v("y_range")]),t._v(". Otherwise, it's a "),s("RouterLink",{attrs:{to:"/collab.html#EmbeddingNN"}},[s("code",[t._v("EmbeddingNN")])]),t._v(" for which you can pass "),s("code",[t._v("emb_szs")]),t._v(" (will be inferred from the "),s("code",[t._v("dls")]),t._v(" with "),s("RouterLink",{attrs:{to:"/tabular.model.html#get_emb_sz"}},[s("code",[t._v("get_emb_sz")])]),t._v(" if you don't provide any), "),s("RouterLink",{attrs:{to:"/layers.html"}},[s("code",[t._v("layers")])]),t._v(" (defaults to "),s("code",[t._v("[n_factors]")]),t._v(") "),s("code",[t._v("y_range")]),t._v(", and a "),s("code",[t._v("config")]),t._v(" that you can create with "),s("RouterLink",{attrs:{to:"/tabular.model.html#tabular_config"}},[s("code",[t._v("tabular_config")])]),t._v(" to customize your model.")],1),t._v(" "),s("p",[s("code",[t._v("loss_func")]),t._v(" will default to "),s("RouterLink",{attrs:{to:"/layers.html#MSELossFlat"}},[s("code",[t._v("MSELossFlat")])]),t._v(" and all the other arguments are passed to "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(".")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" collab_learner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y_range"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fit_one_cycle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("table",{staticClass:"dataframe",attrs:{border:"1"}},[s("thead",[s("tr",{staticStyle:{"text-align":"left"}},[s("th",[t._v("epoch")]),t._v(" "),s("th",[t._v("train_loss")]),t._v(" "),s("th",[t._v("valid_loss")]),t._v(" "),s("th",[t._v("time")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("0")]),t._v(" "),s("td",[t._v("2.521979")]),t._v(" "),s("td",[t._v("2.541627")]),t._v(" "),s("td",[t._v("00:00")])])])])])}),[],!1,null,null,null);a.default=o.exports}}]);