(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{388:function(t,e,s){"use strict";s.r(e);var a=s(42),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"gan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gan"}},[t._v("#")]),t._v(" GAN")]),t._v(" "),s("blockquote",[s("p",[t._v("Basic support for "),s("a",{attrs:{href:"https://arxiv.org/abs/1406.2661"}},[t._v("Generative Adversarial Networks")])])]),t._v(" "),s("p",[t._v("GAN stands for "),s("a",{attrs:{href:"https://arxiv.org/pdf/1406.2661.pdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Generative Adversarial Nets"),s("OutboundLink")],1),t._v(" and were invented by Ian Goodfellow. The concept is that we train two models at the same time: a generator and a critic. The generator will try to make new images similar to the ones in a dataset, and the critic will try to classify real images from the ones the generator does. The generator returns images, the critic a single number (usually a probability, 0. for fake images and 1. for real ones).")]),t._v(" "),s("p",[t._v("We train them against each other in the sense that at each step (more or less), we:")]),t._v(" "),s("ol",[s("li",[t._v("Freeze the generator and train the critic for one step by:")])]),t._v(" "),s("ul",[s("li",[t._v("getting one batch of true images (let's call that "),s("code",[t._v("real")]),t._v(")")]),t._v(" "),s("li",[t._v("generating one batch of fake images (let's call that "),s("code",[t._v("fake")]),t._v(")")]),t._v(" "),s("li",[t._v("have the critic evaluate each batch and compute a loss function from that; the important part is that it rewards positively the detection of real images and penalizes the fake ones")]),t._v(" "),s("li",[t._v("update the weights of the critic with the gradients of this loss")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Freeze the critic and train the generator for one step by:")])]),t._v(" "),s("ul",[s("li",[t._v("generating one batch of fake images")]),t._v(" "),s("li",[t._v("evaluate the critic on it")]),t._v(" "),s("li",[t._v("return a loss that rewards positively the critic thinking those are real images")]),t._v(" "),s("li",[t._v("update the weights of the generator with the gradients of this loss")])]),t._v(" "),s("p",[t._v("{% include note.html content='The fastai library provides support for training GANs through the GANTrainer, but doesnâ€™t include more than basic models.' %}")]),t._v(" "),s("h2",{attrs:{id:"wrapping-the-modules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wrapping-the-modules"}},[t._v("#")]),t._v(" Wrapping the modules")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"GANModule"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("GANModule")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L13"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("GANModule")]),t._v("("),s("strong",[s("code",[t._v("generator")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("critic")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("gen_mode")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/torch_core.html#Module"}},[s("code",[t._v("Module")])])],1)]),t._v(" "),s("p",[t._v("Wrapper around a "),s("code",[t._v("generator")]),t._v(" and a "),s("code",[t._v("critic")]),t._v(" to create a GAN.")]),t._v(" "),s("p",[t._v("This is just a shell to contain the two models. When called, it will either delegate the input to the "),s("code",[t._v("generator")]),t._v(" or the "),s("code",[t._v("critic")]),t._v(" depending of the value of "),s("code",[t._v("gen_mode")]),t._v(".")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"GANModule.switch"}},[s("code",[t._v("GANModule.switch")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L23"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("GANModule.switch")]),t._v("("),s("strong",[s("code",[t._v("gen_mode")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Put the module in generator mode if "),s("code",[t._v("gen_mode")]),t._v(", in critic mode otherwise.")]),t._v(" "),s("p",[t._v("By default (leaving "),s("code",[t._v("gen_mode")]),t._v(" to "),s("code",[t._v("None")]),t._v("), this will put the module in the other mode (critic mode if it was in generator mode and vice versa).")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"basic_critic"}},[s("code",[t._v("basic_critic")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L28"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("basic_critic")]),t._v("("),s("strong",[s("code",[t._v("in_size")])]),t._v(", "),s("strong",[s("code",[t._v("n_channels")])]),t._v(", "),s("strong",[s("code",[t._v("n_features")])]),t._v("="),s("em",[s("code",[t._v("64")])]),t._v(", "),s("strong",[s("code",[t._v("n_extra_layers")])]),t._v("="),s("em",[s("code",[t._v("0")])]),t._v(", "),s("strong",[s("code",[t._v("norm_type")])]),t._v("="),s("em",[s("code",[t._v("<NormType.Batch: 1>")])]),t._v(", "),s("strong",[s("code",[t._v("ks")])]),t._v("="),s("em",[s("code",[t._v("3")])]),t._v(", "),s("strong",[s("code",[t._v("stride")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("padding")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("bias")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("ndim")])]),t._v("="),s("em",[s("code",[t._v("2")])]),t._v(", "),s("strong",[s("code",[t._v("bn_1st")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("act_cls")])]),t._v("="),s("em",[s("code",[t._v("ReLU")])]),t._v(", "),s("strong",[s("code",[t._v("transpose")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("init")])]),t._v("="),s("em",[s("code",[t._v("'auto'")])]),t._v(", "),s("strong",[s("code",[t._v("xtra")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("bias_std")])]),t._v("="),s("em",[s("code",[t._v("0.01")])]),t._v(", "),s("strong",[s("code",[t._v("dilation")])]),t._v(":"),s("code",[t._v("Union")]),t._v("["),s("code",[t._v("int")]),t._v(", "),s("code",[t._v("Tuple")]),t._v("["),s("code",[t._v("int")]),t._v(", "),s("code",[t._v("int")]),t._v("]]="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("groups")])]),t._v(":"),s("code",[t._v("int")]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("padding_mode")])]),t._v(":"),s("code",[t._v("str")]),t._v("="),s("em",[s("code",[t._v("'zeros'")])]),t._v(")")])]),t._v(" "),s("p",[t._v("A basic critic for images "),s("code",[t._v("n_channels")]),t._v(" x "),s("code",[t._v("in_size")]),t._v(" x "),s("code",[t._v("in_size")]),t._v(".")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"AddChannels"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("AddChannels")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L42"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AddChannels")]),t._v("("),s("strong",[s("code",[t._v("n_dim")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/torch_core.html#Module"}},[s("code",[t._v("Module")])])],1)]),t._v(" "),s("p",[t._v("Add "),s("code",[t._v("n_dim")]),t._v(" channels at the end of the input.")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"basic_generator"}},[s("code",[t._v("basic_generator")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L48"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("basic_generator")]),t._v("("),s("strong",[s("code",[t._v("out_size")])]),t._v(", "),s("strong",[s("code",[t._v("n_channels")])]),t._v(", "),s("strong",[s("code",[t._v("in_sz")])]),t._v("="),s("em",[s("code",[t._v("100")])]),t._v(", "),s("strong",[s("code",[t._v("n_features")])]),t._v("="),s("em",[s("code",[t._v("64")])]),t._v(", "),s("strong",[s("code",[t._v("n_extra_layers")])]),t._v("="),s("em",[s("code",[t._v("0")])]),t._v(", "),s("strong",[s("code",[t._v("ks")])]),t._v("="),s("em",[s("code",[t._v("3")])]),t._v(", "),s("strong",[s("code",[t._v("stride")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("padding")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("bias")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("ndim")])]),t._v("="),s("em",[s("code",[t._v("2")])]),t._v(", "),s("strong",[s("code",[t._v("norm_type")])]),t._v("="),s("em",[s("code",[t._v("<NormType.Batch: 1>")])]),t._v(", "),s("strong",[s("code",[t._v("bn_1st")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("act_cls")])]),t._v("="),s("em",[s("code",[t._v("ReLU")])]),t._v(", "),s("strong",[s("code",[t._v("transpose")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("init")])]),t._v("="),s("em",[s("code",[t._v("'auto'")])]),t._v(", "),s("strong",[s("code",[t._v("xtra")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("bias_std")])]),t._v("="),s("em",[s("code",[t._v("0.01")])]),t._v(", "),s("strong",[s("code",[t._v("dilation")])]),t._v(":"),s("code",[t._v("Union")]),t._v("["),s("code",[t._v("int")]),t._v(", "),s("code",[t._v("Tuple")]),t._v("["),s("code",[t._v("int")]),t._v(", "),s("code",[t._v("int")]),t._v("]]="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("groups")])]),t._v(":"),s("code",[t._v("int")]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("padding_mode")])]),t._v(":"),s("code",[t._v("str")]),t._v("="),s("em",[s("code",[t._v("'zeros'")])]),t._v(")")])]),t._v(" "),s("p",[t._v("A basic generator from "),s("code",[t._v("in_sz")]),t._v(" to images "),s("code",[t._v("n_channels")]),t._v(" x "),s("code",[t._v("out_size")]),t._v(" x "),s("code",[t._v("out_size")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("critic "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" basic_critic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ngenerator "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" basic_generator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntst "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GANModule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("critic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("critic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" generator"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("generator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nreal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nreal_p "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("real"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("real_p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ntst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("switch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tst is now in generator mode")]),t._v("\nnoise "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nfake "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fake"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" real"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ntst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("switch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tst is back in critic mode")]),t._v("\nfake_p "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fake"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_eq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fake_p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{staticClass:"doc_header",attrs:{id:"DenseResBlock"}},[s("code",[t._v("DenseResBlock")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L70"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("DenseResBlock")]),t._v("("),s("strong",[s("code",[t._v("nf")])]),t._v(", "),s("strong",[s("code",[t._v("norm_type")])]),t._v("="),s("em",[s("code",[t._v("<NormType.Batch: 1>")])]),t._v(", "),s("strong",[s("code",[t._v("ks")])]),t._v("="),s("em",[s("code",[t._v("3")])]),t._v(", "),s("strong",[s("code",[t._v("stride")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("padding")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("bias")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("ndim")])]),t._v("="),s("em",[s("code",[t._v("2")])]),t._v(", "),s("strong",[s("code",[t._v("bn_1st")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("act_cls")])]),t._v("="),s("em",[s("code",[t._v("ReLU")])]),t._v(", "),s("strong",[s("code",[t._v("transpose")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("init")])]),t._v("="),s("em",[s("code",[t._v("'auto'")])]),t._v(", "),s("strong",[s("code",[t._v("xtra")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("bias_std")])]),t._v("="),s("em",[s("code",[t._v("0.01")])]),t._v(", "),s("strong",[s("code",[t._v("dilation")])]),t._v(":"),s("code",[t._v("Union")]),t._v("["),s("code",[t._v("int")]),t._v(", "),s("code",[t._v("Tuple")]),t._v("["),s("code",[t._v("int")]),t._v(", "),s("code",[t._v("int")]),t._v("]]="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("groups")])]),t._v(":"),s("code",[t._v("int")]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("padding_mode")])]),t._v(":"),s("code",[t._v("str")]),t._v("="),s("em",[s("code",[t._v("'zeros'")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Resnet block of "),s("code",[t._v("nf")]),t._v(" features. "),s("code",[t._v("conv_kwargs")]),t._v(" are passed to "),s("code",[t._v("conv_layer")]),t._v(".")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"gan_critic"}},[s("code",[t._v("gan_critic")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L78"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("gan_critic")]),t._v("("),s("strong",[s("code",[t._v("n_channels")])]),t._v("="),s("em",[s("code",[t._v("3")])]),t._v(", "),s("strong",[s("code",[t._v("nf")])]),t._v("="),s("em",[s("code",[t._v("128")])]),t._v(", "),s("strong",[s("code",[t._v("n_blocks")])]),t._v("="),s("em",[s("code",[t._v("3")])]),t._v(", "),s("strong",[s("code",[t._v("p")])]),t._v("="),s("em",[s("code",[t._v("0.15")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Critic to train a "),s("code",[t._v("GAN")]),t._v(".")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"GANLoss"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("GANLoss")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L96"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("GANLoss")]),t._v("("),s("strong",[s("code",[t._v("gen_loss_func")])]),t._v(", "),s("strong",[s("code",[t._v("crit_loss_func")])]),t._v(", "),s("strong",[s("code",[t._v("gan_model")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/vision.gan.html#GANModule"}},[s("code",[t._v("GANModule")])])],1)]),t._v(" "),s("p",[t._v("Wrapper around "),s("code",[t._v("crit_loss_func")]),t._v(" and "),s("code",[t._v("gen_loss_func")])]),t._v(" "),s("p",[t._v("In generator mode, this loss function expects the "),s("code",[t._v("output")]),t._v(" of the generator and some "),s("code",[t._v("target")]),t._v(" (a batch of real images). It will evaluate if the generator successfully fooled the critic using "),s("code",[t._v("gen_loss_func")]),t._v(". This loss function has the following signature")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("def gen_loss_func(fake_pred, output, target):\n")])])]),s("p",[t._v("to be able to combine the output of the critic on "),s("code",[t._v("output")]),t._v(" (which the first argument "),s("code",[t._v("fake_pred")]),t._v(") with "),s("code",[t._v("output")]),t._v(" and "),s("code",[t._v("target")]),t._v(" (if you want to mix the GAN loss with other losses for instance).")]),t._v(" "),s("p",[t._v("In critic mode, this loss function expects the "),s("code",[t._v("real_pred")]),t._v(" given by the critic and some "),s("code",[t._v("input")]),t._v(" (the noise fed to the generator). It will evaluate the critic using "),s("code",[t._v("crit_loss_func")]),t._v(". This loss function has the following signature")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("def crit_loss_func(real_pred, fake_pred):\n")])])]),s("p",[t._v("where "),s("code",[t._v("real_pred")]),t._v(" is the output of the critic on a batch of real images and "),s("code",[t._v("fake_pred")]),t._v(" is generated from the noise using the generator.")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"AdaptiveLoss"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("AdaptiveLoss")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L116"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AdaptiveLoss")]),t._v("("),s("strong",[s("code",[t._v("crit")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/torch_core.html#Module"}},[s("code",[t._v("Module")])])],1)]),t._v(" "),s("p",[t._v("Expand the "),s("code",[t._v("target")]),t._v(" to match the "),s("code",[t._v("output")]),t._v(" size before applying "),s("code",[t._v("crit")]),t._v(".")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"accuracy_thresh_expand"}},[s("code",[t._v("accuracy_thresh_expand")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L123"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("accuracy_thresh_expand")]),t._v("("),s("strong",[s("code",[t._v("y_pred")])]),t._v(", "),s("strong",[s("code",[t._v("y_true")])]),t._v(", "),s("strong",[s("code",[t._v("thresh")])]),t._v("="),s("em",[s("code",[t._v("0.5")])]),t._v(", "),s("strong",[s("code",[t._v("sigmoid")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Compute accuracy after expanding "),s("code",[t._v("y_true")]),t._v(" to the size of "),s("code",[t._v("y_pred")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"callbacks-for-gan-training"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#callbacks-for-gan-training"}},[t._v("#")]),t._v(" Callbacks for GAN training")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"set_freeze_model"}},[s("code",[t._v("set_freeze_model")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L129"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("set_freeze_model")]),t._v("("),s("strong",[s("code",[t._v("m")])]),t._v(", "),s("strong",[s("code",[t._v("rg")])]),t._v(")")])]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"GANTrainer"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("GANTrainer")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L133"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("GANTrainer")]),t._v("("),s("strong",[s("code",[t._v("switch_eval")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("clip")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("beta")])]),t._v("="),s("em",[s("code",[t._v("0.98")])]),t._v(", "),s("strong",[s("code",[t._v("gen_first")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("show_img")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])])],1)]),t._v(" "),s("p",[t._v("Handles GAN Training.")]),t._v(" "),s("p",[t._v("{% include warning.html content='The GANTrainer is useless on its own, you need to complete it with one of the following switchers' %}")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"FixedGANSwitcher"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("FixedGANSwitcher")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L207"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("FixedGANSwitcher")]),t._v("("),s("strong",[s("code",[t._v("n_crit")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(", "),s("strong",[s("code",[t._v("n_gen")])]),t._v("="),s("em",[s("code",[t._v("1")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])])],1)]),t._v(" "),s("p",[t._v("Switcher to do "),s("code",[t._v("n_crit")]),t._v(" iterations of the critic then "),s("code",[t._v("n_gen")]),t._v(" iterations of the generator.")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"AdaptiveGANSwitcher"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("AdaptiveGANSwitcher")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L228"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AdaptiveGANSwitcher")]),t._v("("),s("strong",[s("code",[t._v("gen_thresh")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("critic_thresh")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])])],1)]),t._v(" "),s("p",[t._v("Switcher that goes back to generator/critic when the loss goes below "),s("code",[t._v("gen_thresh")]),t._v("/"),s("code",[t._v("crit_thresh")]),t._v(".")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"GANDiscriminativeLR"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("GANDiscriminativeLR")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L243"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("GANDiscriminativeLR")]),t._v("("),s("strong",[s("code",[t._v("mult_lr")])]),t._v("="),s("em",[s("code",[t._v("5.0")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])])],1)]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/callback.core.html#Callback"}},[s("code",[t._v("Callback")])]),t._v(" that handles multiplying the learning rate by "),s("code",[t._v("mult_lr")]),t._v(" for the critic.")],1),t._v(" "),s("h2",{attrs:{id:"gan-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gan-data"}},[t._v("#")]),t._v(" GAN data")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"InvisibleTensor"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("InvisibleTensor")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L258"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("InvisibleTensor")]),t._v("("),s("strong",[s("code",[t._v("x")])]),t._v(", "),s("strong",[t._v("**"),s("code",[t._v("kwargs")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/torch_core.html#TensorBase"}},[s("code",[t._v("TensorBase")])])],1)]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"generate_noise"}},[s("code",[t._v("generate_noise")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L262"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("generate_noise")]),t._v("("),s("strong",[s("code",[t._v("fn")])]),t._v(", "),s("strong",[s("code",[t._v("size")])]),t._v("="),s("em",[s("code",[t._v("100")])]),t._v(")")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("bs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("\nsize "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("dblock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DataBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("blocks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TransformBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ImageBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   get_x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" generate_noise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   get_items "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_image_files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   splitter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IndexSplitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   item_tfms"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Resize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ResizeMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Crop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                   batch_tfms "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Normalize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_stats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tensor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" untar_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("URLs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LSUN_BEDROOMS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("dls "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dblock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataloaders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("bs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("show_batch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("max_n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"gan-learner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gan-learner"}},[t._v("#")]),t._v(" GAN Learner")]),t._v(" "),s("h4",{staticClass:"doc_header",attrs:{id:"gan_loss_from_func"}},[s("code",[t._v("gan_loss_from_func")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L279"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("gan_loss_from_func")]),t._v("("),s("strong",[s("code",[t._v("loss_gen")])]),t._v(", "),s("strong",[s("code",[t._v("loss_crit")])]),t._v(", "),s("strong",[s("code",[t._v("weights_gen")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(")")])]),t._v(" "),s("p",[t._v("Define loss functions for a GAN from "),s("code",[t._v("loss_gen")]),t._v(" and "),s("code",[t._v("loss_crit")]),t._v(".")]),t._v(" "),s("h3",{staticClass:"doc_header",attrs:{id:"GANLearner"}},[s("code",[t._v("class")]),t._v(" "),s("code",[t._v("GANLearner")]),s("a",{staticClass:"source_link",staticStyle:{float:"right"},attrs:{href:"https://github.com/fastai/fastai/tree/master/fastai/vision/gan.py#L299"}},[t._v("[source]")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("GANLearner")]),t._v("("),s("strong",[s("code",[t._v("dls")])]),t._v(", "),s("strong",[s("code",[t._v("generator")])]),t._v(", "),s("strong",[s("code",[t._v("critic")])]),t._v(", "),s("strong",[s("code",[t._v("gen_loss_func")])]),t._v(", "),s("strong",[s("code",[t._v("crit_loss_func")])]),t._v(", "),s("strong",[s("code",[t._v("switcher")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("gen_first")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("switch_eval")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("show_img")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("clip")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("cbs")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("metrics")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("loss_func")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("opt_func")])]),t._v("="),s("em",[s("code",[t._v("Adam")])]),t._v(", "),s("strong",[s("code",[t._v("lr")])]),t._v("="),s("em",[s("code",[t._v("0.001")])]),t._v(", "),s("strong",[s("code",[t._v("splitter")])]),t._v("="),s("em",[s("code",[t._v("trainable_params")])]),t._v(", "),s("strong",[s("code",[t._v("path")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("model_dir")])]),t._v("="),s("em",[s("code",[t._v("'models'")])]),t._v(", "),s("strong",[s("code",[t._v("wd")])]),t._v("="),s("em",[s("code",[t._v("None")])]),t._v(", "),s("strong",[s("code",[t._v("wd_bn_bias")])]),t._v("="),s("em",[s("code",[t._v("False")])]),t._v(", "),s("strong",[s("code",[t._v("train_bn")])]),t._v("="),s("em",[s("code",[t._v("True")])]),t._v(", "),s("strong",[s("code",[t._v("moms")])]),t._v("="),s("em",[s("code",[t._v("(0.95, 0.85, 0.95)")])]),t._v(") :: "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])])],1)]),t._v(" "),s("p",[t._v("A "),s("RouterLink",{attrs:{to:"/learner.html#Learner"}},[s("code",[t._v("Learner")])]),t._v(" suitable for GANs.")],1),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" fastai"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("generator "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" basic_generator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_channels"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_extra_layers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncritic    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" basic_critic   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_channels"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_extra_layers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" act_cls"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("partial"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LeakyReLU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" negative_slope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GANLearner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wgan"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" generator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" critic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" opt_func "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" RMSProp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train_metrics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\nlearn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("valid_metrics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2e")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" wd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("show_results"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("max_n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ds_idx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);e.default=o.exports}}]);