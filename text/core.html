<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Text core</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Welcome to fastai">
    <link rel="preload" href="/fastai/assets/css/0.styles.24b54ae9.css" as="style"><link rel="preload" href="/fastai/assets/js/app.e4c088e4.js" as="script"><link rel="preload" href="/fastai/assets/js/2.f1c4f916.js" as="script"><link rel="preload" href="/fastai/assets/js/43.cc635513.js" as="script"><link rel="prefetch" href="/fastai/assets/js/10.99994145.js"><link rel="prefetch" href="/fastai/assets/js/11.08687312.js"><link rel="prefetch" href="/fastai/assets/js/12.40b88a98.js"><link rel="prefetch" href="/fastai/assets/js/13.83861397.js"><link rel="prefetch" href="/fastai/assets/js/14.3a1586b8.js"><link rel="prefetch" href="/fastai/assets/js/15.1cbd093c.js"><link rel="prefetch" href="/fastai/assets/js/16.c850565b.js"><link rel="prefetch" href="/fastai/assets/js/17.9c3f07b2.js"><link rel="prefetch" href="/fastai/assets/js/18.db37b5bb.js"><link rel="prefetch" href="/fastai/assets/js/19.c91272fe.js"><link rel="prefetch" href="/fastai/assets/js/20.a9c5f90d.js"><link rel="prefetch" href="/fastai/assets/js/21.e40307f7.js"><link rel="prefetch" href="/fastai/assets/js/22.8fcdc465.js"><link rel="prefetch" href="/fastai/assets/js/23.14fb4a2d.js"><link rel="prefetch" href="/fastai/assets/js/24.720b52ea.js"><link rel="prefetch" href="/fastai/assets/js/25.7912d1b1.js"><link rel="prefetch" href="/fastai/assets/js/26.366239e0.js"><link rel="prefetch" href="/fastai/assets/js/27.6db2df9e.js"><link rel="prefetch" href="/fastai/assets/js/28.ffbcb114.js"><link rel="prefetch" href="/fastai/assets/js/29.7b21b9fd.js"><link rel="prefetch" href="/fastai/assets/js/3.6e2ab6c3.js"><link rel="prefetch" href="/fastai/assets/js/30.248393fd.js"><link rel="prefetch" href="/fastai/assets/js/31.b22a56a0.js"><link rel="prefetch" href="/fastai/assets/js/32.85f7da41.js"><link rel="prefetch" href="/fastai/assets/js/33.e44ef8ee.js"><link rel="prefetch" href="/fastai/assets/js/34.9ce56e10.js"><link rel="prefetch" href="/fastai/assets/js/35.4bdc5816.js"><link rel="prefetch" href="/fastai/assets/js/36.67e5f7d9.js"><link rel="prefetch" href="/fastai/assets/js/37.36c20575.js"><link rel="prefetch" href="/fastai/assets/js/38.06c462ff.js"><link rel="prefetch" href="/fastai/assets/js/39.749b6672.js"><link rel="prefetch" href="/fastai/assets/js/4.a083dd6e.js"><link rel="prefetch" href="/fastai/assets/js/40.c732859b.js"><link rel="prefetch" href="/fastai/assets/js/41.4474ab47.js"><link rel="prefetch" href="/fastai/assets/js/42.5ee2fc2f.js"><link rel="prefetch" href="/fastai/assets/js/44.152c8da5.js"><link rel="prefetch" href="/fastai/assets/js/45.4cff1d71.js"><link rel="prefetch" href="/fastai/assets/js/46.85dce95d.js"><link rel="prefetch" href="/fastai/assets/js/47.59fb5617.js"><link rel="prefetch" href="/fastai/assets/js/48.f20ef06e.js"><link rel="prefetch" href="/fastai/assets/js/49.9625880a.js"><link rel="prefetch" href="/fastai/assets/js/5.bb68e855.js"><link rel="prefetch" href="/fastai/assets/js/50.b2e6dee9.js"><link rel="prefetch" href="/fastai/assets/js/51.267442e2.js"><link rel="prefetch" href="/fastai/assets/js/52.10494ddd.js"><link rel="prefetch" href="/fastai/assets/js/53.093941a1.js"><link rel="prefetch" href="/fastai/assets/js/54.fbc03694.js"><link rel="prefetch" href="/fastai/assets/js/55.0b1efc19.js"><link rel="prefetch" href="/fastai/assets/js/56.5f3c1da5.js"><link rel="prefetch" href="/fastai/assets/js/57.a3e942a9.js"><link rel="prefetch" href="/fastai/assets/js/58.d3ded5e3.js"><link rel="prefetch" href="/fastai/assets/js/59.ec1d3156.js"><link rel="prefetch" href="/fastai/assets/js/6.f6c9602c.js"><link rel="prefetch" href="/fastai/assets/js/60.37aa0b8a.js"><link rel="prefetch" href="/fastai/assets/js/61.ef622343.js"><link rel="prefetch" href="/fastai/assets/js/62.e733d0f9.js"><link rel="prefetch" href="/fastai/assets/js/63.a3aa571a.js"><link rel="prefetch" href="/fastai/assets/js/64.8b06642f.js"><link rel="prefetch" href="/fastai/assets/js/65.97cf2dfa.js"><link rel="prefetch" href="/fastai/assets/js/66.7f97711c.js"><link rel="prefetch" href="/fastai/assets/js/67.31ee059f.js"><link rel="prefetch" href="/fastai/assets/js/68.d013d2de.js"><link rel="prefetch" href="/fastai/assets/js/69.50b9f11d.js"><link rel="prefetch" href="/fastai/assets/js/7.c1cdf251.js"><link rel="prefetch" href="/fastai/assets/js/70.1b6f8370.js"><link rel="prefetch" href="/fastai/assets/js/71.8c3557b5.js"><link rel="prefetch" href="/fastai/assets/js/72.2d857b7b.js"><link rel="prefetch" href="/fastai/assets/js/73.0be86c71.js"><link rel="prefetch" href="/fastai/assets/js/74.a9279ff6.js"><link rel="prefetch" href="/fastai/assets/js/75.f6ce5fb3.js"><link rel="prefetch" href="/fastai/assets/js/8.be08f3ee.js"><link rel="prefetch" href="/fastai/assets/js/9.209ff10c.js">
    <link rel="stylesheet" href="/fastai/assets/css/0.styles.24b54ae9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fastai/" class="home-link router-link-active"><img src="https://images.exxactcorp.com/CMS/landing-page/resource-center/supported-software/logo/Deep-Learning/fastai-logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/fastai/quick_start.html" class="nav-link">
  Quick Start
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tutorials" class="dropdown-title"><span class="title">Tutorials</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tutorials" class="mobile-dropdown-title"><span class="title">Tutorials</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/overview.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><h4>
          Beginners
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/vision.html" class="nav-link">
  Vision Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/text.html" class="nav-link">
  Text Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/tabular.html" class="nav-link">
  Tabular Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/colab.html" class="nav-link">
  Colab Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Intermediate
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/datablock.html" class="nav-link">
  Data Block Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/imagenette.html" class="nav-link">
  Imagenette Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/pets.html" class="nav-link">
  Pets Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/transformers.html" class="nav-link">
  Transformers Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/wikitext.html" class="nav-link">
  Wikitext Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Advanced
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/siamese.html" class="nav-link">
  Siamese Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/dev-setup.html" class="nav-link">
  Developer Guide
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Training" class="dropdown-title"><span class="title">Training</span> <span class="arrow down"></span></button> <button type="button" aria-label="Training" class="mobile-dropdown-title"><span class="title">Training</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/training/learner.html" class="nav-link">
  Training Loop
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/optimizer.html" class="nav-link">
  Optimizer
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/metrics.html" class="nav-link">
  Metrics
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/interpret.html" class="nav-link">
  Interpretation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/distributed.html" class="nav-link">
  Distributed
</a></li><li class="dropdown-item"><h4>
          Callbacks
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/callback/core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/schedule.html" class="nav-link">
  Schedulers
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/hook.html" class="nav-link">
  Hooks and callbacks
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/fp16.html" class="nav-link">
  Mixed precision
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/mixup.html" class="nav-link">
  Mixup
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/cutmix.html" class="nav-link">
  Cutmix
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/tracker.html" class="nav-link">
  Tracker
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/training.html" class="nav-link">
  Training
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/rnn.html" class="nav-link">
  RNN
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/data.html" class="nav-link">
  Data
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/progress.html" class="nav-link">
  Progress
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Data" class="dropdown-title"><span class="title">Data</span> <span class="arrow down"></span></button> <button type="button" aria-label="Data" class="mobile-dropdown-title"><span class="title">Data</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/data/block.html" class="nav-link">
  Data Blocks
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/transforms.html" class="nav-link">
  Data Transforms
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/external.html" class="nav-link">
  Data External
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/core.html" class="nav-link">
  Data Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/load.html" class="nav-link">
  DataLoaders
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Core" class="dropdown-title"><span class="title">Core</span> <span class="arrow down"></span></button> <button type="button" aria-label="Core" class="mobile-dropdown-title"><span class="title">Core</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/torch_core.html" class="nav-link">
  PyTorch Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/layers.html" class="nav-link">
  Layers
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vision" class="dropdown-title"><span class="title">Vision</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vision" class="mobile-dropdown-title"><span class="title">Vision</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/learner.html" class="nav-link">
  Vision Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/augment.html" class="nav-link">
  Vision Data Augmentation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/data.html" class="nav-link">
  Vision Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/core.html" class="nav-link">
  Vision Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/utils.html" class="nav-link">
  Vision Utils
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/widgets.html" class="nav-link">
  Vision Widgets
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/vision/models.xresnet.html" class="nav-link">
  XResNet
</a></li><li class="dropdown-subitem"><a href="/fastai/vision/models.unet.html" class="nav-link">
  UNet
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Text" class="dropdown-title"><span class="title">Text</span> <span class="arrow down"></span></button> <button type="button" aria-label="Text" class="mobile-dropdown-title"><span class="title">Text</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/core.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Text Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/data.html" class="nav-link">
  Text Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/learner.html" class="nav-link">
  Text Learner
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/text/models.core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.awdlstm.html" class="nav-link">
  AWD LSTM
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.qrnn.html" class="nav-link">
  QRNN
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tabular" class="dropdown-title"><span class="title">Tabular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tabular" class="mobile-dropdown-title"><span class="title">Tabular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/tabular/core.html" class="nav-link">
  Tabular Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/data.html" class="nav-link">
  Tabular Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/learner.html" class="nav-link">
  Tabular Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/model.html" class="nav-link">
  Tabular Model
</a></li><li class="dropdown-item"><!----> <a href="/fastai/collab.html" class="nav-link">
  Collab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Medical" class="dropdown-title"><span class="title">Medical</span> <span class="arrow down"></span></button> <button type="button" aria-label="Medical" class="mobile-dropdown-title"><span class="title">Medical</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/medical/imaging.html" class="nav-link">
  Medical imagery
</a></li><li class="dropdown-item"><!----> <a href="/fastai/medical/text.html" class="nav-link">
  Medical text
</a></li></ul></div></div> <a href="https://github.com/fastai/fastai" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/fastai/quick_start.html" class="nav-link">
  Quick Start
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tutorials" class="dropdown-title"><span class="title">Tutorials</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tutorials" class="mobile-dropdown-title"><span class="title">Tutorials</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/overview.html" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><h4>
          Beginners
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/vision.html" class="nav-link">
  Vision Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/text.html" class="nav-link">
  Text Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/tabular.html" class="nav-link">
  Tabular Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/colab.html" class="nav-link">
  Colab Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Intermediate
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/datablock.html" class="nav-link">
  Data Block Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/imagenette.html" class="nav-link">
  Imagenette Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/pets.html" class="nav-link">
  Pets Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/transformers.html" class="nav-link">
  Transformers Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/tutorial/wikitext.html" class="nav-link">
  Wikitext Tutorial
</a></li></ul></li><li class="dropdown-item"><h4>
          Advanced
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/tutorial/siamese.html" class="nav-link">
  Siamese Tutorial
</a></li><li class="dropdown-subitem"><a href="/fastai/dev-setup.html" class="nav-link">
  Developer Guide
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Training" class="dropdown-title"><span class="title">Training</span> <span class="arrow down"></span></button> <button type="button" aria-label="Training" class="mobile-dropdown-title"><span class="title">Training</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/training/learner.html" class="nav-link">
  Training Loop
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/optimizer.html" class="nav-link">
  Optimizer
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/metrics.html" class="nav-link">
  Metrics
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/interpret.html" class="nav-link">
  Interpretation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/training/distributed.html" class="nav-link">
  Distributed
</a></li><li class="dropdown-item"><h4>
          Callbacks
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/callback/core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/schedule.html" class="nav-link">
  Schedulers
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/hook.html" class="nav-link">
  Hooks and callbacks
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/fp16.html" class="nav-link">
  Mixed precision
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/mixup.html" class="nav-link">
  Mixup
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/cutmix.html" class="nav-link">
  Cutmix
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/tracker.html" class="nav-link">
  Tracker
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/training.html" class="nav-link">
  Training
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/rnn.html" class="nav-link">
  RNN
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/data.html" class="nav-link">
  Data
</a></li><li class="dropdown-subitem"><a href="/fastai/callback/progress.html" class="nav-link">
  Progress
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Data" class="dropdown-title"><span class="title">Data</span> <span class="arrow down"></span></button> <button type="button" aria-label="Data" class="mobile-dropdown-title"><span class="title">Data</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/data/block.html" class="nav-link">
  Data Blocks
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/transforms.html" class="nav-link">
  Data Transforms
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/external.html" class="nav-link">
  Data External
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/core.html" class="nav-link">
  Data Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/data/load.html" class="nav-link">
  DataLoaders
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Core" class="dropdown-title"><span class="title">Core</span> <span class="arrow down"></span></button> <button type="button" aria-label="Core" class="mobile-dropdown-title"><span class="title">Core</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/torch_core.html" class="nav-link">
  PyTorch Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/layers.html" class="nav-link">
  Layers
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vision" class="dropdown-title"><span class="title">Vision</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vision" class="mobile-dropdown-title"><span class="title">Vision</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/vision/learner.html" class="nav-link">
  Vision Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/augment.html" class="nav-link">
  Vision Data Augmentation
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/data.html" class="nav-link">
  Vision Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/core.html" class="nav-link">
  Vision Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/utils.html" class="nav-link">
  Vision Utils
</a></li><li class="dropdown-item"><!----> <a href="/fastai/vision/widgets.html" class="nav-link">
  Vision Widgets
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/vision/models.xresnet.html" class="nav-link">
  XResNet
</a></li><li class="dropdown-subitem"><a href="/fastai/vision/models.unet.html" class="nav-link">
  UNet
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Text" class="dropdown-title"><span class="title">Text</span> <span class="arrow down"></span></button> <button type="button" aria-label="Text" class="mobile-dropdown-title"><span class="title">Text</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/text/core.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Text Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/data.html" class="nav-link">
  Text Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/text/learner.html" class="nav-link">
  Text Learner
</a></li><li class="dropdown-item"><h4>
          Models
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fastai/text/models.core.html" class="nav-link">
  Core
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.awdlstm.html" class="nav-link">
  AWD LSTM
</a></li><li class="dropdown-subitem"><a href="/fastai/text/models.qrnn.html" class="nav-link">
  QRNN
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tabular" class="dropdown-title"><span class="title">Tabular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tabular" class="mobile-dropdown-title"><span class="title">Tabular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/tabular/core.html" class="nav-link">
  Tabular Core
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/data.html" class="nav-link">
  Tabular Data
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/learner.html" class="nav-link">
  Tabular Learner
</a></li><li class="dropdown-item"><!----> <a href="/fastai/tabular/model.html" class="nav-link">
  Tabular Model
</a></li><li class="dropdown-item"><!----> <a href="/fastai/collab.html" class="nav-link">
  Collab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Medical" class="dropdown-title"><span class="title">Medical</span> <span class="arrow down"></span></button> <button type="button" aria-label="Medical" class="mobile-dropdown-title"><span class="title">Medical</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fastai/medical/imaging.html" class="nav-link">
  Medical imagery
</a></li><li class="dropdown-item"><!----> <a href="/fastai/medical/text.html" class="nav-link">
  Medical text
</a></li></ul></div></div> <a href="https://github.com/fastai/fastai" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Text core</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fastai/text/core.html#preprocessing-rules" class="sidebar-link">Preprocessing rules</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fastai/text/core.html#tokenizing" class="sidebar-link">Tokenizing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fastai/text/core.html#tokenize-texts-in-files" class="sidebar-link">Tokenize texts in files</a></li><li class="sidebar-sub-header"><a href="/fastai/text/core.html#tokenize-texts-in-a-dataframe" class="sidebar-link">Tokenize texts in a dataframe</a></li></ul></li><li><a href="/fastai/text/core.html#sentencepiece" class="sidebar-link">Sentencepiece</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="text-core"><a href="#text-core" class="header-anchor">#</a> Text core</h1> <blockquote><p>Basic function to preprocess text before assembling it in a <code>DataLoaders</code>.</p></blockquote> <h2 id="preprocessing-rules"><a href="#preprocessing-rules" class="header-anchor">#</a> Preprocessing rules</h2> <p>The following are rules applied to texts before or after it's tokenized.</p> <h4 id="spec_add_spaces" class="doc_header"><code>spec_add_spaces</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L28" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>spec_add_spaces</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Add spaces around / and #</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>spec_add_spaces<span class="token punctuation">(</span><span class="token string">'#fastai'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' # fastai'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>spec_add_spaces<span class="token punctuation">(</span><span class="token string">'/fastai'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' / fastai'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>spec_add_spaces<span class="token punctuation">(</span><span class="token string">'\\fastai'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' \\ fastai'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="rm_useless_spaces" class="doc_header"><code>rm_useless_spaces</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L35" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>rm_useless_spaces</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Remove multiple spaces</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>rm_useless_spaces<span class="token punctuation">(</span><span class="token string">'a  b   c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a b c'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="replace_rep" class="doc_header"><code>replace_rep</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L42" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>replace_rep</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Replace repetitions at the character level: cccc -- TK_REP 4 c</p> <p>It starts replacing at 3 repetitions of the same character or more.</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>replace_rep<span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'aa'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_rep<span class="token punctuation">(</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>TK_REP<span class="token punctuation">}</span></span><span class="token string"> 4 a '</span></span><span class="token punctuation">)</span>
</code></pre></div><h4 id="replace_wrep" class="doc_header"><code>replace_wrep</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L53" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>replace_wrep</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Replace word repetitions: word word word word -- TK_WREP 4 word</p> <p>It starts replacing at 3 repetitions of the same word or more.</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>replace_wrep<span class="token punctuation">(</span><span class="token string">'ah ah'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ah ah'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_wrep<span class="token punctuation">(</span><span class="token string">'ah ah ah'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>TK_WREP<span class="token punctuation">}</span></span><span class="token string"> 3 ah '</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_wrep<span class="token punctuation">(</span><span class="token string">'ah ah   ah  ah'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>TK_WREP<span class="token punctuation">}</span></span><span class="token string"> 4 ah '</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_wrep<span class="token punctuation">(</span><span class="token string">'ah ah ah ah '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>TK_WREP<span class="token punctuation">}</span></span><span class="token string"> 4 ah  '</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_wrep<span class="token punctuation">(</span><span class="token string">'ah ah ah ah.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>TK_WREP<span class="token punctuation">}</span></span><span class="token string"> 4 ah .'</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_wrep<span class="token punctuation">(</span><span class="token string">'ah ah ahi'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'ah ah ahi'</span></span><span class="token punctuation">)</span>
</code></pre></div><h4 id="fix_html" class="doc_header"><code>fix_html</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L61" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>fix_html</code>(<strong><code>x</code></strong>)</p></blockquote> <p>Various messy things we've seen in documents</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>fix_html<span class="token punctuation">(</span><span class="token string">'#39;bli#146;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;'bli'&quot;</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>fix_html<span class="token punctuation">(</span><span class="token string">'Sarah amp; Duck...'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Sarah &amp; Duck â€¦'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>fix_html<span class="token punctuation">(</span><span class="token string">'a nbsp; #36;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a   $'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>fix_html<span class="token punctuation">(</span><span class="token string">'\\&quot; &lt;unk&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'&quot; </span><span class="token interpolation"><span class="token punctuation">{</span>UNK<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>fix_html<span class="token punctuation">(</span><span class="token string">'quot;  @.@  @-@ '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;' .-&quot;</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>fix_html<span class="token punctuation">(</span><span class="token string">'&lt;br /&gt;text\\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\ntext\n'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="replace_all_caps" class="doc_header"><code>replace_all_caps</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L72" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>replace_all_caps</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Replace tokens in ALL CAPS by their lower version and add <code>TK_UP</code> before.</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>replace_all_caps<span class="token punctuation">(</span><span class="token string">&quot;I'M SHOUTING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>TK_UP<span class="token punctuation">}</span></span><span class="token string"> i'm </span><span class="token interpolation"><span class="token punctuation">{</span>TK_UP<span class="token punctuation">}</span></span><span class="token string"> shouting&quot;</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_all_caps<span class="token punctuation">(</span><span class="token string">&quot;I'm speaking normally&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;I'm speaking normally&quot;</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_all_caps<span class="token punctuation">(</span><span class="token string">&quot;I am speaking normally&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;i am speaking normally&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="replace_maj" class="doc_header"><code>replace_maj</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L83" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>replace_maj</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Replace tokens in ALL CAPS by their lower version and add <code>TK_UP</code> before.</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>replace_maj<span class="token punctuation">(</span><span class="token string">&quot;Jeremy Howard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>TK_MAJ<span class="token punctuation">}</span></span><span class="token string"> jeremy </span><span class="token interpolation"><span class="token punctuation">{</span>TK_MAJ<span class="token punctuation">}</span></span><span class="token string"> howard'</span></span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>replace_maj<span class="token punctuation">(</span><span class="token string">&quot;I don't think there is any maj here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;i don't think there is any maj here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="lowercase" class="doc_header"><code>lowercase</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L91" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>lowercase</code>(<strong><code>t</code></strong>, <strong><code>add_bos</code></strong>=<em><code>True</code></em>, <strong><code>add_eos</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Converts <code>t</code> to lowercase</p> <h4 id="replace_space" class="doc_header"><code>replace_space</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L96" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>replace_space</code>(<strong><code>t</code></strong>)</p></blockquote> <p>Replace embedded spaces in a token with unicode line char to allow for split/join</p> <h2 id="tokenizing"><a href="#tokenizing" class="header-anchor">#</a> Tokenizing</h2> <p>A tokenizer is a class that must implement <code>__call__</code>. This method receives a iterator of texts and must return a generator with their tokenized versions. Here is the most basic example:</p> <h3 id="BaseTokenizer" class="doc_header"><code>class</code> <code>BaseTokenizer</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L107" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>BaseTokenizer</code>(<strong><code>split_char</code></strong>=<em><code>' '</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <p>Basic tokenizer that just splits on spaces</p> <div class="language-python extra-class"><pre class="language-python"><code>tok <span class="token operator">=</span> BaseTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tok<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;This is a text&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;This&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;is&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tok <span class="token operator">=</span> BaseTokenizer<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tok<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;This is a text&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;This is a te&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="SpacyTokenizer" class="doc_header"><code>class</code> <code>SpacyTokenizer</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L113" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>SpacyTokenizer</code>(<strong><code>lang</code></strong>=<em><code>'en'</code></em>, <strong><code>special_toks</code></strong>=<em><code>None</code></em>, <strong><code>buf_sz</code></strong>=<em><code>5000</code></em>)</p></blockquote> <p>Spacy tokenizer for <code>lang</code></p> <div class="language-python extra-class"><pre class="language-python"><code>tok <span class="token operator">=</span> SpacyTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
inp<span class="token punctuation">,</span>exp <span class="token operator">=</span> <span class="token string">&quot;This isn't the easiest text.&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;This&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;is&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;n't&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;the&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;easiest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">]</span>
test_eq<span class="token punctuation">(</span>L<span class="token punctuation">(</span>tok<span class="token punctuation">(</span><span class="token punctuation">[</span>inp<span class="token punctuation">,</span>inp<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>exp<span class="token punctuation">,</span>exp<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="TokenizeWithRules" class="doc_header"><code>class</code> <code>TokenizeWithRules</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L128" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>TokenizeWithRules</code>(<strong><code>tok</code></strong>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>post_rules</code></strong>=<em><code>None</code></em>)</p></blockquote> <p>A wrapper around <code>tok</code> which applies <code>rules</code>, then tokenizes, then applies <code>post_rules</code></p> <div class="language-python extra-class"><pre class="language-python"><code>f <span class="token operator">=</span> TokenizeWithRules<span class="token punctuation">(</span>BaseTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rules<span class="token operator">=</span><span class="token punctuation">[</span>replace_all_caps<span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;THIS isn't a problem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>TK_UP<span class="token punctuation">,</span> <span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">&quot;isn't&quot;</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'problem'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> TokenizeWithRules<span class="token punctuation">(</span>SpacyTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;This isn't a problem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>BOS<span class="token punctuation">,</span> TK_MAJ<span class="token punctuation">,</span> <span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">&quot;n't&quot;</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'problem'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> TokenizeWithRules<span class="token punctuation">(</span>BaseTokenizer<span class="token punctuation">(</span>split_char<span class="token operator">=</span><span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rules<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;This isn't a problem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Thisâ–isn'</span><span class="token punctuation">,</span> <span class="token string">'tâ–aâ–problem'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>The main function that will be called during one of the processes handling tokenization. It will iterate through the <code>batch</code> of texts, apply them <code>rules</code> and tokenize them.</p> <div class="language-python extra-class"><pre class="language-python"><code>texts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;this is a text&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;this is another text&quot;</span><span class="token punctuation">]</span>
tok <span class="token operator">=</span> TokenizeWithRules<span class="token punctuation">(</span>BaseTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> texts<span class="token punctuation">.</span>__getitem__<span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tok<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">'another'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="tokenize1" class="doc_header"><code>tokenize1</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L139" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>tokenize1</code>(<strong><code>text</code></strong>, <strong><code>tok</code></strong>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>post_rules</code></strong>=<em><code>None</code></em>)</p></blockquote> <p>Call <a href="/fastai/text.core.html#TokenizeWithRules"><code>TokenizeWithRules</code></a> with a single text</p> <div class="language-python extra-class"><pre class="language-python"><code>test_eq<span class="token punctuation">(</span>tokenize1<span class="token punctuation">(</span><span class="token string">&quot;This isn't a problem&quot;</span><span class="token punctuation">,</span> SpacyTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>BOS<span class="token punctuation">,</span> TK_MAJ<span class="token punctuation">,</span> <span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">&quot;n't&quot;</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'problem'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tokenize1<span class="token punctuation">(</span><span class="token string">&quot;This isn't a problem&quot;</span><span class="token punctuation">,</span> tok<span class="token operator">=</span>BaseTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rules<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'This'</span><span class="token punctuation">,</span><span class="token string">&quot;isn't&quot;</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'problem'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="parallel_tokenize" class="doc_header"><code>parallel_tokenize</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L145" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>parallel_tokenize</code>(<strong><code>items</code></strong>, <strong><code>tok</code></strong>=<em><code>None</code></em>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>n_workers</code></strong>=<em><code>4</code></em>, <strong>**<code>kwargs</code></strong>)</p></blockquote> <p>Calls optional <code>setup</code> on <code>tok</code> before launching <a href="/fastai/text.core.html#TokenizeWithRules"><code>TokenizeWithRules</code></a> using `parallel_gen</p> <p>Note that since this uses <a href="https://fastcore.fast.ai/utils#parallel_gen" target="_blank" rel="noopener noreferrer"><code>parallel_gen</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> behind the scenes, the generator returned contains tuples of indices and results. There is no guarantee that the results are returned in order, so you should sort by the first item of the tuples (the indices) if you need them ordered.</p> <div class="language-python extra-class"><pre class="language-python"><code>res  <span class="token operator">=</span> parallel_tokenize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'0 1'</span><span class="token punctuation">,</span> <span class="token string">'1 2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rules<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
idxs<span class="token punctuation">,</span>toks <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>L<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>itemgetter<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>toks<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="tokenize-texts-in-files"><a href="#tokenize-texts-in-files" class="header-anchor">#</a> Tokenize texts in files</h3> <p>Preprocessing function for texts in filenames. Tokenized texts will be saved in a similar fashion in a directory suffixed with <code>_tok</code> in the parent folder of <code>path</code> (override with <code>output_dir</code>). This directory is the return value.</p> <h4 id="tokenize_folder" class="doc_header"><code>tokenize_folder</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L178" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>tokenize_folder</code>(<strong><code>path</code></strong>, <strong><code>extensions</code></strong>=<em><code>None</code></em>, <strong><code>folders</code></strong>=<em><code>None</code></em>, <strong><code>output_dir</code></strong>=<em><code>None</code></em>, <strong><code>skip_if_exists</code></strong>=<em><code>True</code></em>, <strong><code>output_names</code></strong>=<em><code>None</code></em>, <strong><code>n_workers</code></strong>=<em><code>4</code></em>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>tok</code></strong>=<em><code>None</code></em>, <strong><code>encoding</code></strong>=<em><code>'utf8'</code></em>)</p></blockquote> <p>Tokenize text files in <code>path</code> in parallel using <code>n_workers</code></p> <p>The result will be in <code>output_dir</code> (defaults to a folder in the same parent directory as <code>path</code>, with <code>_tok</code> added to <code>path.name</code>) with the same structure as in <code>path</code>. Tokenized texts for a given file will be in the file having the same name in <code>output_dir</code>. Additionally, a file with a .len suffix contains the number of tokens and the count of all words is stored in <code>output_dir/counter.pkl</code>.</p> <p><code>extensions</code> will default to <code>['.txt']</code> and all text files in <code>path</code> are treated unless you specify a list of folders in <code>include</code>. <code>rules</code> (that defaults to <a href="/fastai/text.core.html#defaults.text_proc_rules"><code>defaults.text_proc_rules</code></a>) are applied to each text before going in the tokenizer.</p> <h4 id="tokenize_files" class="doc_header"><code>tokenize_files</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L187" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>tokenize_files</code>(<strong><code>files</code></strong>, <strong><code>path</code></strong>, <strong><code>output_dir</code></strong>, <strong><code>output_names</code></strong>=<em><code>None</code></em>, <strong><code>n_workers</code></strong>=<em><code>4</code></em>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>tok</code></strong>=<em><code>None</code></em>, <strong><code>encoding</code></strong>=<em><code>'utf8'</code></em>, <strong><code>skip_if_exists</code></strong>=<em><code>False</code></em>)</p></blockquote> <p>Tokenize text <code>files</code> in parallel using <code>n_workers</code></p> <h3 id="tokenize-texts-in-a-dataframe"><a href="#tokenize-texts-in-a-dataframe" class="header-anchor">#</a> Tokenize texts in a dataframe</h3> <h4 id="tokenize_texts" class="doc_header"><code>tokenize_texts</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L203" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>tokenize_texts</code>(<strong><code>texts</code></strong>, <strong><code>n_workers</code></strong>=<em><code>4</code></em>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>tok</code></strong>=<em><code>None</code></em>)</p></blockquote> <p>Tokenize <code>texts</code> in parallel using <code>n_workers</code></p> <h4 id="tokenize_df" class="doc_header"><code>tokenize_df</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L211" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>tokenize_df</code>(<strong><code>df</code></strong>, <strong><code>text_cols</code></strong>, <strong><code>n_workers</code></strong>=<em><code>4</code></em>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>mark_fields</code></strong>=<em><code>None</code></em>, <strong><code>tok</code></strong>=<em><code>None</code></em>, <strong><code>res_col_name</code></strong>=<em><code>'text'</code></em>)</p></blockquote> <p>Tokenize texts in <code>df[text_cols]</code> in parallel using <code>n_workers</code></p> <p>This function returns a new dataframe with the same non-text columns, a column named text that contains the tokenized texts and a column named text_lengths that contains their respective length. It also returns a counter of all seen words to quickly build a vocabulary afterward.</p> <p><code>rules</code> (that defaults to <a href="/fastai/text.core.html#defaults.text_proc_rules"><code>defaults.text_proc_rules</code></a>) are applied to each text before going in the tokenizer. If <code>mark_fields</code> isn't specified, it defaults to <code>False</code> when there is a single text column, <code>True</code> when there are several. In that case, the texts in each of those columns are joined with <code>FLD</code> markers followed by the number of the field.</p> <h4 id="tokenize_csv" class="doc_header"><code>tokenize_csv</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L229" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>tokenize_csv</code>(<strong><code>fname</code></strong>, <strong><code>text_cols</code></strong>, <strong><code>outname</code></strong>=<em><code>None</code></em>, <strong><code>n_workers</code></strong>=<em><code>4</code></em>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>mark_fields</code></strong>=<em><code>None</code></em>, <strong><code>tok</code></strong>=<em><code>None</code></em>, <strong><code>header</code></strong>=<em><code>'infer'</code></em>, <strong><code>chunksize</code></strong>=<em><code>50000</code></em>)</p></blockquote> <p>Tokenize texts in the <code>text_cols</code> of the csv <code>fname</code> in parallel using <code>n_workers</code></p> <h4 id="load_tokenized_csv" class="doc_header"><code>load_tokenized_csv</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L246" class="source_link" style="float:right;">[source]</a></h4> <blockquote><p><code>load_tokenized_csv</code>(<strong><code>fname</code></strong>)</p></blockquote> <p>Utility function to quickly load a tokenized csv ans the corresponding counter</p> <p>The result will be written in a new csv file in <code>outname</code> (defaults to the same as <code>fname</code> with the suffix <code>_tok.csv</code>) and will have the same header as the original file, the same non-text columns, a text and a text_lengths column as described in <a href="/fastai/text.core.html#tokenize_df"><code>tokenize_df</code></a>.</p> <p><code>rules</code> (that defaults to <a href="/fastai/text.core.html#defaults.text_proc_rules"><code>defaults.text_proc_rules</code></a>) are applied to each text before going in the tokenizer. If <code>mark_fields</code> isn't specified, it defaults to <code>False</code> when there is a single text column, <code>True</code> when there are several. In that case, the texts in each of those columns are joined with <code>FLD</code> markers followed by the number of the field.</p> <p>The csv file is opened with <code>header</code> and optionally with blocks of <code>chunksize</code> at a time. If this argument is passed, each chunk is processed independently and saved in the output file to save memory usage.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_prepare_texts</span><span class="token punctuation">(</span>tmp_d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;Prepare texts in a folder struct in tmp_d, a csv file and returns a dataframe&quot;</span>
    path <span class="token operator">=</span> Path<span class="token punctuation">(</span>tmp_d<span class="token punctuation">)</span><span class="token operator">/</span><span class="token string">'tmp'</span>
    path<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> 
        <span class="token punctuation">(</span>path<span class="token operator">/</span>d<span class="token punctuation">)</span><span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token operator">/</span>d<span class="token operator">/</span><span class="token string-interpolation"><span class="token string">f'text</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">.txt'</span></span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;This is an example of text </span><span class="token interpolation"><span class="token punctuation">{</span>d<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    
    texts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;This is an example of text </span><span class="token interpolation"><span class="token punctuation">{</span>d<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'text'</span><span class="token punctuation">:</span> texts<span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    csv_fname <span class="token operator">=</span> tmp_d<span class="token operator">/</span><span class="token string">'input.csv'</span>
    df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>csv_fname<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> path<span class="token punctuation">,</span>df<span class="token punctuation">,</span>csv_fname
</code></pre></div><h3 id="Tokenizer" class="doc_header"><code>class</code> <code>Tokenizer</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L255" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>Tokenizer</code>(<strong><code>tok</code></strong>, <strong><code>rules</code></strong>=<em><code>None</code></em>, <strong><code>counter</code></strong>=<em><code>None</code></em>, <strong><code>lengths</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>, <strong><code>sep</code></strong>=<em><code>' '</code></em>) :: <a href="https://fastcore.fast.ai/transform#Transform" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Provides a consistent <a href="https://fastcore.fast.ai/transform#Transform" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> interface to tokenizers operating on <code>DataFrame</code>s and folders</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> tempfile<span class="token punctuation">.</span>TemporaryDirectory<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tmp_d<span class="token punctuation">:</span>
    path<span class="token punctuation">,</span>df<span class="token punctuation">,</span>csv_fname <span class="token operator">=</span> _prepare_texts<span class="token punctuation">(</span>Path<span class="token punctuation">(</span>tmp_d<span class="token punctuation">)</span><span class="token punctuation">)</span>
    items <span class="token operator">=</span> get_text_files<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    splits <span class="token operator">=</span> RandomSplitter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
    dsets <span class="token operator">=</span> Datasets<span class="token punctuation">(</span>items<span class="token punctuation">,</span> <span class="token punctuation">[</span>Tokenizer<span class="token punctuation">.</span>from_folder<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> splits<span class="token operator">=</span>splits<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dsets<span class="token punctuation">.</span>train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    dsets <span class="token operator">=</span> Datasets<span class="token punctuation">(</span>df<span class="token punctuation">,</span> <span class="token punctuation">[</span>Tokenizer<span class="token punctuation">.</span>from_df<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> splits<span class="token operator">=</span>splits<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dsets<span class="token punctuation">.</span>train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>((#10) ['xxbos','xxmaj','this','is','an','example','of','text','c','2'],)






('xxbos', 'xxmaj', 'this', 'is', 'an', 'example', 'of', 'text', 'c', '0')
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>tst <span class="token operator">=</span> test_set<span class="token punctuation">(</span>dsets<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'This is a test'</span><span class="token punctuation">,</span> <span class="token string">'this is another test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_eq<span class="token punctuation">(</span>tst<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'xxbos'</span><span class="token punctuation">,</span> <span class="token string">'xxmaj'</span><span class="token punctuation">,</span> <span class="token string">'this'</span><span class="token punctuation">,</span><span class="token string">'is'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
              <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'xxbos'</span><span class="token punctuation">,</span><span class="token string">'this'</span><span class="token punctuation">,</span><span class="token string">'is'</span><span class="token punctuation">,</span><span class="token string">'another'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="sentencepiece"><a href="#sentencepiece" class="header-anchor">#</a> Sentencepiece</h2> <h3 id="SentencePieceTokenizer" class="doc_header"><code>class</code> <code>SentencePieceTokenizer</code><a href="https://github.com/fastai/fastai/tree/master/fastai/text/core.py#L315" class="source_link" style="float:right;">[source]</a></h3> <blockquote><p><code>SentencePieceTokenizer</code>(<strong><code>lang</code></strong>=<em><code>'en'</code></em>, <strong><code>special_toks</code></strong>=<em><code>None</code></em>, <strong><code>sp_model</code></strong>=<em><code>None</code></em>, <strong><code>vocab_sz</code></strong>=<em><code>None</code></em>, <strong><code>max_vocab_sz</code></strong>=<em><code>30000</code></em>, <strong><code>model_type</code></strong>=<em><code>'unigram'</code></em>, <strong><code>char_coverage</code></strong>=<em><code>None</code></em>, <strong><code>cache_dir</code></strong>=<em><code>'tmp'</code></em>)</p></blockquote> <p>SentencePiece tokenizer for <code>lang</code></p> <div class="language-python extra-class"><pre class="language-python"><code>texts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;This is an example of text </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'text'</span><span class="token punctuation">:</span> texts<span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
out<span class="token punctuation">,</span>cnt <span class="token operator">=</span> tokenize_df<span class="token punctuation">(</span>df<span class="token punctuation">,</span> text_cols<span class="token operator">=</span><span class="token string">'text'</span><span class="token punctuation">,</span> tok<span class="token operator">=</span>SentencePieceTokenizer<span class="token punctuation">(</span>vocab_sz<span class="token operator">=</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n_workers<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> tempfile<span class="token punctuation">.</span>TemporaryDirectory<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tmp_d<span class="token punctuation">:</span>
    path<span class="token punctuation">,</span>df<span class="token punctuation">,</span>csv_fname <span class="token operator">=</span> _prepare_texts<span class="token punctuation">(</span>Path<span class="token punctuation">(</span>tmp_d<span class="token punctuation">)</span><span class="token punctuation">)</span>
    items <span class="token operator">=</span> get_text_files<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    splits <span class="token operator">=</span> RandomSplitter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
    tok <span class="token operator">=</span> SentencePieceTokenizer<span class="token punctuation">(</span>special_toks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    dsets <span class="token operator">=</span> Datasets<span class="token punctuation">(</span>items<span class="token punctuation">,</span> <span class="token punctuation">[</span>Tokenizer<span class="token punctuation">.</span>from_folder<span class="token punctuation">(</span>path<span class="token punctuation">,</span> tok<span class="token operator">=</span>tok<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> splits<span class="token operator">=</span>splits<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dsets<span class="token punctuation">.</span>train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    dsets <span class="token operator">=</span> Datasets<span class="token punctuation">(</span>df<span class="token punctuation">,</span> <span class="token punctuation">[</span>Tokenizer<span class="token punctuation">.</span>from_df<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> tok<span class="token operator">=</span>tok<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> splits<span class="token operator">=</span>splits<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dsets<span class="token punctuation">.</span>train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>((#33) ['â–xx','b','o','s','â–xx','m','a','j','â–t','h'...],)






(#33) ['â–xx','b','o','s','â–xx','m','a','j','â–t','h'...]
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/fastai/assets/js/app.e4c088e4.js" defer></script><script src="/fastai/assets/js/2.f1c4f916.js" defer></script><script src="/fastai/assets/js/43.cc635513.js" defer></script>
  </body>
</html>
